{"version":3,"sources":["assets/zadigChess.png","components/header/header.component.jsx","components/prisoners/prisoners.component.jsx","components/board/board.component.jsx","components/turns/turns.component.jsx","components/resume/resume.component.jsx","components/movesCommands/movesCommands.component.jsx","assets/first.gif","assets/prev.gif","assets/next.gif","assets/last.gif","components/gameList/gameList.component.jsx","components/gameMenu/gameMenu.component.jsx","components/info/info.component.jsx","utils.js","movesLogic.js","storage.js","fen.js","components/game/game.component.jsx","App.js","index.js"],"names":["Header","props","className","src","logo","alt","parentInfos","storageType","prepareScore","score","prepareJail","listW","listB","figCodes","side","color","result","list","previous","length","forEach","x","__html","Prisoners","whiteJail","scores","blackJail","boardPosition","pgnResume","Black","White","whiteScore","blackScore","dangerouslySetInnerHTML","onClick","reverseBoard","Board","game","doReverseBoard","data","map","i","Fragment","squareColor","fig","Turns","turnsList","turn","index","movePGN","currentMove","number","w","b","Resume","resume","Date","Result","MovesCommands","GameList","games","Event","Site","WhiteElo","BlackElo","id","loadGame","online","deleteGame","GameMenu","movesLoaded","menuMove","Info","status","statuses","showInput","pgnHistory","infosTitle","name","savePGN","showList","isRemote","showMessage","inError","init","infosMessage","showMoves","pgnGame","move","charIsLowercase","c","toUpperCase","setRookPossiblePreviousPositions","nextMoveData","columnsOrdered","r","moveRow","possibleMove","moveColumn","comingFromRow","row","comingFromColumn","column","possiblePositions","push","setKingPossiblePreviousPositions","moveType","moveSide","additionalMove","uniqueFigure","setPawnPossiblePreviousPositions","posMoveColumn","indexOf","isError","setBishopPossiblePreviousPositions","rowPos","colPos","setKnightPossiblePreviousPositions","getMoveOffset","ManageStorage","initRemote","url","key","Promise","resolve","reject","xhr","XMLHttpRequest","open","onload","this","JSON","parse","response","e","statusText","onerror","send","setRemote","setRequestHeader","stringify","Storage","localStorage","setItem","getItem","dataJson","boardToFen","gamePositions","fen","separator","nullCounter","currentFigure","col","charAt","toLowerCase","Game","doReverse","state","setState","Number","currentTarget","getAttribute","doDeleteGame","doLoadGame","factory","storageManager","filter","otherProps","then","setLocal","newStatus","gameStatus","setGameStatus","catch","gamesFilter","initialData","fenGame","moveGameTo","askedMove","timing","pace","gamePgn","columns","slice","askedMoveOffset","currentMoveOffset","movePieceType","isCheck","isMat","isDone","promoteTo","nextMovePosition","Math","trunc","nextMove","replace","substring","parseInt","isNaN","comingFrom","getNextMove","hasMoved","j","hasMovedKing","hasMovedRook","delta","that","setTimeout","target","elem","movesList","lastMove","instruction","getAskedMove","dataset","fenMove","reinitData","scoreWhite","scoreBlack","figs","figsValues","whiteTeam","blackTeam","originalTeam","item","figure","pos","nr","boardToScore","board","colDatas","split","cursorPos","colData","colDataLen","char","intTry","d","fenToBoard","textArea","document","getElementById","pgn","value","limitBetweenGameParts","exec","pngInfos","trim","infosClean","infos","raw","clean","pngToInfos","turns","end","turnPrevPosition","turnNextPosition","moves","turnInfo","pngToTurns","positions","getMoveDataAt","getPositionsAt","gameToSave","saveGameToStorage","getTime","message","newState","title","p","initData","initError","initGames","initLocal","initialStatus","setParentInfos","currentColor","blackColor","whiteColor","black","white","previousColor","rows","figures","pawn","sqr","check","React","Component","App","useState","ReactDOM","render"],"mappings":"yXAAe,G,YAAA,IAA0B,wC,OCc1BA,EAVA,SAACC,GACd,OACA,sBAAKC,UAAU,SAAf,UACE,qBAAKC,IAAK,KAAKC,EAAMF,UAAU,OAAOG,IAAI,SAC1C,sBAAKH,UAAU,QAAf,2BACgB,sBAAMA,UAAU,cAAhB,SAA+BD,EAAMK,YAAYC,qB,qDCFrE,SAASC,EAAaC,GAClB,OAAa,IAAVA,EAAoB,GAChBA,EAAQ,EAAI,IAAIA,EAAQ,GAAGA,EAGtC,SAASC,EAAYC,EAAMC,EAAMC,EAASC,GACtC,IAAIC,EAAiB,MAATD,EAAe,IAAM,IAC7BE,EAAS,GACTC,EAAgB,MAATH,EAAeF,EAAQD,EAC9BO,EAAWD,GAAQA,EAAKE,OAAS,EAAIF,EAAK,GAAK,GAQnD,OAPAA,EAAKG,SAAQ,SAACC,GACPH,IAAaG,IACZL,GAAQ,eACRE,EAAWG,GAEfL,GAAUH,EAASQ,EAAEN,MAElB,CAACO,OAAQN,GAIpB,IAkBeO,EAlBG,SAACtB,GACf,IAAIuB,EAAYvB,EAAMwB,OAAOD,UACzBE,EAAYzB,EAAMwB,OAAOC,UACzBb,EAAWZ,EAAMY,SACjBC,EAAOb,EAAMa,KACjB,OACI,sBAAKZ,UAAS,eAAkC,aAAxBD,EAAM0B,cAA+B,UAAY,GAA3D,sBACG,MAAf1B,EAAMa,KAAwC,aAAxBb,EAAM0B,cAA+B,QAAU,QAAoC,aAAxB1B,EAAM0B,cAA+B,QAAU,SADlI,UAEI,uBAAMzB,UAAU,YAAhB,UACI,sBAAMA,UAAU,SAAhB,SAAyC,MAAfD,EAAMa,KAAeb,EAAM2B,UAAUC,MAAQ5B,EAAM2B,UAAUE,QACvF,sBAAM5B,UAAU,QAAhB,SAAwC,MAAfD,EAAMa,KAAeN,EAAaP,EAAMwB,OAAOM,YAAcvB,EAAaP,EAAMwB,OAAOO,cAChH,sBAAM9B,UAAU,OAAO+B,wBAAyBvB,EAAYc,EAAUE,EAAUb,EAASC,QAG7F,sBAAMZ,UAAU,oBAAoBgC,QAASjC,EAAMkC,aAAcF,wBAtCtE,CAACX,OAAQ,gBCiBCc,EAlBH,SAACnC,GACb,OACE,sBAAKC,UAAS,qBAAgBD,EAAMoC,KAAKC,eAAiB,UAAY,IAAtE,UACE,cAAC,EAAD,CAAWxB,KAAK,IAAIqB,aAAclC,EAAMkC,aAActB,SAAUZ,EAAMoC,KAAKxB,SAAUe,UAAW3B,EAAMoC,KAAKT,UAAWH,OAAQxB,EAAMoC,KAAKZ,SACzI,qBAAKvB,UAAU,QAAf,SAEID,EAAMoC,KAAKE,KACRC,KAAI,SAACnB,EAAGoB,GAAJ,OACH,cAAC,IAAMC,SAAP,UACE,qBAAa,WAAUD,EAAGvC,UAAW,UAAYmB,EAAEsB,YAAaV,wBAAyB,CAAEX,OAAQrB,EAAMoC,KAAKxB,SAASQ,EAAEuB,KAAO3C,EAAMoC,KAAKxB,SAASQ,EAAEuB,KAAO,WAAnJH,IADSA,QAM7B,cAAC,EAAD,CAAW3B,KAAK,IAAIqB,aAAclC,EAAMkC,aAActB,SAAUZ,EAAMoC,KAAKxB,SAAUe,UAAW3B,EAAMoC,KAAKT,UAAWH,OAAQxB,EAAMoC,KAAKZ,aCQhIoB,G,YAvBD,SAAC5C,GACX,OACI,qBAAKC,UAAU,aAAf,SACI,6BAEQD,EAAM6C,UAAUN,KAAI,SAACO,EAAMC,GAAP,OAChB,+BACI,sBAAMd,QAASjC,EAAMgD,QAAS,YAAWD,EAAQ,EAAG,YAAU,IAC1D9C,UAAS,iBAAYD,EAAMiD,YAAYC,SAAWH,EAAQ,GAAgC,MAA3B/C,EAAMiD,YAAYpC,KAAe,eAAiB,IADrH,SAEKiC,EAAKK,IAEV,sBAAMlB,QAASjC,EAAMgD,QAAS,YAAWD,EAAQ,EAAG,YAAU,IAC1D9C,UAAS,iBAAYD,EAAMiD,YAAYC,SAAWH,EAAQ,GAAgC,MAA3B/C,EAAMiD,YAAYpC,KAAe,eAAiB,IADrH,SAEKiC,EAAKM,MAPLL,YCGlBM,G,MARA,SAACrD,GACZ,OACI,sBAAKC,UAAU,cAAf,UACKD,EAAMsD,OAAOC,KADlB,IACyBvD,EAAMsD,OAAOzB,MADtC,OACiD7B,EAAMsD,OAAO1B,MAD9D,IACsE5B,EAAMsD,OAAOE,YCW5EC,G,MAXO,SAACzD,GACnB,OACI,sBAAKC,UAAU,cAAf,UACI,sBAAM,YAAU,QAAQgC,QAASjC,EAAMgD,QAAvC,SAAiD,qBAAK9C,ICTnD,6jBDS+DD,UAAU,cAAcG,IAAI,YAC9F,sBAAM,YAAU,OAAO6B,QAASjC,EAAMgD,QAAtC,SAAgD,qBAAK9C,IEVlD,iSFU6DD,UAAU,cAAcG,IAAI,WAC5F,sBAAM,YAAU,QAAQH,UAAU,SAASgC,QAASjC,EAAMgD,QAA1D,oBACA,sBAAM,YAAU,OAAOf,QAASjC,EAAMgD,QAAtC,SAAgD,qBAAK9C,IGZlD,qSHY6DD,UAAU,cAAcG,IAAI,WAC5F,sBAAM,YAAU,OAAO6B,QAASjC,EAAMgD,QAAtC,SAAgD,qBAAK9C,IIblD,qjBJa6DD,UAAU,cAAcG,IAAI,gBKYzFsD,G,MAvBE,SAAC1D,GACd,OACI,qBAAKC,UAAU,YAAf,SACI,6BAEQD,EAAM2D,MAAMpB,KAAI,SAACH,EAAMW,GAAP,OACZ,6BACI,sBAAK9C,UAAU,eAAf,UACI,uBAAMA,UAAU,oBAAhB,UACCmC,EAAKT,UAAUiC,MADhB,IACwBxB,EAAKT,UAAUkC,KADvC,IAC8CzB,EAAKT,UAAU4B,KAD7D,IACmE,uBAClEnB,EAAKT,UAAUE,MAFhB,KAEyBO,EAAKT,UAAUmC,SAFxC,KAEoD,KAFpD,IAE2D1B,EAAKT,UAAUC,MAF1E,KAEmFQ,EAAKT,UAAUoC,SAFlG,MAE+G,KAF/G,IAEsH3B,EAAKT,UAAU6B,UAErI,sBAAMvD,UAAU,gBAAgB,aAAYmC,EAAK4B,GAAI/B,QAASjC,EAAMiE,WACpE,sBAAMhE,UAAS,wBAAoBD,EAAMkE,OAAqB,GAAX,UAAiB,aAAY9B,EAAK4B,GAAI/B,QAASjC,EAAMmE,iBAPvGpB,YCKlBqB,G,MAVE,SAACpE,GACd,OACI,sBAAKC,UAAU,YAAf,UACI,qBAAK,cAAY,YAAYA,UAAS,UAAKD,EAAMqE,YAAc,GAAK,UAAYpC,QAASjC,EAAMsE,SAA/F,mBACA,qBAAK,cAAY,WAAWrC,QAASjC,EAAMsE,SAA3C,wBACA,qBAAK,cAAY,YAAYrC,QAASjC,EAAMsE,SAA5C,2BCuDKC,EAvDJ,SAACvE,GACZ,IAAIwE,EAASxE,EAAMoC,KAAKoC,OACpBC,EAAWzE,EAAMyE,SACrB,OAAGD,IAAWC,EAASC,UAEjB,eAAC,IAAMjC,SAAP,WACA,cAAC,EAAD,CAAU6B,SAAYtE,EAAMsE,SAAUD,YAAarE,EAAMoC,KAAKuC,YAAc3E,EAAMoC,KAAKuC,WAAa,IACpG,sBAAK1E,UAAU,YAAf,UACE,oBAAIA,UAAU,cAAd,SAA6BD,EAAMoC,KAAKwC,aACxC,0BAAUZ,GAAG,aAAa/D,UAAU,aAAa4E,KAAK,QACtD,wBAAQ5C,QAASjC,EAAM8E,QAAvB,sBAKCN,IAAWC,EAASM,SAEzB,eAAC,IAAMtC,SAAP,WACA,cAAC,EAAD,CAAU6B,SAAYtE,EAAMsE,SAAUD,eAAarE,EAAMoC,KAAKuC,YAAc3E,EAAMoC,KAAKuC,WAAWzD,OAAS,KAC3G,sBAAKjB,UAAU,YAAf,UACE,oBAAIA,UAAU,mBAAd,SAAkCD,EAAMoC,KAAKwC,aAC7C,cAAC,EAAD,CAAUjB,MAAO3D,EAAMoC,KAAKuB,MAAOQ,WAAYnE,EAAMmE,WAAYF,SAAUjE,EAAMiE,SAAUC,OAAQlE,EAAMoC,KAAK4C,iBAK3GR,IAAWC,EAASQ,aAAeT,IAAWC,EAASS,SAAUV,IAAWC,EAASU,KAE1F,sBAAKlF,UAAU,YAAf,UACE,oBAAIA,UAAU,cAAd,SAA6BD,EAAMoC,KAAKwC,aACxC,mBAAG3E,UAAU,eAAb,SAA6BD,EAAMoC,KAAKgD,kBAItCZ,IAAWC,EAASY,UAEtB,eAAC,IAAM5C,SAAP,WACA,cAAC,EAAD,CAAU6B,SAAYtE,EAAMsE,SAAUD,YAAarE,EAAMoC,KAAKuC,YAAc3E,EAAMoC,KAAKuC,WAAa,IACpG,sBAAK1E,UAAU,aAAf,UACE,cAAC,EAAD,CAAQqD,OAAUtD,EAAMoC,KAAKT,YAC7B,cAAC,EAAD,CAAOkB,UAAa7C,EAAMoC,KAAKkD,QAASrC,YAAajD,EAAMoC,KAAKmD,KAAMvC,QAAWhD,EAAMgD,UACvF,cAAC,EAAD,CAAeA,QAAWhD,EAAMgD,gBAMlC,sBAAK/C,UAAU,YAAf,UACE,oBAAIA,UAAU,cAAd,iBACA,mBAAGA,UAAU,eAAb,uDCzDJuF,EAAkB,SAACC,GACrB,OAAOA,IAAMA,EAAEC,eCiXbC,EAAmC,SAACC,EAAcC,GAGtD,IAAK,IAAIC,EAAI,EAAGA,EAAI,EAAGA,IACrB,GAAIA,IAAMF,EAAaG,QAAvB,CACA,IAAIC,EAAe,CACjB,OAAUJ,EAAaK,WACvB,IAAOH,GAE2B,IAA/BF,EAAaM,eAAuBF,EAAaG,MAAQP,EAAaM,eACtC,KAAlCN,EAAaQ,kBAA2BJ,EAAaK,SAAWT,EAAaQ,kBAC9ER,EAAaU,kBAAkBC,KAAKP,GAMxC,IAAK,IAAIP,EAAI,EAAGA,EAAI,EAAGA,IACrB,GAAII,EAAeJ,KAAOG,EAAaK,WAAvC,CACA,IAAID,EAAe,CACjB,OAAUH,EAAeJ,GACzB,IAAOG,EAAaG,SAEc,IAA/BH,EAAaM,eAAuBF,EAAaG,MAAQP,EAAaM,eACtC,KAAlCN,EAAaQ,kBAA2BJ,EAAaK,SAAWT,EAAaQ,kBAC9ER,EAAaU,kBAAkBC,KAAKP,KAKpCQ,EAAmC,SAACZ,EAAaC,GAEvB,gBAA1BD,EAAaa,UACfb,EAAaU,kBAAkBC,KAAK,CAClC,OAAU,IACV,IAAiC,MAA1BX,EAAac,SAAmB,EAAI,IAE7Cd,EAAae,eAAeL,kBAAkBC,KAAK,CACjD,OAAU,IACV,IAAiC,MAA1BX,EAAac,SAAmB,EAAI,IAE7Cd,EAAaa,SAAW,OACxBb,EAAae,eAAeF,SAAW,QACJ,iBAA1Bb,EAAaa,UACtBb,EAAaU,kBAAkBC,KAAK,CAClC,OAAU,IACV,IAAiC,MAA1BX,EAAac,SAAmB,EAAI,IAE7Cd,EAAae,eAAeL,kBAAkBC,KAAK,CACjD,OAAU,IACV,IAAiC,MAA1BX,EAAac,SAAmB,EAAI,IAE7Cd,EAAaa,SAAW,OACxBb,EAAae,eAAeF,SAAW,QAGvCb,EAAagB,cAAe,GAI1BC,EAAmC,SAACjB,EAAaC,GACrD,GAA6B,IAAzBD,EAAaG,SAA2C,MAA1BH,EAAac,UAA8C,SAA1Bd,EAAaa,SAC9Eb,EAAaU,kBAAkBC,KAAK,CAClC,OAAUX,EAAaK,WACvB,IAAO,IAETL,EAAaU,kBAAkBC,KAAK,CAClC,OAAUX,EAAaK,WACvB,IAAO,SAEJ,GAA6B,IAAzBL,EAAaG,SAA2C,MAA1BH,EAAac,UAA8C,SAA1Bd,EAAaa,SACrFb,EAAaU,kBAAkBC,KAAK,CAClC,OAAUX,EAAaK,WACvB,IAAO,IAETL,EAAaU,kBAAkBC,KAAK,CAClC,OAAUX,EAAaK,WACvB,IAAO,SAEJ,GAA8B,SAA1BL,EAAaa,SACtBb,EAAaU,kBAAkBC,KAAK,CAClC,OAAUX,EAAaK,WACvB,IAAiC,MAA1BL,EAAac,SAAmBd,EAAaG,QAAU,EAAIH,EAAaG,QAAU,SAEtF,GAA8B,SAA1BH,EAAaa,SAEtB,GAAsC,KAAlCb,EAAaQ,iBACfR,EAAaU,kBAAkBC,KAAK,CAClC,OAAUX,EAAaQ,iBACvB,IAAiC,MAA1BR,EAAac,SAAmBd,EAAaG,QAAU,EAAIH,EAAaG,QAAU,QAEtF,CACL,IAAIe,EAAgBjB,EAAekB,QAAQnB,EAAaK,YAClC,IAAlBa,EACFlB,EAAaU,kBAAkBC,KAAK,CAClC,OAAUV,EAAe,GACzB,IAAiC,MAA1BD,EAAac,SAAmBd,EAAaG,QAAU,EAAIH,EAAaG,QAAU,IAGhE,IAAlBe,EACTlB,EAAaU,kBAAkBC,KAAK,CAClC,OAAUV,EAAe,GACzB,IAAiC,MAA1BD,EAAac,SAAmBd,EAAaG,QAAU,EAAIH,EAAaG,QAAU,KAI3FH,EAAaU,kBAAkBC,KAAK,CAClC,OAAUV,EAAeiB,EAAgB,GACzC,IAAiC,MAA1BlB,EAAac,SAAmBd,EAAaG,QAAU,EAAIH,EAAaG,QAAU,IAG3FH,EAAaU,kBAAkBC,KAAK,CAClC,OAAUV,EAAeiB,EAAgB,GACzC,IAAiC,MAA1BlB,EAAac,SAAmBd,EAAaG,QAAU,EAAIH,EAAaG,QAAU,UAM/FH,EAAaoB,SAAU,GAIrBC,EAAqC,SAACrB,EAAaC,GASzD,IAPC,IAAIqB,EAAStB,EAAaG,QAEtBoB,EAAStB,EAAekB,QAAQnB,EAAaK,YAD3B,EAInBR,EAAI0B,EAAS,EACbrB,EAAIoB,EAAS,EACR1E,EAAI,EAAGA,EAAI,EAAGA,IAAK,CAC1B,GAAIiD,EAAI,GAAKK,EAAI,EAAG,CAClB,IAAIE,EAAe,CACjB,OAAUH,EAAeJ,EATR,GAUjB,IAAOK,GAE2B,IAA/BF,EAAaM,eAAuBF,EAAaG,MAAQP,EAAaM,eACtC,KAAlCN,EAAaQ,kBAA2BJ,EAAaK,SAAWT,EAAaQ,kBAC9ER,EAAaU,kBAAkBC,KAAKP,GAGxCP,IACAK,IAIDL,EAAI0B,EAAS,EACbrB,EAAIoB,EAAS,EACb,IAAK,IAAI1E,EAAI,EAAGA,EAAI,EAAGA,IAAK,CAC1B,GAAIiD,EAAI,GAAKK,EAAI,EAAG,CAClB,IAAIE,EAAe,CACjB,OAAUH,EAAeJ,EA3BT,GA4BhB,IAAOK,GAE2B,IAA/BF,EAAaM,eAAuBF,EAAaG,MAAQP,EAAaM,eACtC,KAAlCN,EAAaQ,kBAA2BJ,EAAaK,SAAWT,EAAaQ,kBAC9ER,EAAaU,kBAAkBC,KAAKP,GAGxCP,IACAK,IAGFL,EAAI0B,EAAS,EACbrB,EAAIoB,EAAS,EACb,IAAK,IAAI1E,EAAI,EAAGA,EAAI,EAAGA,IAAK,CAC3B,GAAIiD,EAAK,GAAKK,EAAI,EAAG,CACnB,IAAIE,EAAe,CACjB,OAAUH,EAAeJ,EA5CR,GA6CjB,IAAOK,GAE2B,IAA/BF,EAAaM,eAAuBF,EAAaG,MAAQP,EAAaM,eACtC,KAAlCN,EAAaQ,kBAA2BJ,EAAaK,SAAWT,EAAaQ,kBAC9ER,EAAaU,kBAAkBC,KAAKP,GAGxCP,IACAK,IAGDL,EAAI0B,EAAO,EACXrB,EAAIoB,EAAO,EACV,IAAI,IAAI1E,EAAI,EAAGA,EAAI,EAAGA,IAAI,CACvB,GAAIiD,EAAI,GAAKA,EAAI,EAAG,CAClB,IAAIO,EAAe,CACjB,OAAUH,EAAeJ,EA7DX,GA8Dd,IAAOK,GAE2B,IAA/BF,EAAaM,eAAuBF,EAAaG,MAAQP,EAAaM,eACtC,KAAlCN,EAAaQ,kBAA2BJ,EAAaK,SAAWT,EAAaQ,kBAC9ER,EAAaU,kBAAkBC,KAAKP,GAGxCP,IACAK,MAICsB,EAAqC,SAACxB,EAAaC,GAEjD,IAAIqB,EAAStB,EAAaG,QAEtBoB,EAAStB,EAAekB,QAAQnB,EAAaK,YAD3B,EAGtB,GAAGiB,EAAS,EAAI,GAAKC,EAAS,EAAI,EAAE,CAClC,IAAInB,EAAe,CAAC,OAASH,EAAesB,EAAS,EAJjC,GAIsD,IAAMD,EAAS,GACtD,IAA/BtB,EAAaM,eAAuBF,EAAaG,MAAQP,EAAaM,eACpC,KAAlCN,EAAaQ,kBAA2BJ,EAAaK,SAAWT,EAAaQ,kBAC/ER,EAAaU,kBAAkBC,KAAKP,GAIxC,GAAGkB,EAAS,EAAI,GAAKC,EAAS,EAAI,EAAE,CAClC,IAAInB,EAAe,CAAC,OAASH,EAAesB,EAAS,EAZjC,GAYsD,IAAMD,EAAS,GACtD,IAA/BtB,EAAaM,eAAuBF,EAAaG,MAAQP,EAAaM,eACpC,KAAlCN,EAAaQ,kBAA2BJ,EAAaK,SAAWT,EAAaQ,kBAC/ER,EAAaU,kBAAkBC,KAAKP,GAIxC,GAAGkB,EAAS,EAAI,GAAKC,EAAS,EAAI,EAAE,CAClC,IAAInB,EAAe,CAAC,OAASH,EAAesB,EAAS,EApBjC,GAoBsD,IAAMD,EAAS,GACtD,IAA/BtB,EAAaM,eAAuBF,EAAaG,MAAQP,EAAaM,eACpC,KAAlCN,EAAaQ,kBAA2BJ,EAAaK,SAAWT,EAAaQ,kBAC/ER,EAAaU,kBAAkBC,KAAKP,GAIxC,GAAGkB,EAAS,EAAI,GAAKC,EAAS,EAAI,EAAE,CAClC,IAAInB,EAAe,CAAC,OAASH,EAAesB,EAAS,EA5BjC,GA4BsD,IAAMD,EAAS,GACtD,IAA/BtB,EAAaM,eAAuBF,EAAaG,MAAQP,EAAaM,eACpC,KAAlCN,EAAaQ,kBAA2BJ,EAAaK,SAAWT,EAAaQ,kBAC/ER,EAAaU,kBAAkBC,KAAKP,GAIxC,GAAGkB,EAAS,EAAI,GAAKC,EAAS,EAAI,EAAE,CAClC,IAAInB,EAAe,CAAC,OAASH,EAAesB,EAAS,EApCjC,GAoCsD,IAAMD,EAAS,GACtD,IAA/BtB,EAAaM,eAAuBF,EAAaG,MAAQP,EAAaM,eACpC,KAAlCN,EAAaQ,kBAA2BJ,EAAaK,SAAWT,EAAaQ,kBAC/ER,EAAaU,kBAAkBC,KAAKP,GAIxC,GAAGkB,EAAS,EAAI,GAAKC,EAAS,EAAI,EAAE,CAClC,IAAInB,EAAe,CAAC,OAASH,EAAesB,EAAS,EA5CjC,GA4CsD,IAAMD,EAAS,GACtD,IAA/BtB,EAAaM,eAAuBF,EAAaG,MAAQP,EAAaM,eACpC,KAAlCN,EAAaQ,kBAA2BJ,EAAaK,SAAWT,EAAaQ,kBAC/ER,EAAaU,kBAAkBC,KAAKP,GAIxC,GAAGkB,EAAS,EAAI,GAAKC,EAAS,EAAI,EAAE,CAClC,IAAInB,EAAe,CAAC,OAASH,EAAesB,EAAS,EApDjC,GAoDsD,IAAMD,EAAS,GACtD,IAA/BtB,EAAaM,eAAuBF,EAAaG,MAAQP,EAAaM,eACpC,KAAlCN,EAAaQ,kBAA2BJ,EAAaK,SAAWT,EAAaQ,kBAC/ER,EAAaU,kBAAkBC,KAAKP,GAIxC,GAAGkB,EAAS,EAAI,GAAKC,EAAS,EAAI,EAAE,CAClC,IAAInB,EAAe,CAAC,OAASH,EAAesB,EAAS,EA5DjC,GA4DsD,IAAMD,EAAS,GACtD,IAA/BtB,EAAaM,eAAuBF,EAAaG,MAAQP,EAAaM,eACpC,KAAlCN,EAAaQ,kBAA2BJ,EAAaK,SAAWT,EAAaQ,kBAC/ER,EAAaU,kBAAkBC,KAAKP,KA+C1CqB,EAAgB,SAAC9B,GACrB,OAAuB,IAAhBA,EAAKrC,OAAe,EAAqB,GAAfqC,EAAKrC,OAAO,IAAuB,MAAdqC,EAAK1E,KAAe,EAAI,IC3qB1EyG,E,WACJ,WAAYtH,GAAQ,IAAD,gCAIjBuH,WAAa,WACX,IAAMC,EAAM,qCAAuC,EAAKC,IACxD,OAAO,IAAIC,SAAQ,SAAUC,EAASC,GAClC,IAAIC,EAAM,IAAIC,eACdD,EAAIE,KAAK,MAAOP,GAChBK,EAAIG,OAAS,WACX,GAAIC,KAAKzD,QAAU,KAAOyD,KAAKzD,OAAS,IACtC,IACE,IAAIlC,EAAO4F,KAAKC,MAAMN,EAAIO,UAC1BT,EAAQrF,GAER,MAAO+F,GACPT,EAAOS,QAGTT,EAAOC,EAAIS,aAGfT,EAAIU,QAAU,WACZX,EAAOC,EAAIS,aAEbT,EAAIW,WAzBO,KA6BjBC,UAAY,SAACnG,GACX,IAAMkF,EAAM,qCAAuC,EAAKC,IACxD,OAAO,IAAIC,SAAQ,SAAUC,EAASC,GAClC,IAAIC,EAAM,IAAIC,eACdD,EAAIE,KAAK,MAAOP,GAAI,GACpBK,EAAIa,iBAAiB,eAAgB,mCACrCb,EAAIG,OAAS,WACX,GAAIC,KAAKzD,QAAU,KAAOyD,KAAKzD,OAAS,IACtC,IACEmD,EAAQ,MAER,MAAOU,GACPT,EAAO,WAGTA,EAAO,OAGXC,EAAIU,QAAU,WACZX,EAAO,OAETC,EAAIW,KAAKN,KAAKS,UAAUrG,QAjDhC2F,KAAKR,IAAM,qB,4CAqDT,SAASnF,GACP,GAAwB,qBAAbsG,QACX,IACEC,aAAaC,QAAQ,QAASZ,KAAKS,UAAUrG,IAC9C,MAAM+F,O,uBAMT,WACI,OAAO,IAAIX,SAAQ,SAAUC,EAASC,GAClC,GAAwB,qBAAbgB,QACThB,EAAO,mCAEP,GAAsC,OAAlCiB,aAAaE,QAAQ,SAAmB,CAC1C,IAAIC,EAAWH,aAAaE,QAAQ,SACpC,IAEIpB,EADWO,KAAKC,MAAMa,IAExB,MAAOX,GACLT,EAAOS,Y,KC1ErBY,EAAa,SAACC,EAActD,EAAaC,GAC/C,IAAIsD,EAAM,GACNC,EAAY,GAEZC,EAAc,EACdC,EAAgB,GA8BhB,MA7BJ,CAAC,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,EAAE,GAAGnI,SAAQ,SAACgF,GACvBgD,GAAKC,EACLA,EAAY,IACZC,EAAc,EACdxD,EAAe1E,SAAQ,SAACC,EAAEmI,GAGD,QADrBD,EAAgBJ,EADE,GAAT/C,EAAI,GAASoD,GACe5G,KAEjC0G,KAEGA,EAAc,IACbF,GAAKE,EAAY,GACjBA,EAAc,GAEa,MAA5BC,EAAcE,OAAO,GACpBL,GAAKG,EAAcE,OAAO,GAAGC,cAE7BN,GAAKG,EAAcE,OAAO,GAAG9D,kBAItC2D,EAAc,IACbF,GAAKE,EAAY,GACjBA,EAAc,MAKtBF,GAAO,IAAMvD,EAAac,SAAW,UAAYd,EAAa1C,QCyjB/CwG,E,kDArlBb,WAAY1J,GAAQ,IAAD,8BACjB,gBAgEFkC,aAAc,SAACmG,GACb,IAAIsB,GAAY,EAAKC,MAAMvH,eAC3B,EAAKwH,UAAS,SAACD,EAAO5J,GAAR,MACZ,CACE,eAAkB2J,OArEL,EA0EnBxF,WAAY,SAACkE,GACX,IAAIrE,EAAK8F,OAAOzB,EAAE0B,cAAcC,aAAa,eAC7C,EAAKC,aAAajG,IA5ED,EA+EnBC,SAAW,SAACoE,GACV,IAAIrE,EAAK8F,OAAOzB,EAAE0B,cAAcC,aAAa,eAC7C,EAAKE,WAAWlG,IAjFC,EAoFnBiG,aAAe,SAACjG,GACd,IAAImG,EAAO,eACX,GAAI,EAAKP,MAAM5E,UAAY,EAAK4E,MAAMQ,eAAgB,CACpD,IAAIzG,EAAQ,EAAKiG,MAAMjG,MAAM0G,QAAO,SAACjI,GACnC,OAAOA,EAAK4B,KAAOA,KAGjBsG,EAAa,CACf3G,MAAOA,GAGTwG,EAAQP,MAAMQ,eAAe3B,UAAU9E,GACpC4G,MAAK,SAAUnC,GACd,GAAiB,OAAbA,EAAmB,CACrB+B,EAAQP,MAAMQ,eAAeI,SAAS7G,GACtC,IAAI8G,EAAY9G,GAASA,EAAMzC,OAAS,EAAIiJ,EAAQO,WAAW3F,SAAWoF,EAAQO,WAAWhG,UAC7FyF,EAAQQ,cAAcF,EAAW,GAAIH,OAGxCM,OAAM,SAAUxC,SAvGJ,EA6GnB8B,WAAa,SAAClG,GACZ,IAAI6G,EAAc,EAAKjB,MAAMjG,MAAM0G,QAAO,SAACjI,GACzC,OAAOA,EAAK4B,KAAOA,KAErB,GAA2B,IAAvB6G,EAAY3J,OAAc,CAC5B,IAAIkB,EAAOyI,EAAY,GACnBP,EAAa,CACf,KAAQpC,KAAKC,MAAM,EAAKyB,MAAMkB,aAC9B,UAAa1I,EAAKT,UAClB,WAAcS,EAAKuC,WACnB,QAAWvC,EAAKkD,QAChB,QAAWlD,EAAK2I,QAChB,KAAQ,CACN,OAAU,EACV,KAAQ,KAEV,OAAU,CACR,WAAc,EACd,WAAc,EACd,UAAa,GACb,UAAa,KAGjB,EAAKJ,cAAc,EAAKD,WAAWrF,UAAW,GAAIiF,KApInC,EAwInBU,WAAa,SAACC,GACZ,IAAIC,EAAS,GACT,SAAUD,GACW,UAAnBA,EAAUE,OACZD,EAAS,GAGb,IAAIjI,EAAc,EAAK2G,MAAMrE,KACzB6F,EAAU,EAAKxB,MAAMtE,QACrB4D,EAAgB,EAAKU,MAAMtH,KAC3BuD,EAAiB,EAAK+D,MAAMyB,QAAQC,MAAM,GAC1C1F,EHnFc,SAACsD,EAAcjG,EAAYgI,EAAUpF,GACvD,IAAI0F,EAAkBlE,EAAc4D,GAChCO,EAAoBnE,EAAcpE,GAClC2C,EAAe,CACjBc,SAAS,GACTT,WAAa,GACbF,QAAU,EACV0F,cAAgB,KAChBhF,SAAW,KACXiF,SAAU,EACVC,OAAQ,EACR3E,SAAU,EACV4E,QAAS,EACTtF,kBAAoB,GACpBK,eAAiB,KACjBT,cAAgB,EAChBE,iBAAmB,GACnBQ,cAAa,EACbiF,UAAU,KACV3I,OAAO,GAGT,GAAGqI,EAAkBC,EAAkB,CACrC5F,EAAagG,QAAS,EACtB,IACIE,EAAmB,IADoB,IAAtBN,EAA0BA,EAAoB,EAAIA,EAAkB,GAErE,IAAM,GACxBM,EAAiB5I,OAAS6I,KAAKC,MAAMR,EAAkB,GAAG,EAC1DM,EAAiBjL,KAAO,MAExBiL,EAAiB5I,QAAUsI,EAAkB,GAAG,EAChDM,EAAiBjL,KAAO,KAG1B,IAAIoL,EAAW/C,EAAc4C,EAAiB5I,OAAO,GAAG4I,EAAiBjL,MAoBzE,GAnBA+E,EAAac,SAAWoF,EAAiBjL,KACzC+E,EAAa1C,OAAS4I,EAAiB5I,OACvC+I,EAAWA,EAASC,QAAQ,OAAO,IAEnCtG,EAAaa,SAAW,QAEc,IAA3BwF,EAASlF,QAAQ,OAE1BkF,EAAWA,EAASC,QAAQ,IAAI,IAChCtG,EAAaa,SAAW,QAGgB,MAAvCwF,EAASzC,OAAOyC,EAAS/K,OAAO,IAAqD,MAAvC+K,EAASzC,OAAOyC,EAAS/K,OAAO,IAC/E0E,EAAa+F,OAAQ,EACrBM,EAAWA,EAASE,UAAU,EAAEF,EAAS/K,OAAO,IACF,MAAvC+K,EAASzC,OAAOyC,EAAS/K,OAAO,KACvC0E,EAAa8F,SAAU,EACvBO,EAAWA,EAASE,UAAU,EAAEF,EAAS/K,OAAO,IAE3B,IAApB+K,EAAS/K,OACV0E,EAAa6F,cAAgB,IAC7B7F,EAAaK,WAAagG,EAASzC,OAAO,GAC1C5D,EAAaG,QAAUqG,SAASH,EAASzC,OAAO,IAC7C6C,MAAMzG,EAAaG,WACpBH,EAAaoB,SAAU,QAEpB,GAAuB,IAApBiF,EAAS/K,OACC,QAAb+K,GAAmC,QAAbA,GACvBrG,EAAa6F,cAAgB,IAC7B7F,EAAaK,WAAa,IAC1BL,EAAaG,QAAoC,MAA1BH,EAAac,SAAmB,EAAI,EAC3Dd,EAAaa,SAAW,cACxBb,EAAaU,kBAAoB,GACjCV,EAAae,eAAiB,CAC5BD,SAASd,EAAac,SACtBT,WAAa,IACbF,QAAWH,EAAaG,QACxB0F,cAAgB,IAChBhF,SAAWb,EAAaa,SACxBiF,SAAU,EACV1E,SAAU,EACVV,kBAAoB,MAGJd,EAAgByG,EAASzC,OAAO,KAEhD5D,EAAa6F,cAAgB,IAC7B7F,EAAaQ,iBAAmB6F,EAASzC,OAAO,GAChD5D,EAAaK,WAAagG,EAASzC,OAAO,GAC1C5D,EAAaG,QAAUqG,SAASH,EAASzC,OAAO,MAEhD5D,EAAa6F,cAAgBQ,EAASzC,OAAO,GAC7C5D,EAAaK,WAAagG,EAASzC,OAAO,GAC1C5D,EAAaG,QAAUqG,SAASH,EAASzC,OAAO,KAE/C6C,MAAMzG,EAAaG,WACpBH,EAAaoB,SAAU,SAGzB,GAAuB,IAApBiF,EAAS/K,OAChB,GAA0B,MAAvB+K,EAASzC,OAAO,GACjB5D,EAAaiG,UAAYI,EAASzC,OAAO,GACzC5D,EAAa6F,cAAgB,IAC7B7F,EAAaK,WAAagG,EAASzC,OAAO,GAC1C5D,EAAaG,QAAUqG,SAASH,EAASzC,OAAO,QAC7C,CACH5D,EAAa6F,cAAgBQ,EAASzC,OAAO,GAC7C,IAAI8C,EAAaL,EAASzC,OAAO,GAC7B6C,MAAMD,SAASE,IAGjB1G,EAAaQ,iBAAmBkG,EAFhC1G,EAAaM,cAAgBkG,SAASE,GAIxC1G,EAAaK,WAAagG,EAASzC,OAAO,GAC1C5D,EAAaG,QAAUqG,SAASH,EAASzC,OAAO,IAC7C6C,MAAMzG,EAAaG,WACpBH,EAAaoB,SAAU,OAGP,UAAbiF,GAAqC,UAAbA,GAC/BrG,EAAa6F,cAAgB,IAC7B7F,EAAaK,WAAa,IAC1BL,EAAaG,QAAoC,MAA1BH,EAAac,SAAmB,EAAI,EAC3Dd,EAAaa,SAAW,eACxBb,EAAaU,kBAAoB,GACjCV,EAAae,eAAiB,CAC5BD,SAASd,EAAac,SACtBT,WAAa,IACbF,QAAUH,EAAaG,QACvB0F,cAAgB,IAChBhF,SAAWb,EAAaa,SACxBiF,SAAU,EACV1E,SAAU,EACVV,kBAAoB,KAItBV,EAAaoB,SAAU,EAGrBpB,EAAaoB,UACfpB,EAAaU,kBAAoB,GACC,MAA/BV,EAAa6F,cACd5E,EAAiCjB,EAAaC,GACR,MAA/BD,EAAa6F,cACpBrE,EAAmCxB,EAAaC,GACV,MAA/BD,EAAa6F,cACpBxE,EAAmCrB,EAAaC,GACV,MAA/BD,EAAa6F,cACpB9F,EAAiCC,EAAaC,GACR,MAA/BD,EAAa6F,cACpBjF,EAAiCZ,EAAaC,GACL,MAA/BD,EAAa6F,gBACtB7F,EAAagB,cAAe,IAKnC,OAAOhB,EGtEY2G,CAAYnB,EAASnI,EAAagI,EAAWpF,GAEhE,IAAKD,EAAaoB,UAAYpB,EAAagG,OAAQ,CACjD,IAAIY,GAAW,EACf,GAAI5G,EAAaU,mBAAqBV,EAAaU,kBAAkBpF,OAAS,EAAG,CAC/E,IAAK,IAAIsB,EAAI,EAAGA,EAAIoD,EAAaU,kBAAkBpF,SAC7CsL,EADqDhK,IAEzD,IAAK,IAAIiK,EAAI,EAAGA,EAAIvD,EAAchI,OAAQuL,IACxC,GAAIvD,EAAcuD,GAAGpG,SAAWT,EAAaU,kBAAkB9D,GAAG6D,QAAU6C,EAAcuD,GAAGtG,MAAQP,EAAaU,kBAAkB9D,GAAG2D,KACjI+C,EAAcuD,GAAG9J,MAASiD,EAAa6F,cAAgB7F,EAAac,SAAShB,cAAgB,CAC/F8G,GAAW,EACXtD,EAAcuD,GAAG9J,IAAM,KACvB,MAMR,GAAoC,OAAhCiD,EAAae,eAAyB,CAGxC,IAFA,IAAI+F,EAAeF,EACfG,GAAe,EACVnK,EAAI,EAAGA,EAAI0G,EAAchI,OAAQsB,IAEpC0G,EAAc1G,GAAG6D,SAAWT,EAAae,eAAeL,kBAAkB,GAAGD,QAAU6C,EAAc1G,GAAG2D,MAAQP,EAAae,eAAeL,kBAAkB,GAAGH,KAC/J+C,EAAc1G,GAAGG,MAAQiD,EAAae,eAAe8E,cAAgB7F,EAAae,eAAeD,SAAShB,gBAC5GiH,GAAe,EACfzD,EAAc1G,GAAGG,IAAM,MAI7B6J,EAAWE,GAAgBC,GAG/B,IAAkC,IAA9B/G,EAAagB,aACf,IAAK,IAAIpE,EAAI,EAAGA,EAAI0G,EAAchI,OAAQsB,IACxC,GAAI0G,EAAc1G,GAAGG,MAAQiD,EAAa6F,cAAgB7F,EAAac,SAAShB,cAAe,CAC7F8G,GAAW,EACXtD,EAAc1G,GAAGG,IAAM,KACvB,MAIN,GAAI6J,EAAU,CACZ,IAAK,IAAIhK,EAAI,EAAGA,EAAI0G,EAAchI,OAAQsB,IACxC,GAAI0G,EAAc1G,GAAG6D,SAAWT,EAAaK,YAAciD,EAAc1G,GAAG2D,MAAQP,EAAaG,QAAS,CACxG,GAA8B,SAA1BH,EAAaa,SAAqB,CACpC,GAA6B,OAAzByC,EAAc1G,GAAGG,KAA+C,MAA/BiD,EAAa6F,cAAuB,CACvE,IAAImB,EAAkC,MAA1BhH,EAAac,SAAmB,GAAK,EACjDwC,EAAc1G,EAAIoK,GAAOjK,IAAM,KAEjCuG,EAAc1G,GAAGG,IAAMiD,EAAa6F,cAAgB7F,EAAac,SAAShB,mBAG1EwD,EAAc1G,GAAGG,IAAMiD,EAAaiG,UAAYjG,EAAaiG,UAAYjG,EAAac,SAAShB,cAAgBE,EAAa6F,cAAgB7F,EAAac,SAAShB,cAEpK,MAGJ,GAAmC,MAA/BE,EAAae,eACf,IAAK,IAAInE,EAAI,EAAGA,EAAI0G,EAAchI,OAAQsB,IACxC,GAAI0G,EAAc1G,GAAG6D,SAAWT,EAAae,eAAeV,YAAciD,EAAc1G,GAAG2D,MAAQP,EAAae,eAAeZ,QAAS,CACtImD,EAAc1G,GAAGG,IAAMiD,EAAae,eAAe8E,cAAgB7F,EAAae,eAAeD,SAAShB,cACxG,MAKN,IAAIqF,EAAU,EAAKnB,MAAMmB,QAIzB,GAAuB,IAHTA,EAAQV,QAAO,SAACjJ,GAC5B,OAAOA,EAAE8B,SAAW0C,EAAa1C,QAAU9B,EAAEP,OAAS+E,EAAac,YAEzDxF,OAAc,CACxB,IAAIgI,EAAgB,EAAKU,MAAMtH,KAC3BuD,EAAiB,EAAK+D,MAAMyB,QAAQC,MAAM,GAC1CnC,EAAMF,EAAWC,EAAetD,EAAcC,GAC9CsD,GACF4B,EAAQxE,KAAK,CAAE,OAAUX,EAAa1C,OAAQ,KAAQ0C,EAAac,SAAU,IAAOyC,IAGxF,EAAKU,UAAS,SAACD,EAAO5J,GAAR,MACZ,CACE,KAAQkJ,EACR,KAAQ,CAAEhG,OAAQ0C,EAAa1C,OAAQrC,KAAM+E,EAAac,UAC1D,QAAWqE,EACX,OAAU,EAAKL,WAAWrF,cAG5B,IAAIwH,EAAI,eACNC,YAAW,WACTD,EAAK7B,WAAWC,KACfC,MA7OM,EAsPnB5G,SAAW,SAAC+D,GACV,IAAI0E,EAAS1E,EAAE0B,cAAcC,aAAa,eACtC+C,KAAU,EAAKrC,YACjB,EAAKC,cAAc,EAAKD,WAAWqC,KAzPpB,EA6PnB/J,QAAU,SAACqF,GACT,IAOI4C,EH5Qa,SAAC+B,EAAK/J,EAAYgK,GACnC,IAAInK,EAAO,EACPjC,EAAO,IACPoK,EAAY,KACZiC,EAAWD,EAAUA,EAAU/L,OAAO,GAC1C,GAAG,SAAU8L,EAAK,CAChB,IAAIG,EAAcH,EAAKzH,KACJ,UAAhB4H,EACDlC,EAAU,CAAC,OAAS,EAAE,KAAO,KACN,SAAhBkC,GAELlC,EADC,MAAOiC,EACE,CAAC,OAASD,EAAU/L,OAAO,KAAO,KAElC,CAAC,OAAS+L,EAAU/L,OAAO,KAAO,MAEpCiK,KAAO,QACM,UAAhBgC,GACPlC,EAAUhI,GACAkI,KAAO,OACM,SAAhBgC,GACJlK,EAAYC,QAAU,GAA0B,MAArBD,EAAYpC,KACxCoK,EAAU,CAAC,OAAS,EAAE,KAAO,MAG3BA,EADsB,MAArBhI,EAAYpC,KACH,CAAC,OAASoC,EAAYC,OAAO,KAAO,KAEpC,CAAC,OAASD,EAAYC,OAAQ,EAAG,KAAO,MAEvCA,OAAS,IACpB+H,EAAU,CAAC,OAAS,EAAE,KAAO,MAGjCA,EAAUE,KAAO,SACM,SAAhBgC,IAGHlC,EAFDhI,EAAYC,SAAW+J,EAAU/L,OACV,MAArB+B,EAAYpC,KACHoC,EAEP,MAAOiK,EACE,CAAC,OAASD,EAAU/L,OAAQ,KAAO,KAEnC+B,EAIU,MAArBA,EAAYpC,KACH,CAAC,OAASoC,EAAYC,OAAQ,EAAE,KAAO,KAEvC,CAAC,OAASD,EAAYC,OAAQ,KAAO,MAItCA,OAAS,IACpB+H,EAAU,CAAC,OAAS,EAAE,KAAO,UAK3B,SAAU+B,GAAQ,SAAUA,IAClClK,EAAOsJ,SAASY,EAAKlK,MAClBuJ,MAAMvJ,KACPA,EAAO,GAETjC,EAAOmM,EAAKnM,MAKd,OAHGiC,EAAK,IACNmI,EAAU,CAAC,OAASnI,EAAK,KAAOjC,IAE3BoK,EGwMSmC,CANZ,SAAU/E,EACLA,EAECA,EAAE0B,cAAesD,QAET,EAAKzD,MAAMrE,KACmB,EAAKqE,MAAMtE,SACvDgI,EAAU,EAAK1D,MAAMmB,QAAQV,QAAO,SAACjJ,GACvC,OAAOA,EAAE8B,SAAW+H,EAAU/H,QAAU9B,EAAEP,OAASoK,EAAUpK,QAE/D,GAAuB,IAAnByM,EAAQpM,OAAc,CACH,EAAK0I,MAAMyB,QAAQC,MAAM,GAA9C,IACIiC,EAAarF,KAAKC,MAAM,EAAKyB,MAAMkB,aAEnCtJ,EHyZW,SAACc,GACpB,IAAId,EAAS,CACX,WAAe,EACf,WAAe,EACf,UAAc,GACd,UAAc,IAEZgM,EAAa,EACbC,EAAa,EACbC,EAAO,CAAC,IAAI,IAAI,IAAI,IAAI,KACxBC,EAAa,CAAC,EAAE,EAAE,EAAE,EAAE,GAEtBC,EAAY,CACd,EAAK,EACL,EAAK,EACL,EAAK,EACL,EAAK,EACL,EAAK,GAGHC,EAAY,CACd,EAAK,EACL,EAAK,EACL,EAAK,EACL,EAAK,EACL,EAAK,GAGHC,EAAe,CACjB,EAAK,EACL,EAAK,EACL,EAAK,EACL,EAAK,EACL,EAAK,GAsBP,IAAK,IAAMC,KAnBXzL,EAAKnB,SAAQ,SAACC,EAAEoB,GACZ,GAAa,OAAVpB,EAAEuB,IAAa,CACd,IAAIqL,EAAS5M,EAAEuB,IAAI6G,OAAO,GACtByE,EAAMP,EAAK3G,QAAQiH,IACX,IAATC,IACuB,MAAlB7M,EAAEuB,IAAI6G,OAAO,IACboE,EAAUI,IAAU,EACpBR,GAAYG,EAAWM,KAEvBJ,EAAUG,IAAU,EACpBP,GAAYE,EAAWM,SAMvCzM,EAAOM,WAAa0L,EAAaC,EACjCjM,EAAOO,WAAa0L,EAAaD,EAEdI,EAEjB,IADA,IAAIM,EAAKJ,EAAaC,GAAQH,EAAUG,GAC/BvL,EAAI,EAAGA,EAAI0L,EAAI1L,IACtBhB,EAAOC,UAAU8E,KAAKwH,GAI1B,IAAK,IAAMA,KAAQF,EAEjB,IADA,IAAIK,EAAKJ,EAAaC,GAAQF,EAAUE,GAC/BvL,EAAI,EAAGA,EAAI0L,EAAI1L,IACtBhB,EAAOD,UAAUgF,KAAKwH,GAG1B,OAAOvM,EG7dU2M,CADbZ,ED5Oa,SAACpE,EAAIiF,EAAMvI,GAC1B,IAAIsD,EAAK,OAAO,KAChB,IACIkF,EADQlF,EAAImF,MAAM,KACD,GAAGA,MAAM,KAC9B,GAAuB,IAApBD,EAASnN,OAAc,OAAO,KACjC,IAAIqN,GAAa,EAmCjB,OAlCAF,EAASlN,SAAQ,SAACqN,EAAQhM,GACtB+L,EAAc,EAAF/L,EAEZ,IADA,IAAIiM,EAAaD,EAAQtN,OACjBuE,EAAI,EAAEA,EAAIgJ,EAAWhJ,IAAK,CAC9B,IAAIiJ,EAAOF,EAAQhF,OAAO/D,GACtBkJ,EAASvC,SAASsC,GACtB,GAAKrC,MAAMsC,GAKN,CACD,IAAI9N,EAAO,IACP8B,EAAM+L,EACPlJ,EAAgBkJ,IACf7N,EAAO,IAEH8B,EADS,MAAT+L,EACM,IAEAA,EAAKhJ,eAIX/C,EADS,MAAT+L,EACM,IAEAA,EAGdN,EAAMG,GAAW5L,IAAMA,EAAM9B,EAC7B0N,QAvBgB,CAChB,IAAK,IAAIK,EAAI,EAAGA,EAAID,EAAQC,IACxBR,EAAMG,EAAYK,GAAGjM,IAAM,KAE/B4L,GAAWI,OAwBhBP,ECoMQS,CAAWvB,EAAQ,GAAGnE,IAAKoE,IAGxC,EAAK1D,UAAS,SAACD,EAAO5J,GAAR,MACZ,CACEsC,KAAMiL,EACN/L,OAAOA,EACP+D,KAAM,CACJrC,OAAQ+H,EAAU/H,OAClBrC,KAAMoK,EAAUpK,YArRP,EA4RnBiE,QAAU,WAEV,EAAK6F,cAAc,EAAKD,WAAWzF,YAAa,kCAC5C,IAAI6J,EAAWC,SAASC,eAAe,cACvC,GAAgB,MAAZF,EAAkB,CACpB,IAAIG,EAAMH,EAASI,MACnB,GAAY,KAARD,EAAY,CACd,IAAIE,EAAwB,OAAOC,KAAKH,GAAKlM,MACzCsM,EAAWJ,EAAI9C,UAAU,EAAGgD,GAAuBjD,QAAQ,YAAa,KAAKoD,OAC7EhK,EAAU2J,EAAI9C,UAAUgD,EAAuBF,EAAI/N,QAAQgL,QAAQ,YAAa,KAAKoD,OAErFC,EH4WK,SAACC,GAClBA,EAAQA,EAAMlB,MAAM,KACpB,IAAIiB,EAAa,GAUjB,OATAC,EAAMrO,SAAQ,SAASsO,GACrB,IAAIC,EAAQD,EAAIvD,QAAQ,cAAe,IACnC+B,EAAMyB,EAAM3I,QAAQ,KACxB,IAAY,IAATkH,EAAW,CACZ,IAAIxG,EAAMiI,EAAMvD,UAAU,EAAE8B,GACxBiB,EAAQQ,EAAMvD,UAAU8B,EAAI,EAAEyB,EAAMxO,QACxCqO,EAAW9H,GAAOyH,MAGfK,EGxXkBI,CAAWN,GACxBE,EAAW1L,OACb0L,EAAW1L,KAAO,OAGpB,IAAI+L,EH4UK,SAACtK,GAOlB,IANA,IAKIuK,EALAD,EAAQ,GACR9M,EAAO,EACPgN,EAAoBxK,EAAQyB,QAAQjE,EAAK,KACzCiN,EAAmB,GAGM,IAAtBD,IAAiD,IAAtBC,GAAwB,CAGtDF,GADsB,KADxBE,EAAoBzK,EAAQyB,QAASjE,EAAK,EAAG,MAErCiN,EAEAD,EAAmB,IAGzB,IAAIE,EADc1K,EAAQ6G,UAAU2D,EAAkBD,GAAK3D,QAAQpJ,EAAK,IAAI,IAAIwM,OACpDhB,MAAM,KAC9B2B,EAAW,CAAC,EAAID,EAAM,IACN,IAAjBA,EAAM9O,SACP+O,EAAS7M,EAAI4M,EAAM,IAErBJ,EAAMrJ,KAAK0J,GACXH,EAAmBC,EACrBjN,IAEF,OAAO8M,EGpWaM,CAAW5K,GAEnByF,EAAU,CAAC,CAAE,OAAU,EAAG,KAAQ,IAAK,IAAO,6DAC9CoF,EAAYjI,KAAKC,MAAM,EAAKyB,MAAMkB,aAClCjF,EAAiB,EAAK+D,MAAMyB,QAAQC,MAAM,GAE9CsE,EAAMzO,SAAQ,SAAC2B,EAAMN,GACnB,CAAC,IAAK,KAAKrB,SAAQ,SAACN,GAClB,GAAIA,KAAQiC,EAAM,CAChB,IAAI8C,EHzFI,SAAC9C,EAAKjC,EAAKqN,EAAGiC,EAAUtK,GAC5C,IAAID,EAAe,CACjBc,SAAS7F,EACToF,WAAa,GACbF,QAAU,EACV0F,cAAgB,KAChBhF,SAAW,KACXiF,SAAU,EACVC,OAAQ,EACR3E,SAAU,EACV4E,QAAS,EACTtF,kBAAoB,GACpBK,eAAiB,KACjBT,cAAgB,EAChBE,iBAAmB,GACnBQ,cAAa,EACbiF,UAAU,KACV3I,OAAOgL,GAGPtI,EAAagG,QAAS,EAEtB,IAAIK,EAAoB,MAATpL,EAAeiC,EAAKK,EAAIL,EAAKM,EAiB5C,GAhBA6I,EAAWA,EAASC,QAAQ,OAAO,IACnCtG,EAAaa,SAAW,QAEc,IAA3BwF,EAASlF,QAAQ,OAE1BkF,EAAWA,EAASC,QAAQ,IAAI,IAChCtG,EAAaa,SAAW,QAGgB,MAAvCwF,EAASzC,OAAOyC,EAAS/K,OAAO,IAAqD,MAAvC+K,EAASzC,OAAOyC,EAAS/K,OAAO,IAC/E0E,EAAa+F,OAAQ,EACrBM,EAAWA,EAASE,UAAU,EAAEF,EAAS/K,OAAO,IACF,MAAvC+K,EAASzC,OAAOyC,EAAS/K,OAAO,KACvC0E,EAAa8F,SAAU,EACvBO,EAAWA,EAASE,UAAU,EAAEF,EAAS/K,OAAO,IAE3B,IAApB+K,EAAS/K,OACV0E,EAAa6F,cAAgB,IAC7B7F,EAAaK,WAAagG,EAASzC,OAAO,GAC1C5D,EAAaG,QAAUqG,SAASH,EAASzC,OAAO,IAC7C6C,MAAMzG,EAAaG,WACpBH,EAAaoB,SAAU,QAEpB,GAAuB,IAApBiF,EAAS/K,OACC,QAAb+K,GAAmC,QAAbA,GACvBrG,EAAa6F,cAAgB,IAC7B7F,EAAaK,WAAa,IAC1BL,EAAaG,QAAoC,MAA1BH,EAAac,SAAmB,EAAI,EAC3Dd,EAAaa,SAAW,cACxBb,EAAaU,kBAAoB,GACjCV,EAAae,eAAiB,CAC5BD,SAASd,EAAac,SACtBT,WAAa,IACbF,QAAWH,EAAaG,QACxB0F,cAAgB,IAChBhF,SAAWb,EAAaa,SACxBiF,SAAU,EACV1E,SAAU,EACVV,kBAAoB,MAGJd,EAAgByG,EAASzC,OAAO,KAEhD5D,EAAa6F,cAAgB,IAC7B7F,EAAaQ,iBAAmB6F,EAASzC,OAAO,GAChD5D,EAAaK,WAAagG,EAASzC,OAAO,GAC1C5D,EAAaG,QAAUqG,SAASH,EAASzC,OAAO,MAEhD5D,EAAa6F,cAAgBQ,EAASzC,OAAO,GAC7C5D,EAAaK,WAAagG,EAASzC,OAAO,GAC1C5D,EAAaG,QAAUqG,SAASH,EAASzC,OAAO,KAE/C6C,MAAMzG,EAAaG,WACpBH,EAAaoB,SAAU,SAGzB,GAAuB,IAApBiF,EAAS/K,OAChB,GAA0B,MAAvB+K,EAASzC,OAAO,GACjB5D,EAAaiG,UAAYI,EAASzC,OAAO,GACzC5D,EAAa6F,cAAgB,IAC7B7F,EAAaK,WAAagG,EAASzC,OAAO,GAC1C5D,EAAaG,QAAUqG,SAASH,EAASzC,OAAO,QAC7C,CACH5D,EAAa6F,cAAgBQ,EAASzC,OAAO,GAC7C,IAAI8C,EAAaL,EAASzC,OAAO,GAC7B6C,MAAMD,SAASE,IAGjB1G,EAAaQ,iBAAmBkG,EAFhC1G,EAAaM,cAAgBkG,SAASE,GAIxC1G,EAAaK,WAAagG,EAASzC,OAAO,GAC1C5D,EAAaG,QAAUqG,SAASH,EAASzC,OAAO,IAC7C6C,MAAMzG,EAAaG,WACpBH,EAAaoB,SAAU,OAGP,UAAbiF,GAAqC,UAAbA,GAC/BrG,EAAa6F,cAAgB,IAC7B7F,EAAaK,WAAa,IAC1BL,EAAaG,QAAoC,MAA1BH,EAAac,SAAmB,EAAI,EAC3Dd,EAAaa,SAAW,eACxBb,EAAaU,kBAAoB,GACjCV,EAAae,eAAiB,CAC5BD,SAASd,EAAac,SACtBT,WAAa,IACbF,QAAUH,EAAaG,QACvB0F,cAAgB,IAChBhF,SAAWb,EAAaa,SACxBiF,SAAU,EACV1E,SAAU,EACVV,kBAAoB,KAItBV,EAAaoB,SAAU,EAoB3B,OAjBMpB,EAAaoB,UACfpB,EAAaU,kBAAoB,GACC,MAA/BV,EAAa6F,cACd5E,EAAiCjB,EAAaC,GACR,MAA/BD,EAAa6F,cACpBrE,EAAmCxB,EAAaC,GACV,MAA/BD,EAAa6F,cACpBxE,EAAmCrB,EAAaC,GACV,MAA/BD,EAAa6F,cACpB9F,EAAiCC,EAAaC,GACR,MAA/BD,EAAa6F,cACpBjF,EAAiCZ,EAAaC,GACL,MAA/BD,EAAa6F,gBACtB7F,EAAagB,cAAe,IAI5BhB,EGhDwBwK,CAActN,EAAMjC,EAAM2B,EAAI,EAAG2N,EAAWtK,GAC/DsK,EHubO,SAACvK,EAAcsD,GACpC,IAAKtD,EAAaoB,UAAYpB,EAAagG,OAAQ,CACjD,IAAIY,GAAW,EACf,GAAI5G,EAAaU,mBAAqBV,EAAaU,kBAAkBpF,OAAS,EAAG,CAC/E,IAAK,IAAIsB,EAAI,EAAGA,EAAIoD,EAAaU,kBAAkBpF,SAC7CsL,EADqDhK,IAEzD,IAAK,IAAIiK,EAAI,EAAGA,EAAIvD,EAAchI,OAAQuL,IACxC,GAAIvD,EAAcuD,GAAGpG,SAAWT,EAAaU,kBAAkB9D,GAAG6D,QAAU6C,EAAcuD,GAAGtG,MAAQP,EAAaU,kBAAkB9D,GAAG2D,KACjI+C,EAAcuD,GAAG9J,MAASiD,EAAa6F,cAAgB7F,EAAac,SAAShB,cAAgB,CAC/F8G,GAAW,EACXtD,EAAcuD,GAAG9J,IAAM,KACvB,MAMR,GAAoC,OAAhCiD,EAAae,eAAyB,CAGxC,IAFA,IAAI+F,EAAeF,EACfG,GAAe,EACVnK,EAAI,EAAGA,EAAI0G,EAAchI,OAAQsB,IAEpC0G,EAAc1G,GAAG6D,SAAWT,EAAae,eAAeL,kBAAkB,GAAGD,QAAU6C,EAAc1G,GAAG2D,MAAQP,EAAae,eAAeL,kBAAkB,GAAGH,KAC/J+C,EAAc1G,GAAGG,MAAQiD,EAAae,eAAe8E,cAAgB7F,EAAae,eAAeD,SAAShB,gBAC5GiH,GAAe,EACfzD,EAAc1G,GAAGG,IAAM,MAI7B6J,EAAWE,GAAgBC,GAG/B,IAAkC,IAA9B/G,EAAagB,aACf,IAAK,IAAIpE,EAAI,EAAGA,EAAI0G,EAAchI,OAAQsB,IACxC,GAAI0G,EAAc1G,GAAGG,MAAQiD,EAAa6F,cAAgB7F,EAAac,SAAShB,cAAe,CAC7F8G,GAAW,EACXtD,EAAc1G,GAAGG,IAAM,KACvB,MAIN,GAAI6J,EAAU,CACZ,IAAK,IAAIhK,EAAI,EAAGA,EAAI0G,EAAchI,OAAQsB,IACxC,GAAI0G,EAAc1G,GAAG6D,SAAWT,EAAaK,YAAciD,EAAc1G,GAAG2D,MAAQP,EAAaG,QAAS,CAC1E,SAA1BH,EAAaa,UACc,OAAzByC,EAAc1G,GAAGG,KAA+C,MAA/BiD,EAAa6F,gBAEhDvC,EAAc1G,GADwB,MAA1BoD,EAAac,SAAmB,GAAK,IACxB/D,IAAM,MAEjCuG,EAAc1G,GAAGG,IAAMiD,EAAa6F,cAAgB7F,EAAac,SAAShB,eAG1EwD,EAAc1G,GAAGG,IAAMiD,EAAaiG,UAAYjG,EAAaiG,UAAYjG,EAAac,SAAShB,cAAgBE,EAAa6F,cAAgB7F,EAAac,SAAShB,cAEpK,MAGJ,GAAmC,MAA/BE,EAAae,eACf,IAAK,IAAInE,EAAI,EAAGA,EAAI0G,EAAchI,OAAQsB,IACxC,GAAI0G,EAAc1G,GAAG6D,SAAWT,EAAae,eAAeV,YAAciD,EAAc1G,GAAG2D,MAAQP,EAAae,eAAeZ,QAAS,CACtImD,EAAc1G,GAAGG,IAAMiD,EAAae,eAAe8E,cAAgB7F,EAAae,eAAeD,SAAShB,cACxG,QAMV,OAAOwD,EG1fmBmH,CAAezK,EAAcuK,GACzC,IAAIhH,EAAMF,EAAWkH,EAAWvK,EAAcC,GAC1CsD,GACF4B,EAAQxE,KAAK,CAAE,OAAUX,EAAa1C,OAAQ,KAAQ0C,EAAac,SAAU,IAAOyC,WAK5F,IAAImH,EAAa,CACf,WAAcrB,EACd,UAAaM,EACb,QAAWK,EACX,QAAW7E,GAEb,EAAKwF,kBAAkBD,GACvB,IAAIhG,EAAa,CACf,KAAQpC,KAAKC,MAAM,EAAKyB,MAAMkB,aAC9B,UAAayE,EACb,WAAcN,EACd,QAAWW,EACX,QAAW7E,EACX,KAAQ,CACN,OAAU,EACV,KAAQ,KAEV,OAAW,CACT,WAAe,EACf,WAAe,EACf,UAAc,GACd,UAAc,KAGlB,EAAKJ,cAAc,EAAKD,WAAW3F,SAAU,GAAGuF,QAEhD,EAAKK,cAAc,EAAKD,WAAWxF,QAAS,6BAxVjC,EA6VnBqL,kBAAoB,SAACD,GACnB,IAAInG,EAAO,eACN,OAAQmG,IACXA,EAAWtM,IAAK,IAAIT,MAAOiN,WAE7B,EAAK7F,cAAc,EAAKD,WAAWzF,YAAa,wBAChD,IAAItB,EAAQ,EAAKiG,MAAMjG,MACF,IAAjBA,EAAMzC,OACRyC,EAAM4C,KAAK+J,GAKgB,IAHT3M,EAAM0G,QAAO,SAACjJ,GAC9B,OAAOA,EAAE4C,KAAOsM,EAAWtM,MAEb9C,OACdyC,EAAM4C,KAAK+J,GAEX3M,EAAMxC,SAAQ,SAACC,GACTA,EAAEkE,UAAYgL,EAAWhL,UAC3BlE,EAAEuD,WAAa2L,EAAW3L,WAC1BvD,EAAEO,UAAY2O,EAAW3O,UACzBP,EAAE2J,QAAUuF,EAAWvF,YAK3B,EAAKnB,MAAM5E,UAAY,EAAK4E,MAAMQ,gBACpCD,EAAQP,MAAMQ,eAAe3B,UAAU9E,GACpC4G,MAAK,SAAUnC,GACG,OAAbA,GACF+B,EAAQP,MAAMQ,eAAeI,SAAS7G,MAGzCiH,OAAM,SAAUxC,QA7XJ,EAmYnBuC,cAAgB,SAACnG,EAAQiM,EAAQnG,GAC/B,IAAIkF,EAAQ,GACZ,OAAQhL,GACN,KAAK,EAAKkG,WAAWhG,UACnB8K,EAAQ,CAAE,MAAS,oCAAqC,QAAW,IACnE,MACF,KAAK,EAAK9E,WAAWvF,KACnBqK,EAAQ,CAAE,MAAS,iBAAkB,QAAW,yBAChD,MACF,KAAK,EAAK9E,WAAWrF,UACnBmK,EAAQ,CAAE,MAAS,eAAgB,QAAW,IAC9C,MACF,KAAK,EAAK9E,WAAW3F,SACnByK,EAAQ,CAAE,MAAS,mBAAoB,QAAW,IAClD,MACF,KAAK,EAAK9E,WAAWzF,YACnBuK,EAAQ,CAAE,MAAS,iBAAkB,QAAWiB,GAChD,MACF,KAAK,EAAK/F,WAAWxF,QACnBsK,EAAQ,CAAE,MAAS,UAAW,QAAWiB,GACzC,MACF,QACEjB,EAAQ,CAAE,MAAS,UAAW,QAAW,8BAE7C,IAAIkB,EAAW,CACb,OAAUlM,EACV,WAAcgL,EAAMmB,MACpB,aAAgBnB,EAAMiB,SAExB,GAAGnG,EACD,IAAK,IAAIsG,KAAKtG,EACZoG,EAASE,GAAKtG,EAAWsG,GAG7B,EAAK/G,UAAS,SAACD,EAAO5J,GAAR,OACZ0Q,MAtae,EA0anBG,SAAW,WACT,IAAI1G,EAAO,eACPnF,GAAW,EACX8L,GAAY,EACZ1G,EAAiB,IAAI9C,EACzB8C,EACG7C,aACAgD,MAAK,SAAUjI,GACd8H,EAAeI,SAASlI,GACxB6H,EAAQ4G,UAAUzO,EAAM0C,EAAU8L,EAAU1G,MAE7CQ,OAAM,SAAUvC,GACfrD,GAAW,EACXoF,EACG4G,YACAzG,MAAK,SAAUjI,GACd6H,EAAQ4G,UAAUzO,EAAM0C,EAAU8L,EAAU1G,MAE7CQ,OAAM,SAAUvC,GACfyI,GAAY,EACZ3G,EAAQ4G,UAAU,KAAM/L,EAAU8L,EAAU1G,UA9bnC,EAmcnB2G,UAAY,SAACpN,EAAMqB,EAAS8L,EAAU1G,GACpC,GAAG0G,EAAU,CACX,IAAIG,EAAgB,EAAKvG,WAAWxF,QACpC,EAAKlF,MAAMkR,eAAe,CAAC,YAAc,YACzC,IAAI5G,EAAa,CACftF,SAAUA,EACV8L,UAAUA,EACV1G,eAAeA,GAEjB,EAAKO,cAAcsG,EAAe,GAAG3G,OACjC,CACH,IAAIhK,EAAc0E,EAAW,SAAS,eACvC,EAAKhF,MAAMkR,eAAe,CAAC,YAAc5Q,IAEzC,IAAI2Q,EAAgB,EAAKvG,WAAWhG,UAChCf,EAAMzC,OAAS,IACjB+P,EAAgB,EAAKvG,WAAW3F,UAelC,IAbA,IAQIoM,EARAlC,EAAM,EAAKrF,MAAMjF,WACjBrC,EAAO,GACP6N,EAAY,GACZiB,EAAa,EAAKxH,MAAMwH,WACxBC,EAAa,EAAKzH,MAAMyH,WACxBC,EAAQ,EAAK1H,MAAM0H,MACnBC,EAAQ,EAAK3H,MAAM2H,MAGnBC,EAAgBH,EAChBlL,EAAM,EACNoD,EAAM,EACN/G,EAAI,EACCsD,EAAI,EAAGA,GAAK,EAAGA,IAAK,CAC3BK,EAAM,EAAKyD,MAAM6H,KAAK3L,GACtB,IAAK,IAAIL,EAAI,EAAGA,EAAI,EAAGA,IACrB8D,EAAM,EAAKK,MAAMyB,QAAQ5F,KACzBjD,EACQ,IAAM,EACZ2O,EAAeK,EAGfA,EADAL,EAAeK,IAAkBJ,EAAaC,EAAaD,EAG7D9O,EAAKiE,KAAK,CAAE,IAAOJ,EAAK,OAAUoD,EAAK,YAAe4H,EAAc,IAAO,OAI/E,EAAKvH,MAAM8H,QAAQvQ,SAAQ,SAACwB,EAAKH,GAC/B2N,EAAU5J,KAAK,CAAE,IAAO,EAAKqD,MAAM6H,KAAK,GAAI,OAAU,EAAK7H,MAAMyB,QAAQ7I,GAAI,IAAOG,EAAM4O,IAC1FpB,EAAU5J,KAAK,CAAE,IAAO,EAAKqD,MAAM6H,KAAK,GAAI,OAAU,EAAK7H,MAAMyB,QAAQ7I,GAAI,IAAO,EAAKoH,MAAM+H,KAAOJ,IACtGpB,EAAU5J,KAAK,CAAE,IAAO,EAAKqD,MAAM6H,KAAK,GAAI,OAAU,EAAK7H,MAAMyB,QAAQ7I,GAAI,IAAO,EAAKoH,MAAM+H,KAAOL,IACtGnB,EAAU5J,KAAK,CAAE,IAAO,EAAKqD,MAAM6H,KAAK,GAAI,OAAU,EAAK7H,MAAMyB,QAAQ7I,GAAI,IAAOG,EAAM2O,OAG5FhP,EAAKnB,SAAQ,SAACyQ,GACZ,IAAIC,EAAQ1B,EAAU9F,QAAO,SAAC4D,GAC5B,OAAOA,EAAI9H,MAAQyL,EAAIzL,KAAO8H,EAAI5H,SAAWuL,EAAIvL,UAE9B,IAAjBwL,EAAM3Q,SACR0Q,EAAIjP,IAAMkP,EAAM,GAAGlP,QAGvB,IAAI2H,EAAa,CACf,eAAiBF,EACjB,MAAQzG,EACR,KAAQrB,EACR,SAAY0C,EACZ,UAAY8L,EACZ,YAAe5I,KAAKS,UAAUrG,GAC9B,UAAa6N,EACb,KAAQ,CAAE,OAAU,EAAG,KAAQ,KAC/B,WAAclB,EACd,OAAW,CACT,WAAe,EACf,WAAe,EACf,UAAc,GACd,UAAc,KAGlB,EAAKtE,cAAcsG,EAAe,GAAG3G,KA/gBvC,EAAKI,WAAa,CAChB,KAAQ,EACR,SAAY,EACZ,UAAa,EACb,UAAa,EACb,YAAe,EACf,SAAY,GAGd,EAAKd,MAAQ,CACX,eAAiB,KACjB,UAAY,EACZ,WAAY,EACZ,MAAS,GACT,OAAW,CACT,WAAe,EACf,WAAe,EACf,UAAc,GACd,UAAc,IAEhB,QAAW,EACX,gBAAkB,EAClB,aAAe,EACf,OAAU,EAAKc,WAAWvF,KAC1B,YAAc,EACd,YAAe,KACf,aAAe,EACf,WAAc,GACd,aAAgB,GAChB,IAAO,gBACP,KAAQ,GACR,WAAc,GACd,KAAQ,CAAE,OAAU,EAAG,KAAQ,KAC/B,UAAa,GACb,QAAW,GACX,QAAW,CAAC,CAAE,OAAU,EAAG,KAAQ,IAAK,IAAO,6DAC/C,UAAa,GACb,QAAW,kBAAkBmJ,MAAM,KACnC,KAAQ,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAC9B,QAAW,kBAAkBA,MAAM,KACnC,KAAQ,IACR,MAAS,IACT,MAAS,IACT,WAAc,cACd,WAAc,eACd,iBAAoB,EACpB,SAAY,CACV,GAAM,UACN,GAAM,UACN,GAAM,UACN,GAAM,UACN,GAAM,UACN,GAAM,UACN,GAAM,UACN,GAAM,UACN,GAAM,UACN,GAAM,UACN,GAAM,UACN,GAAM,YA5DO,E,qDAkPnB,WACErG,KAAK4I,a,oBAiSP,WACE,OAAI5I,KAAK2B,MAAMpF,SAAWyD,KAAKyC,WAAWhG,UACpCuD,KAAK2B,MAAM5E,SAWb,sBAAK/E,UAAU,OAAf,UACE,qBAAKA,UAAU,aAAf,SACE,cAAC,EAAD,CAAeiC,aAAc+F,KAAK/F,aAAcE,KAAM6F,KAAK2B,OAA/C,KAEd,qBAAK3J,UAAU,YAAf,SACE,cAAC,EAAD,CAAcmC,KAAM6F,KAAK2B,MAAO5G,QAASiF,KAAKjF,QAASsB,SAAY2D,KAAK3D,SAAUQ,QAASmD,KAAKnD,QAASL,SAAUwD,KAAKyC,YAA7G,QAdf,qBAAKzK,UAAU,OAAf,SACE,gCACE,gDACA,qFAgBGgI,KAAK2B,MAAMpF,SAAWyD,KAAKyC,WAAW3F,SAE7C,sBAAK9E,UAAU,OAAf,UACE,qBAAKA,UAAU,aAAf,SACE,cAAC,EAAD,CAAeiC,aAAc+F,KAAK/F,aAAcE,KAAM6F,KAAK2B,OAA/C,KAEd,qBAAK3J,UAAU,YAAf,SACE,cAAC,EAAD,CAAcmC,KAAM6F,KAAK2B,MAAO3F,SAAUgE,KAAKhE,SAAUE,WAAY8D,KAAK9D,WAAYG,SAAY2D,KAAK3D,SAAUG,SAAUwD,KAAKyC,YAArH,QAIRzC,KAAK2B,MAAMpF,SAAWyD,KAAKyC,WAAWrF,UAE7C,sBAAKpF,UAAU,OAAf,UACE,qBAAKA,UAAU,aAAf,SACE,cAAC,EAAD,CAAeiC,aAAc+F,KAAK/F,aAAcE,KAAM6F,KAAK2B,OAA/C,KAEd,qBAAK3J,UAAU,YAAf,SACE,cAAC,EAAD,CAAcmC,KAAM6F,KAAK2B,MAAO5G,QAASiF,KAAKjF,QAASsB,SAAY2D,KAAK3D,SAAUQ,QAASmD,KAAKnD,QAASL,SAAUwD,KAAKyC,YAA7G,QAITzC,KAAK2B,MAAMpF,SAAWyD,KAAKyC,WAAWzF,YAE5C,qBAAKhF,UAAU,OAAf,SACE,gCACE,mCAAMgI,KAAK2B,MAAMhF,WAAjB,OACA,kCAAKqD,KAAK2B,MAAMxE,aAAhB,YAOJ,qBAAKnF,UAAU,OAAf,SACE,iD,GA/kBS6R,IAAMC,WCSVC,MAZf,WAEE,MAAsCC,mBAAS,CAAC,YAAc,YAA9D,mBAAO5R,EAAP,KAAoB6Q,EAApB,KAEA,OACE,sBAAKjR,UAAU,MAAf,UACE,cAAC,EAAD,CAAQI,YAAaA,IACrB,cAAC,EAAD,CAAMA,YAAaA,EAAa6Q,eAAgBA,QCPtDgB,IAASC,OACN,cAAC,EAAD,IACApD,SAASC,eAAe,W","file":"static/js/main.9381e990.chunk.js","sourcesContent":["export default __webpack_public_path__ + \"static/media/zadigChess.ba50ba27.png\";","import React from 'react';\r\nimport './header.styles.css';\r\nimport logo from '../../assets/zadigChess.png';\r\n\r\nconst Header = (props) => {\r\n  return (\r\n  <div className=\"header\">\r\n    <img src={\"./\"+logo} className=\"logo\" alt=\"logo\" />\r\n    <div className=\"title\">\r\n      Chess Studies <span className=\"storageType\">{props.parentInfos.storageType}</span>\r\n    </div>\r\n  </div>\r\n  )\r\n}\r\nexport default Header;","import React from 'react';\r\nimport './prisoners.styles.css';\r\n\r\nfunction createReverseSign() {\r\nreturn {__html: '⇵'};\r\n}\r\n\r\nfunction prepareScore(score){\r\n    if(score === 0) return \"\";\r\n    return score > 0 ? \"+\"+score : \"\"+score;\r\n}\r\n\r\nfunction prepareJail(listW,listB,figCodes,side){\r\n    let color = side === \"w\" ? \"B\" : \"W\";\r\n    let result = \"\";\r\n    let list = side === \"w\" ? listB : listW;\r\n    let previous = list && list.length > 1 ? list[0] : \"\";\r\n    list.forEach((x) => {\r\n        if(previous !== x){\r\n            result+=\"&nbsp;&nbsp;\";\r\n            previous = x;\r\n        }\r\n        result += figCodes[x+color];\r\n    });\r\n    return {__html: result};\r\n}\r\n\r\n\r\nconst Prisoners = (props) => {\r\n    let whiteJail = props.scores.whiteJail;\r\n    let blackJail = props.scores.blackJail;\r\n    let figCodes = props.figCodes;\r\n    let side = props.side;\r\n    return (\r\n        <div className={`jail ${props.boardPosition === \"inversed\" ? \"reverse\" : \"\"} \r\n        ${props.side === \"b\" ? (props.boardPosition === \"inversed\" ? \"black\" : \"white\") : (props.boardPosition === \"inversed\" ? \"white\" : \"black\")}`}>\r\n            <span className=\"jail-yard\">\r\n                <span className=\"player\">{props.side === \"b\" ? props.pgnResume.Black : props.pgnResume.White}</span>\r\n                <span className=\"score\">{props.side === \"b\" ? prepareScore(props.scores.whiteScore) : prepareScore(props.scores.blackScore)}</span>\r\n                <span className=\"list\" dangerouslySetInnerHTML={prepareJail(whiteJail,blackJail,figCodes,side)}/>\r\n                 \r\n            </span>\r\n            <span className=\"inverse-clickable\" onClick={props.reverseBoard} dangerouslySetInnerHTML={createReverseSign()}/>\r\n        </div>\r\n    )\r\n}\r\nexport default Prisoners;\r\n\r\n","import React from 'react';\r\nimport './board.styles.css';\r\nimport Prisoners from '../prisoners/prisoners.component';\r\nconst Board = (props) => {\r\n  return (\r\n    <div className={`board-zone ${props.game.doReverseBoard ? \"inverse\" : \"\"}`} >\r\n      <Prisoners side=\"w\" reverseBoard={props.reverseBoard} figCodes={props.game.figCodes} pgnResume={props.game.pgnResume} scores={props.game.scores}/>\r\n      <div className='board'>\r\n        {\r\n          props.game.data\r\n            .map((x, i) => (\r\n              <React.Fragment key={i}>\r\n                <div key={i} data-pos={i} className={'square ' + x.squareColor} dangerouslySetInnerHTML={{ __html: props.game.figCodes[x.fig] ? props.game.figCodes[x.fig] : '&nbsp;' }} />\r\n              </React.Fragment>\r\n            ))\r\n        }\r\n      </div>\r\n      <Prisoners side=\"b\" reverseBoard={props.reverseBoard} figCodes={props.game.figCodes} pgnResume={props.game.pgnResume} scores={props.game.scores}/>\r\n    </div>\r\n  )\r\n   }\r\n  export default Board;\r\n\r\n","import React from 'react';\r\nimport './turns.styles.css';\r\nconst Turns = (props) => {\r\n    return (\r\n        <div className=\"game-turns\">\r\n            <ol>\r\n                {\r\n                    props.turnsList.map((turn, index) =>\r\n                        <li key={index}>\r\n                            <span onClick={props.movePGN} data-turn={index + 1} data-side=\"w\"\r\n                                className={`turn-w ${props.currentMove.number === index + 1 && props.currentMove.side === 'w' ? \"turn-current\" : \"\"}`}>\r\n                                {turn.w}\r\n                            </span>\r\n                            <span onClick={props.movePGN} data-turn={index + 1} data-side=\"b\"\r\n                                className={`turn-b ${props.currentMove.number === index + 1 && props.currentMove.side === 'b' ? \"turn-current\" : \"\"}`}>\r\n                                {turn.b}\r\n                            </span>\r\n                        </li>\r\n                    )\r\n                }\r\n            </ol>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default Turns;","import React from 'react';\r\nimport './resume.styles.css';\r\n\r\nconst Resume = (props) => {\r\n    return(\r\n        <div className=\"game-resume\">\r\n            {props.resume.Date} {props.resume.White} vs {props.resume.Black} {props.resume.Result}          \r\n        </div>\r\n    )\r\n}\r\n\r\nexport default Resume;","import React from 'react';\r\nimport './movesCommands.styles.css';\r\nimport prev from '../../assets/prev.gif';\r\nimport next from '../../assets/next.gif';\r\nimport first from '../../assets/first.gif';\r\nimport last from '../../assets/last.gif';\r\nconst MovesCommands = (props) => {\r\n    return (\r\n        <div className=\"moves-board\">\r\n            <span data-move=\"first\" onClick={props.movePGN} ><img src={first} className=\"command-img\" alt=\"first\" /></span>           \r\n            <span data-move=\"prev\" onClick={props.movePGN} ><img src={prev} className=\"command-img\" alt=\"prev\" /></span>\r\n            <span data-move=\"pause\" className=\"hidden\" onClick={props.movePGN} >&#9208;</span>\r\n            <span data-move=\"next\" onClick={props.movePGN} ><img src={next} className=\"command-img\" alt=\"next\" /></span>\r\n            <span data-move=\"last\" onClick={props.movePGN} ><img src={last} className=\"command-img\" alt=\"last\" /></span>\r\n        </div>\r\n    )\r\n}\r\nexport default MovesCommands;","export default \"data:image/gif;base64,R0lGODlhMQAnAMwAAAAAALKAP3+vxWaaxZnFxQAAPwAAZsW2kr+mecW8n18rAGw7E0YTAIxULDM1M5KTkplkLF8rP39CE2aarMW2pZnFv6W2xXKdxb+mpbKKWYxUU0YTZr+vn2w7ZsXFxQAAACH5BAEAAB4ALAAAAAAxACcAAAX/oCeOZGmeaKqubOu+cCzPdG1njnO1mEvBAQBgwEJsCKxDRPAKDlcIhgGpOigKTJeTmIoCplUFANsUck/eL/VkFZK1ZlRajWq7s60tmiEUgk12d2VPJXN+ayOBgnCEI4aHJYqLeXGOfH19fyKSkyx6Io+Za5ydK5+hoptimJhvlE+oqaR9rp5msaKztHi2ABMSrMFfFRDCrLWmZgkLxqkNzaUqesvQf8/NyNKV1Maa18LZKZ8e3MGaHt/HvMmN5MzmiOjg69rt7vAm6dHilSTlkPnUDTrj7x3AgLsGoih3rsS3cCjGmeDW0OG+iP1OUKtoEeIJiRoXcHTo0QRIjR3iF6HQQC8FhwcPLNiYSbOmzZs4c+rcGSMEADs=\"","export default \"data:image/gif;base64,R0lGODlhIAAnALsAAAAAAH+vxQAAP7mXZqyDTCwAABkAAIavxYyvxbmXf6yDbBkAPywAP8XFxQAAAAAAACH5BAEAAA0ALAAAAAAgACcAAARzsMlJq7046827/2AoZsoxasQSnBhhCCtbuQAsU3Qd37l+Nz2fLCg8EYuiIxKkXHqaTg40ijIArtgsNTMoaL+2UPebDYu95O1mTDaL2Fr3G13eneBX+Qiv39P7fnl2N2OAdwWGdwyDPw0JCI2RkpOUlZYWEQA7\"","export default \"data:image/gif;base64,R0lGODlhJQAnALsAAAAAAMWvfz8AAGaXuUaArAAALAAAE3+XuT8AE8WvjGaArD8ALMWvhsXFxQAAAAAAACH5BAEAAA0ALAAAAAAlACcAAAR2sMlJq7046827/2AojhijkF+AEGgXCAbbai8Qz1lty3il7z2fAEAEBiU/4u2YVPJwTWcwKoUOi1hji1pcorjdpwhMLAy212zRPAOz2+nsG64GzOny8zRu1++xdz0/gYJXhIV9R0KHUwt+ihMJB5CUlZaXmJkkEQA7\"","export default \"data:image/gif;base64,R0lGODlhLwAnAMwAAAAAAGaaxcWvf8WaZrKAPz8AAJ+8xRM7bDlun5K2xQAAEwArXyxUjDM1M5KTkqW2xaWAP3KdxT99rL+vnyxkmVNUjD8rX7KKWcWpn8XFxQAAAAAAAAAAAAAAAAAAAAAAACH5BAEAABkALAAAAAAvACcAAAX/YCaOZGmeaKqubOu+cCzPdK1ihvu0V9NErcEhtxJYEiwCABAIAobFwgKpUjKdTyJKUABMq8sma7DMprjLL8oqXpHL0BM6TTWxsXAtaU4/3cdleSZ8fSV/boGCe12JaiOHKm+JZiOEZY4ZkCmSk3EZlpd1miicnUSgoSKjJ6Wmn4yTfasmraaogVOzJbWJChK3gRQQYXixAAoIr8ZlDJnEgMvIIsAAzc5X0LHS07CT1tdtkcbb3Mbf4MVl5OXehs+IvckloOeq7+KB65Xd1X73m/nkDepW79E/UuoEDmSWQheJN/rmMSpIwuEIMhEl9gODzU1GiRTddYyk8EyFFhZtEqiY4MDBDpUwY8qcSbOmzZohAAA7\"","import React from 'react';\r\nimport './gameList.styles.css';\r\nconst GameList = (props) => {\r\n    return (\r\n        <div className=\"game-list\">\r\n            <ol>\r\n                { \r\n                    props.games.map((game, index) =>\r\n                        <li key={index}>\r\n                            <div className=\"list-element\" >\r\n                                <span className=\"list-element-text\" >\r\n                                {game.pgnResume.Event} {game.pgnResume.Site} {game.pgnResume.Date} <br/>\r\n                                {game.pgnResume.White} ({game.pgnResume.WhiteElo}) {\"vs\"} {game.pgnResume.Black} ({game.pgnResume.BlackElo})  {\"=>\"} {game.pgnResume.Result}\r\n                                </span>\r\n                                <span className=\"button choose\" data-index={game.id} onClick={props.loadGame}></span>\r\n                                <span className={`button delete ${!props.online  ? \"hidden\" : \"\"}`} data-index={game.id} onClick={props.deleteGame}></span>\r\n                            </div>\r\n                        </li>\r\n                    )\r\n                }\r\n            </ol>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default GameList;","import React from 'react';\r\nimport './gameMenu.styles.css';\r\n\r\nconst GameMenu = (props) => {\r\n    return (\r\n        <div className=\"game-menu\">\r\n            <div data-target=\"showMoves\" className={`${props.movesLoaded ? \"\" : \"hidden\"}`} onClick={props.menuMove}>Moves</div>           \r\n            <div data-target=\"showList\" onClick={props.menuMove}>Games list</div>           \r\n            <div data-target=\"showInput\" onClick={props.menuMove}>New game</div>           \r\n        </div>\r\n    )\r\n}\r\n\r\nexport default GameMenu;\r\n","import React from 'react';\r\nimport './info.styles.css';\r\nimport Turns from '../turns/turns.component';\r\nimport Resume from '../resume/resume.component';\r\nimport MovesCommands from '../movesCommands/movesCommands.component';\r\nimport GameList from '../gameList/gameList.component';\r\nimport GameMenu from '../gameMenu/gameMenu.component';\r\n\r\nconst Info = (props) => {\r\n  let status = props.game.status;\r\n  let statuses = props.statuses;\r\n  if(status === statuses.showInput){\r\n      return(\r\n        <React.Fragment>\r\n        <GameMenu menuMove = {props.menuMove} movesLoaded={props.game.pgnHistory && props.game.pgnHistory > 1}/>\r\n        <div className='info-zone'>\r\n          <h3 className='board-title'>{props.game.infosTitle}</h3>\r\n          <textarea id=\"game-input\" className=\"game-input\" name=\"pgn\"></textarea>\r\n          <button onClick={props.savePGN}>Go</button>\r\n        </div>\r\n        </React.Fragment>\r\n      )\r\n  }\r\n  else if (status === statuses.showList) { // todo : showList\r\n    return(\r\n      <React.Fragment>\r\n      <GameMenu menuMove = {props.menuMove} movesLoaded={props.game.pgnHistory && props.game.pgnHistory.length > 1 ? true:false}/>\r\n      <div className='list-zone'>\r\n        <h3 className='board-list-title'>{props.game.infosTitle}</h3>\r\n        <GameList games={props.game.games} deleteGame={props.deleteGame} loadGame={props.loadGame} online={props.game.isRemote}></GameList>\r\n      </div>\r\n      </React.Fragment>\r\n    )\r\n  }\r\n  else if (status === statuses.showMessage || status === statuses.inError|| status === statuses.init) { \r\n    return(\r\n      <div className='info-zone'>\r\n        <h3 className='board-title'>{props.game.infosTitle}</h3>\r\n        <p className='infosMessage'>{props.game.infosMessage}</p>\r\n      </div>\r\n    )\r\n  }\r\n else if (status === statuses.showMoves) { // add proposeSave : tue|false (button to save loaded game to locaStorage or back in the future (or both))\r\n      return(\r\n        <React.Fragment>\r\n        <GameMenu menuMove = {props.menuMove} movesLoaded={props.game.pgnHistory && props.game.pgnHistory > 1}/>\r\n        <div className='turns-zone'>\r\n          <Resume resume = {props.game.pgnResume}/>\r\n          <Turns turnsList = {props.game.pgnGame} currentMove={props.game.move} movePGN = {props.movePGN}/>\r\n          <MovesCommands movePGN = {props.movePGN}/> \r\n        </div>\r\n        </React.Fragment>\r\n      )\r\n    } else{\r\n      return(\r\n        <div className='info-zone'>\r\n          <h3 className='board-title'>404</h3>\r\n          <p className='infosMessage'>Sorry Buddy, I'm afraid we are lost !</p>\r\n        </div>\r\n      ) \r\n    }\r\n  }\r\n\r\n  export default Info;","const charIsLowercase = (c) => {\r\n    return c !== c.toUpperCase();\r\n  }\r\n\r\n  export {charIsLowercase};","import {charIsLowercase} from './utils.js';\r\n\r\nconst getAskedMove = (elem,currentMove,movesList) => {\r\n    let turn = 0;\r\n    let side = \"w\";\r\n    let askedMove = null;\r\n    let lastMove = movesList[movesList.length-1];\r\n    if(\"move\" in elem){\r\n      let instruction = elem.move;\r\n      if(instruction === \"first\"){\r\n        askedMove={\"number\":0,\"side\":\"w\"};\r\n      }else if(instruction === \"last\"){\r\n        if(\"b\" in lastMove){\r\n          askedMove={\"number\":movesList.length,\"side\":\"b\"};\r\n        }else{\r\n          askedMove={\"number\":movesList.length,\"side\":\"w\"};\r\n        }\r\n        askedMove.pace = \"quick\";\r\n      }else if(instruction === \"pause\"){\r\n        askedMove=currentMove;\r\n        askedMove.pace = \"stop\";\r\n      }else if(instruction === \"prev\"){\r\n        if(currentMove.number <= 1 && currentMove.side === \"w\"){\r\n          askedMove={\"number\":0,\"side\":\"w\"};\r\n        }else{\r\n          if(currentMove.side === \"b\"){\r\n            askedMove={\"number\":currentMove.number,\"side\":\"w\"};\r\n          }else{\r\n            askedMove={\"number\":currentMove.number -1 ,\"side\":\"b\"};\r\n          }\r\n          if(askedMove.number < 1 ){\r\n            askedMove={\"number\":1,\"side\":\"w\"};\r\n          }\r\n        }\r\n        askedMove.pace = \"quick\";\r\n      }else if(instruction === \"next\"){\r\n        if(currentMove.number === movesList.length){\r\n          if(currentMove.side === \"b\"){\r\n            askedMove=currentMove;\r\n          }else{\r\n            if(\"b\" in lastMove){\r\n              askedMove={\"number\":movesList.length ,\"side\":\"b\"};\r\n            }else{\r\n              askedMove=currentMove;\r\n            }\r\n          }\r\n        }else{\r\n          if(currentMove.side === \"b\"){\r\n            askedMove={\"number\":currentMove.number +1,\"side\":\"w\"};\r\n          }else{\r\n            askedMove={\"number\":currentMove.number ,\"side\":\"b\"};\r\n          }\r\n        }\r\n\r\n        if(askedMove.number < 1 ){\r\n          askedMove={\"number\":1,\"side\":\"w\"};\r\n        }\r\n      }\r\n    }\r\n\r\n    else if(\"turn\" in elem && \"side\" in elem){\r\n      turn = parseInt(elem.turn);\r\n      if(isNaN(turn)){\r\n        turn = 0;\r\n      }\r\n      side = elem.side;\r\n    }\r\n    if(turn>0){\r\n      askedMove={\"number\":turn,\"side\":side};\r\n    }\r\n    return askedMove;\r\n  }\r\n\r\n  const getNextMove = (gamePositions,currentMove,askedMove,columnsOrdered) => {\r\n    let askedMoveOffset = getMoveOffset(askedMove);\r\n    let currentMoveOffset = getMoveOffset(currentMove);\r\n    let nextMoveData = {\r\n      moveSide:\"\",\r\n      moveColumn : \"\",\r\n      moveRow : 0,\r\n      movePieceType : null,\r\n      moveType : null, // move, castle-king, take\r\n      isCheck : false, // maybe not usefull\r\n      isMat : false,\r\n      isError : false,\r\n      isDone : true, // no change : we are at the asked move\r\n      possiblePositions : [],\r\n      additionalMove : null,\r\n      comingFromRow : 0, // ex R2c8 => 2 : the Rook is coming from row 2 (there are 2 Rooks able to make teh move)\r\n      comingFromColumn : \"\",// ex Rac8 => a : the Rook is coming from column/file \"a\"\r\n      uniqueFigure:false,\r\n      promoteTo:null,\r\n      number:0\r\n    };\r\n\r\n    if(askedMoveOffset > currentMoveOffset){\r\n      nextMoveData.isDone = false;\r\n      let nextMoveOffset = currentMoveOffset === 0 ? currentMoveOffset = 1 : currentMoveOffset+1;\r\n      let nextMovePosition = {}\r\n      if(nextMoveOffset % 2 === 1){\r\n        nextMovePosition.number = Math.trunc(currentMoveOffset/2)+1;\r\n        nextMovePosition.side = \"w\";\r\n      }else{\r\n        nextMovePosition.number = (currentMoveOffset+1)/2;\r\n        nextMovePosition.side = \"b\";\r\n      }\r\n      \r\n      let nextMove = gamePositions[nextMovePosition.number-1][nextMovePosition.side];\r\n      nextMoveData.moveSide = nextMovePosition.side;\r\n      nextMoveData.number = nextMovePosition.number;\r\n      nextMove = nextMove.replace(/\\?|!/,\"\") // no ?! !! etc...\r\n\r\n      nextMoveData.moveType = \"move\";\r\n      \r\n      let take = nextMove.indexOf(\"x\") !== -1;\r\n      if(take){\r\n        nextMove = nextMove.replace(\"x\",\"\");\r\n        nextMoveData.moveType = \"take\";\r\n      }\r\n      \r\n      if(nextMove.charAt(nextMove.length-1) === \"+\" && nextMove.charAt(nextMove.length-2) === \"+\"){\r\n        nextMoveData.isMat = true;\r\n        nextMove = nextMove.substring(0,nextMove.length-2);\r\n      }else if(nextMove.charAt(nextMove.length-1) === \"+\"){\r\n        nextMoveData.isCheck = true;\r\n        nextMove = nextMove.substring(0,nextMove.length-1);\r\n      }\r\n      if(nextMove.length === 2){// pawn move\r\n        nextMoveData.movePieceType = \"p\";\r\n        nextMoveData.moveColumn = nextMove.charAt(0);\r\n        nextMoveData.moveRow = parseInt(nextMove.charAt(1));\r\n        if(isNaN(nextMoveData.moveRow)){\r\n          nextMoveData.isError = true;\r\n        }\r\n      } else if(nextMove.length === 3){\r\n          if(nextMove === \"0-0\" || nextMove === \"O-O\"){\r\n            nextMoveData.movePieceType = \"K\";\r\n            nextMoveData.moveColumn = \"g\"\r\n            nextMoveData.moveRow = nextMoveData.moveSide === \"w\" ? 1 : 8;\r\n            nextMoveData.moveType = \"castle-king\";\r\n            nextMoveData.possiblePositions = [];\r\n            nextMoveData.additionalMove = {\r\n              moveSide:nextMoveData.moveSide,\r\n              moveColumn : \"f\",\r\n              moveRow :  nextMoveData.moveRow,\r\n              movePieceType : \"R\",\r\n              moveType : nextMoveData.moveType,\r\n              isCheck : false, // maybe not usefull\r\n              isError : false,\r\n              possiblePositions : []\r\n            }\r\n          }else{\r\n            let isLowerCase = charIsLowercase(nextMove.charAt(0))\r\n            if(isLowerCase){ // it's a pawn with an indication from which column/file it's coming\r\n              nextMoveData.movePieceType = \"p\";\r\n              nextMoveData.comingFromColumn = nextMove.charAt(0);\r\n              nextMoveData.moveColumn = nextMove.charAt(1);\r\n              nextMoveData.moveRow = parseInt(nextMove.charAt(2));\r\n            }else{ // it's a Figure\r\n              nextMoveData.movePieceType = nextMove.charAt(0);\r\n              nextMoveData.moveColumn = nextMove.charAt(1);\r\n              nextMoveData.moveRow = parseInt(nextMove.charAt(2));\r\n            }\r\n            if(isNaN(nextMoveData.moveRow)){\r\n              nextMoveData.isError = true;\r\n            }\r\n          }\r\n      }else if(nextMove.length === 4){\r\n        if(nextMove.charAt(2) === \"=\"){\r\n          nextMoveData.promoteTo = nextMove.charAt(3);\r\n          nextMoveData.movePieceType = \"p\";\r\n          nextMoveData.moveColumn = nextMove.charAt(0);\r\n          nextMoveData.moveRow = parseInt(nextMove.charAt(1));\r\n        }else{\r\n          nextMoveData.movePieceType = nextMove.charAt(0);\r\n          let comingFrom = nextMove.charAt(1);\r\n          if(!isNaN(parseInt(comingFrom))){\r\n            nextMoveData.comingFromRow = parseInt(comingFrom);\r\n          }else{\r\n            nextMoveData.comingFromColumn = comingFrom;\r\n          }\r\n          nextMoveData.moveColumn = nextMove.charAt(2);\r\n          nextMoveData.moveRow = parseInt(nextMove.charAt(3));\r\n          if(isNaN(nextMoveData.moveRow)){\r\n            nextMoveData.isError = true;\r\n          }\r\n        }\r\n      }else if(nextMove === \"0-0-0\" || nextMove === \"O-O-O\"){\r\n        nextMoveData.movePieceType = \"K\";\r\n        nextMoveData.moveColumn = \"c\";\r\n        nextMoveData.moveRow = nextMoveData.moveSide === \"w\" ? 1 : 8;\r\n        nextMoveData.moveType = \"castle-queen\";\r\n        nextMoveData.possiblePositions = [];\r\n        nextMoveData.additionalMove = {\r\n          moveSide:nextMoveData.moveSide,\r\n          moveColumn : \"d\",\r\n          moveRow : nextMoveData.moveRow,\r\n          movePieceType : \"R\",\r\n          moveType : nextMoveData.moveType,\r\n          isCheck : false, \r\n          isError : false,\r\n          possiblePositions : []\r\n        }\r\n      }else{\r\n        // to be continued (queen side castling)\r\n        nextMoveData.isError = true;\r\n      }\r\n      // Computing possible previous positions of the moving piece \r\n      if(!nextMoveData.isError){\r\n        nextMoveData.possiblePositions = [];\r\n        if(nextMoveData.movePieceType === \"p\"){\r\n          setPawnPossiblePreviousPositions(nextMoveData,columnsOrdered);\r\n        }else if(nextMoveData.movePieceType === \"N\"){\r\n          setKnightPossiblePreviousPositions(nextMoveData,columnsOrdered);\r\n        }else if(nextMoveData.movePieceType === \"B\"){\r\n          setBishopPossiblePreviousPositions(nextMoveData,columnsOrdered);\r\n        }else if(nextMoveData.movePieceType === \"R\"){\r\n          setRookPossiblePreviousPositions(nextMoveData,columnsOrdered);\r\n        }else if(nextMoveData.movePieceType === \"K\"){\r\n          setKingPossiblePreviousPositions(nextMoveData,columnsOrdered);\r\n         } else if (nextMoveData.movePieceType === \"Q\") {\r\n           nextMoveData.uniqueFigure = true;\r\n         }\r\n      }\r\n    }\r\n\r\n    return nextMoveData;\r\n  }\r\n\r\n  const getMoveDataAt = (turn,side,nr,positions,columnsOrdered) => {\r\n    let nextMoveData = {\r\n      moveSide:side,\r\n      moveColumn : \"\",\r\n      moveRow : 0,\r\n      movePieceType : null,\r\n      moveType : null, // move, castle-king, take\r\n      isCheck : false, // maybe not usefull\r\n      isMat : false,\r\n      isError : false,\r\n      isDone : true, // no change : we are at the asked move\r\n      possiblePositions : [],\r\n      additionalMove : null,\r\n      comingFromRow : 0, // ex R2c8 => 2 : the Rook is coming from row 2 (there are 2 Rooks able to make teh move)\r\n      comingFromColumn : \"\",// ex Rac8 => a : the Rook is coming from column/file \"a\"\r\n      uniqueFigure:false,\r\n      promoteTo:null,\r\n      number:nr\r\n    };\r\n\r\n      nextMoveData.isDone = false;\r\n\r\n      let nextMove = side === \"w\" ? turn.w : turn.b;\r\n      nextMove = nextMove.replace(/\\?|!/,\"\") // no ?! !! etc...\r\n      nextMoveData.moveType = \"move\";\r\n      \r\n      let take = nextMove.indexOf(\"x\") !== -1;\r\n      if(take){\r\n        nextMove = nextMove.replace(\"x\",\"\");\r\n        nextMoveData.moveType = \"take\";\r\n      }\r\n      \r\n      if(nextMove.charAt(nextMove.length-1) === \"+\" && nextMove.charAt(nextMove.length-2) === \"+\"){\r\n        nextMoveData.isMat = true;\r\n        nextMove = nextMove.substring(0,nextMove.length-2);\r\n      }else if(nextMove.charAt(nextMove.length-1) === \"+\"){\r\n        nextMoveData.isCheck = true;\r\n        nextMove = nextMove.substring(0,nextMove.length-1);\r\n      }\r\n      if(nextMove.length === 2){// pawn move\r\n        nextMoveData.movePieceType = \"p\";\r\n        nextMoveData.moveColumn = nextMove.charAt(0);\r\n        nextMoveData.moveRow = parseInt(nextMove.charAt(1));\r\n        if(isNaN(nextMoveData.moveRow)){\r\n          nextMoveData.isError = true;\r\n        }\r\n      } else if(nextMove.length === 3){\r\n          if(nextMove === \"0-0\" || nextMove === \"O-O\"){\r\n            nextMoveData.movePieceType = \"K\";\r\n            nextMoveData.moveColumn = \"g\"\r\n            nextMoveData.moveRow = nextMoveData.moveSide === \"w\" ? 1 : 8;\r\n            nextMoveData.moveType = \"castle-king\";\r\n            nextMoveData.possiblePositions = [];\r\n            nextMoveData.additionalMove = {\r\n              moveSide:nextMoveData.moveSide,\r\n              moveColumn : \"f\",\r\n              moveRow :  nextMoveData.moveRow,\r\n              movePieceType : \"R\",\r\n              moveType : nextMoveData.moveType,\r\n              isCheck : false, // maybe not usefull\r\n              isError : false,\r\n              possiblePositions : []\r\n            }\r\n          }else{\r\n            let isLowerCase = charIsLowercase(nextMove.charAt(0))\r\n            if(isLowerCase){ // it's a pawn with an indication from which column/file it's coming\r\n              nextMoveData.movePieceType = \"p\";\r\n              nextMoveData.comingFromColumn = nextMove.charAt(0);\r\n              nextMoveData.moveColumn = nextMove.charAt(1);\r\n              nextMoveData.moveRow = parseInt(nextMove.charAt(2));\r\n            }else{ // it's a Figure\r\n              nextMoveData.movePieceType = nextMove.charAt(0);\r\n              nextMoveData.moveColumn = nextMove.charAt(1);\r\n              nextMoveData.moveRow = parseInt(nextMove.charAt(2));\r\n            }\r\n            if(isNaN(nextMoveData.moveRow)){\r\n              nextMoveData.isError = true;\r\n            }\r\n          }\r\n      }else if(nextMove.length === 4){\r\n        if(nextMove.charAt(2) === \"=\"){\r\n          nextMoveData.promoteTo = nextMove.charAt(3);\r\n          nextMoveData.movePieceType = \"p\";\r\n          nextMoveData.moveColumn = nextMove.charAt(0);\r\n          nextMoveData.moveRow = parseInt(nextMove.charAt(1));\r\n        }else{\r\n          nextMoveData.movePieceType = nextMove.charAt(0);\r\n          let comingFrom = nextMove.charAt(1);\r\n          if(!isNaN(parseInt(comingFrom))){\r\n            nextMoveData.comingFromRow = parseInt(comingFrom);\r\n          }else{\r\n            nextMoveData.comingFromColumn = comingFrom;\r\n          }\r\n          nextMoveData.moveColumn = nextMove.charAt(2);\r\n          nextMoveData.moveRow = parseInt(nextMove.charAt(3));\r\n          if(isNaN(nextMoveData.moveRow)){\r\n            nextMoveData.isError = true;\r\n          }\r\n        }\r\n      }else if(nextMove === \"0-0-0\" || nextMove === \"O-O-O\"){\r\n        nextMoveData.movePieceType = \"K\";\r\n        nextMoveData.moveColumn = \"c\";\r\n        nextMoveData.moveRow = nextMoveData.moveSide === \"w\" ? 1 : 8;\r\n        nextMoveData.moveType = \"castle-queen\";\r\n        nextMoveData.possiblePositions = [];\r\n        nextMoveData.additionalMove = {\r\n          moveSide:nextMoveData.moveSide,\r\n          moveColumn : \"d\",\r\n          moveRow : nextMoveData.moveRow,\r\n          movePieceType : \"R\",\r\n          moveType : nextMoveData.moveType,\r\n          isCheck : false, \r\n          isError : false,\r\n          possiblePositions : []\r\n        }\r\n      }else{\r\n        // to be continued (queen side castling)\r\n        nextMoveData.isError = true;\r\n      }\r\n      // Computing possible previous positions of the moving piece \r\n      if(!nextMoveData.isError){\r\n        nextMoveData.possiblePositions = [];\r\n        if(nextMoveData.movePieceType === \"p\"){\r\n          setPawnPossiblePreviousPositions(nextMoveData,columnsOrdered);\r\n        }else if(nextMoveData.movePieceType === \"N\"){\r\n          setKnightPossiblePreviousPositions(nextMoveData,columnsOrdered);\r\n        }else if(nextMoveData.movePieceType === \"B\"){\r\n          setBishopPossiblePreviousPositions(nextMoveData,columnsOrdered);\r\n        }else if(nextMoveData.movePieceType === \"R\"){\r\n          setRookPossiblePreviousPositions(nextMoveData,columnsOrdered);\r\n        }else if(nextMoveData.movePieceType === \"K\"){\r\n          setKingPossiblePreviousPositions(nextMoveData,columnsOrdered);\r\n         } else if (nextMoveData.movePieceType === \"Q\") {\r\n           nextMoveData.uniqueFigure = true;\r\n         }\r\n      }\r\n\r\n    return nextMoveData;\r\n  }\r\n\r\n\r\nconst setRookPossiblePreviousPositions = (nextMoveData, columnsOrdered) => {\r\n  // Same column \r\n  // changing row\r\n  for (let r = 1; r < 9; r++) {\r\n    if (r === nextMoveData.moveRow) continue;\r\n    let possibleMove = {\r\n      \"column\": nextMoveData.moveColumn,\r\n      \"row\": r\r\n    };\r\n    if ((nextMoveData.comingFromRow === 0 || possibleMove.row === nextMoveData.comingFromRow) &&\r\n      (nextMoveData.comingFromColumn === \"\" || possibleMove.column === nextMoveData.comingFromColumn)) {\r\n      nextMoveData.possiblePositions.push(possibleMove);\r\n    }\r\n  }\r\n\r\n  // Same row \r\n  // changing column/file\r\n  for (let c = 0; c < 8; c++) {\r\n    if (columnsOrdered[c] === nextMoveData.moveColumn) continue;\r\n    let possibleMove = {\r\n      \"column\": columnsOrdered[c],\r\n      \"row\": nextMoveData.moveRow\r\n    };\r\n    if ((nextMoveData.comingFromRow === 0 || possibleMove.row === nextMoveData.comingFromRow) &&\r\n      (nextMoveData.comingFromColumn === \"\" || possibleMove.column === nextMoveData.comingFromColumn)) {\r\n      nextMoveData.possiblePositions.push(possibleMove);\r\n    }\r\n  }\r\n}\r\n\r\nconst setKingPossiblePreviousPositions = (nextMoveData,columnsOrdered) => {\r\n\r\n  if (nextMoveData.moveType === \"castle-king\") {\r\n    nextMoveData.possiblePositions.push({\r\n      \"column\": \"e\",\r\n      \"row\": nextMoveData.moveSide === \"w\" ? 1 : 8\r\n    });\r\n    nextMoveData.additionalMove.possiblePositions.push({\r\n      \"column\": \"h\",\r\n      \"row\": nextMoveData.moveSide === \"w\" ? 1 : 8\r\n    });\r\n    nextMoveData.moveType = \"move\";\r\n    nextMoveData.additionalMove.moveType = \"move\";\r\n  } else if (nextMoveData.moveType === \"castle-queen\") {\r\n    nextMoveData.possiblePositions.push({\r\n      \"column\": \"e\",\r\n      \"row\": nextMoveData.moveSide === \"w\" ? 1 : 8\r\n    });\r\n    nextMoveData.additionalMove.possiblePositions.push({\r\n      \"column\": \"a\",\r\n      \"row\": nextMoveData.moveSide === \"w\" ? 1 : 8\r\n    });\r\n    nextMoveData.moveType = \"move\";\r\n    nextMoveData.additionalMove.moveType = \"move\";\r\n\r\n  } else {\r\n    nextMoveData.uniqueFigure = true;\r\n  }\r\n}\r\n\r\nconst setPawnPossiblePreviousPositions = (nextMoveData,columnsOrdered) => {\r\n  if (nextMoveData.moveRow === 4 && nextMoveData.moveSide === \"w\" && nextMoveData.moveType === \"move\") {\r\n    nextMoveData.possiblePositions.push({\r\n      \"column\": nextMoveData.moveColumn,\r\n      \"row\": 3\r\n    });\r\n    nextMoveData.possiblePositions.push({\r\n      \"column\": nextMoveData.moveColumn,\r\n      \"row\": 2\r\n    });\r\n  } else if (nextMoveData.moveRow === 5 && nextMoveData.moveSide === \"b\" && nextMoveData.moveType === \"move\") {\r\n    nextMoveData.possiblePositions.push({\r\n      \"column\": nextMoveData.moveColumn,\r\n      \"row\": 7\r\n    });\r\n    nextMoveData.possiblePositions.push({\r\n      \"column\": nextMoveData.moveColumn,\r\n      \"row\": 6\r\n    });\r\n  } else if (nextMoveData.moveType === \"move\") {\r\n    nextMoveData.possiblePositions.push({\r\n      \"column\": nextMoveData.moveColumn,\r\n      \"row\": nextMoveData.moveSide === \"w\" ? nextMoveData.moveRow - 1 : nextMoveData.moveRow + 1\r\n    });\r\n  } else if (nextMoveData.moveType === \"take\") {\r\n    // mundane take :\r\n    if (nextMoveData.comingFromColumn !== \"\") {\r\n      nextMoveData.possiblePositions.push({\r\n        \"column\": nextMoveData.comingFromColumn,\r\n        \"row\": nextMoveData.moveSide === \"w\" ? nextMoveData.moveRow - 1 : nextMoveData.moveRow + 1\r\n      });\r\n    } else {\r\n      let posMoveColumn = columnsOrdered.indexOf(nextMoveData.moveColumn);\r\n      if (posMoveColumn === 0) { // pawn takes on \"a\" file : only one possibility, it's on \"b\" file\r\n        nextMoveData.possiblePositions.push({\r\n          \"column\": columnsOrdered[1],\r\n          \"row\": nextMoveData.moveSide === \"w\" ? nextMoveData.moveRow - 1 : nextMoveData.moveRow + 1\r\n        });\r\n        //setEnPassantLeftSide(nextMoveData,columnsOrdered,posMoveColumn);\r\n      } else if (posMoveColumn === 7) { // pawn takes on \"h\" file : only one possibility, it's on \"g\" file\r\n        nextMoveData.possiblePositions.push({\r\n          \"column\": columnsOrdered[6],\r\n          \"row\": nextMoveData.moveSide === \"w\" ? nextMoveData.moveRow - 1 : nextMoveData.moveRow + 1\r\n        });\r\n        //setEnPassantRightSide(nextMoveData,columnsOrdered,posMoveColumn);\r\n      } else { // 2 possibilities the pawn is either coming from the left side or the right side of the taken piece column\r\n        nextMoveData.possiblePositions.push({\r\n          \"column\": columnsOrdered[posMoveColumn - 1],\r\n          \"row\": nextMoveData.moveSide === \"w\" ? nextMoveData.moveRow - 1 : nextMoveData.moveRow + 1\r\n        });\r\n        //setEnPassantLeftSide(nextMoveData,columnsOrdered,posMoveColumn);\r\n        nextMoveData.possiblePositions.push({\r\n          \"column\": columnsOrdered[posMoveColumn + 1],\r\n          \"row\": nextMoveData.moveSide === \"w\" ? nextMoveData.moveRow - 1 : nextMoveData.moveRow + 1\r\n        });\r\n        //setEnPassantRightSide(nextMoveData,columnsOrdered,posMoveColumn);\r\n      }\r\n    }\r\n  } else {\r\n    nextMoveData.isError = true;\r\n  }\r\n}\r\n\r\nconst setBishopPossiblePreviousPositions = (nextMoveData,columnsOrdered) => {\r\n // diagonally\r\n let rowPos = nextMoveData.moveRow;// starts at 1\r\n let convenientShift = 1;\r\n let colPos = columnsOrdered.indexOf(nextMoveData.moveColumn) + convenientShift; // starts at 0\r\n\r\n  // each +1 row +1 col\r\nlet c = colPos + 1;\r\nlet r = rowPos + 1;\r\nfor (let i = 0; i < 9; i++) {\r\n  if (c < 9 && r < 9) {\r\n    let possibleMove = {\r\n      \"column\": columnsOrdered[c - convenientShift],\r\n      \"row\": r\r\n    };\r\n    if ((nextMoveData.comingFromRow === 0 || possibleMove.row === nextMoveData.comingFromRow) &&\r\n      (nextMoveData.comingFromColumn === \"\" || possibleMove.column === nextMoveData.comingFromColumn)) {\r\n      nextMoveData.possiblePositions.push(possibleMove);\r\n    }\r\n  }\r\n  c++;\r\n  r++;\r\n}\r\n\r\n // each +1 row -1 col\r\n c = colPos - 1;\r\n r = rowPos + 1;\r\n for (let i = 0; i < 9; i++) {\r\n   if (c > 0 && r < 9) {\r\n     let possibleMove = {\r\n       \"column\": columnsOrdered[c - convenientShift],\r\n       \"row\": r\r\n     };\r\n     if ((nextMoveData.comingFromRow === 0 || possibleMove.row === nextMoveData.comingFromRow) &&\r\n       (nextMoveData.comingFromColumn === \"\" || possibleMove.column === nextMoveData.comingFromColumn)) {\r\n       nextMoveData.possiblePositions.push(possibleMove);\r\n     }\r\n   }\r\n   c--;\r\n   r++;\r\n }\r\n // each -1 row +1 col\r\n c = colPos + 1;\r\n r = rowPos - 1;\r\n for (let i = 0; i < 9; i++) {\r\n  if (c <  9 && r > 0) {\r\n    let possibleMove = {\r\n      \"column\": columnsOrdered[c - convenientShift],\r\n      \"row\": r\r\n    };\r\n    if ((nextMoveData.comingFromRow === 0 || possibleMove.row === nextMoveData.comingFromRow) &&\r\n      (nextMoveData.comingFromColumn === \"\" || possibleMove.column === nextMoveData.comingFromColumn)) {\r\n      nextMoveData.possiblePositions.push(possibleMove);\r\n    }\r\n  }\r\n  c++;\r\n  r--;\r\n}\r\n // each -1 row -1 col\r\n c = colPos-1;\r\n r = rowPos-1;\r\n  for(let i = 8 ;i > 0; i--){\r\n     if (c > 0 && c > 0) {\r\n       let possibleMove = {\r\n         \"column\": columnsOrdered[c - convenientShift],\r\n         \"row\": r\r\n       };\r\n       if ((nextMoveData.comingFromRow === 0 || possibleMove.row === nextMoveData.comingFromRow) &&\r\n         (nextMoveData.comingFromColumn === \"\" || possibleMove.column === nextMoveData.comingFromColumn)) {\r\n         nextMoveData.possiblePositions.push(possibleMove);\r\n       }\r\n     }\r\n     c--;\r\n     r--;\r\n  }\r\n}\r\n\r\nconst setKnightPossiblePreviousPositions = (nextMoveData,columnsOrdered) => {\r\n        // either 2 rows and 1 column aside or 1 row and 2 col aside\r\n        let rowPos = nextMoveData.moveRow;// starts at 1\r\n        let convenientShift = 1;\r\n        let colPos = columnsOrdered.indexOf(nextMoveData.moveColumn) + convenientShift; // starts at 1\r\n        // - 2 row - 1 col\r\n        if(rowPos - 2 > 0 && colPos - 1 > 0){\r\n          let possibleMove = {\"column\":columnsOrdered[colPos - 1 - convenientShift],\"row\":rowPos - 2};\r\n          if((nextMoveData.comingFromRow === 0 || possibleMove.row === nextMoveData.comingFromRow ) \r\n          && (nextMoveData.comingFromColumn === \"\" || possibleMove.column === nextMoveData.comingFromColumn )){\r\n            nextMoveData.possiblePositions.push(possibleMove);\r\n          }\r\n        }\r\n        // - 2 row + 1 col\r\n        if(rowPos - 2 > 0 && colPos + 1 < 9){\r\n          let possibleMove = {\"column\":columnsOrdered[colPos + 1 - convenientShift],\"row\":rowPos - 2};\r\n          if((nextMoveData.comingFromRow === 0 || possibleMove.row === nextMoveData.comingFromRow ) \r\n          && (nextMoveData.comingFromColumn === \"\" || possibleMove.column === nextMoveData.comingFromColumn )){\r\n            nextMoveData.possiblePositions.push(possibleMove);\r\n          }\r\n        }\r\n        // + 2 row - 1 col\r\n        if(rowPos + 2 < 9 && colPos - 1 > 0){\r\n          let possibleMove = {\"column\":columnsOrdered[colPos - 1 - convenientShift],\"row\":rowPos + 2};\r\n          if((nextMoveData.comingFromRow === 0 || possibleMove.row === nextMoveData.comingFromRow ) \r\n          && (nextMoveData.comingFromColumn === \"\" || possibleMove.column === nextMoveData.comingFromColumn )){\r\n            nextMoveData.possiblePositions.push(possibleMove);\r\n          }\r\n        }\r\n        // + 2 row + 1 col\r\n        if(rowPos + 2 < 9 && colPos + 1 < 9){\r\n          let possibleMove = {\"column\":columnsOrdered[colPos + 1 - convenientShift],\"row\":rowPos + 2};\r\n          if((nextMoveData.comingFromRow === 0 || possibleMove.row === nextMoveData.comingFromRow ) \r\n          && (nextMoveData.comingFromColumn === \"\" || possibleMove.column === nextMoveData.comingFromColumn )){\r\n            nextMoveData.possiblePositions.push(possibleMove);\r\n          }\r\n        }\r\n        // - 1 row - 2 col\r\n        if(rowPos - 1 > 0 && colPos - 2 > 0){\r\n          let possibleMove = {\"column\":columnsOrdered[colPos - 2 - convenientShift],\"row\":rowPos - 1};\r\n          if((nextMoveData.comingFromRow === 0 || possibleMove.row === nextMoveData.comingFromRow ) \r\n          && (nextMoveData.comingFromColumn === \"\" || possibleMove.column === nextMoveData.comingFromColumn )){\r\n            nextMoveData.possiblePositions.push(possibleMove);\r\n          }\r\n        }\r\n        // - 1 row + 2 col\r\n        if(rowPos - 1 > 0 && colPos + 2 < 9){\r\n          let possibleMove = {\"column\":columnsOrdered[colPos + 2 - convenientShift],\"row\":rowPos - 1};\r\n          if((nextMoveData.comingFromRow === 0 || possibleMove.row === nextMoveData.comingFromRow ) \r\n          && (nextMoveData.comingFromColumn === \"\" || possibleMove.column === nextMoveData.comingFromColumn )){\r\n            nextMoveData.possiblePositions.push(possibleMove);\r\n          }\r\n        }\r\n        // + 1 row - 2 col\r\n        if(rowPos + 1 < 9 && colPos - 2 > 0){\r\n          let possibleMove = {\"column\":columnsOrdered[colPos - 2 - convenientShift],\"row\":rowPos + 1};\r\n          if((nextMoveData.comingFromRow === 0 || possibleMove.row === nextMoveData.comingFromRow ) \r\n          && (nextMoveData.comingFromColumn === \"\" || possibleMove.column === nextMoveData.comingFromColumn )){\r\n            nextMoveData.possiblePositions.push(possibleMove);\r\n          }\r\n        }\r\n        // + 1 row + 2 col\r\n        if(rowPos + 1 < 9 && colPos + 2 < 9){\r\n          let possibleMove = {\"column\":columnsOrdered[colPos + 2 - convenientShift],\"row\":rowPos + 1};\r\n          if((nextMoveData.comingFromRow === 0 || possibleMove.row === nextMoveData.comingFromRow ) \r\n          && (nextMoveData.comingFromColumn === \"\" || possibleMove.column === nextMoveData.comingFromColumn )){\r\n            nextMoveData.possiblePositions.push(possibleMove);\r\n          }\r\n        }\r\n\r\n}\r\nconst pngToTurns = (pgnGame) => {\r\n  let turns = [];\r\n  let turn = 1;\r\n  let turnPrevPosition =  pgnGame.indexOf(turn+\".\");\r\n  let turnNextPosition = 0;\r\n  let currentTurnData;\r\n  let end;\r\n  while (turnPrevPosition !== -1 && turnNextPosition !== -1){\r\n    turnNextPosition =  pgnGame.indexOf((turn+1)+\".\");\r\n    if(turnNextPosition !==-1){\r\n      end = turnNextPosition;\r\n    }else{\r\n      end = turnPrevPosition + 100;\r\n    }\r\n      currentTurnData = pgnGame.substring(turnPrevPosition, end).replace(turn+\".\",\"\").trim();\r\n      let moves = currentTurnData.split(\" \");\r\n      let turnInfo = {\"w\":moves[0]};\r\n      if(moves.length === 2){\r\n        turnInfo.b = moves[1];\r\n      }\r\n      turns.push(turnInfo);\r\n      turnPrevPosition = turnNextPosition;\r\n    turn++;\r\n  } \r\n  return turns;\r\n}\r\n\r\nconst pngToInfos = (infos) => {\r\n  infos = infos.split(\",\");\r\n  let infosClean = {};\r\n  infos.forEach(function(raw){\r\n    let clean = raw.replace(/\\\\|\\[|\\]|\"/g, \"\");\r\n    let pos = clean.indexOf(\" \");\r\n    if(pos !== -1){\r\n      let key = clean.substring(0,pos);\r\n      let value = clean.substring(pos+1,clean.length);\r\n      infosClean[key] = value;\r\n    }\r\n  });\r\n  return infosClean;\r\n}\r\n\r\nconst getMoveOffset = (move) => {\r\n  return move.number === 0 ? 0 : ((move.number-1)*2) + (move.side === \"w\" ? 1 : 2);\r\n}\r\n\r\nconst boardToScore = (data) => {\r\n  let scores = {\r\n    \"whiteScore\" : 0,\r\n    \"blackScore\" : 0,\r\n    \"whiteJail\" : [],\r\n    \"blackJail\" : []\r\n  }\r\n  let scoreWhite = 0;\r\n  let scoreBlack = 0;\r\n  let figs = [\"p\",\"R\",\"B\",\"N\",\"Q\"];\r\n  let figsValues = [1,5,3,3,9];\r\n\r\n  let whiteTeam = {\r\n    \"p\": 0, \r\n    \"R\": 0, \r\n    \"B\": 0, \r\n    \"N\": 0, \r\n    \"Q\": 0\r\n  }\r\n  \r\n  let blackTeam = {\r\n    \"p\": 0, \r\n    \"R\": 0, \r\n    \"B\": 0, \r\n    \"N\": 0, \r\n    \"Q\": 0\r\n  }\r\n\r\n  let originalTeam = {\r\n    \"p\": 8, \r\n    \"R\": 2, \r\n    \"B\": 2, \r\n    \"N\": 2, \r\n    \"Q\": 1\r\n  }\r\n\r\n  data.forEach((x,i) => {\r\n      if(x.fig !== null){\r\n          let figure = x.fig.charAt(0);\r\n          let pos = figs.indexOf(figure);\r\n          if(pos !== -1){\r\n              if( x.fig.charAt(1)===\"W\"){\r\n                  whiteTeam[figure] +=1;\r\n                  scoreWhite+=figsValues[pos];\r\n              }else{\r\n                  blackTeam[figure] +=1;\r\n                  scoreBlack+=figsValues[pos];\r\n              }\r\n          }\r\n      }\r\n  })\r\n\r\n  scores.whiteScore = scoreWhite - scoreBlack;\r\n  scores.blackScore = scoreBlack - scoreWhite;\r\n\r\n  for (const item in whiteTeam) {\r\n    let nr = originalTeam[item] - whiteTeam[item];\r\n    for (let i = 0; i < nr; i++) {\r\n      scores.blackJail.push(item);\r\n    }\r\n  }\r\n\r\n  for (const item in blackTeam) {\r\n    let nr = originalTeam[item] - blackTeam[item];\r\n    for (let i = 0; i < nr; i++) {\r\n      scores.whiteJail.push(item);\r\n    }\r\n  }\r\n  return scores;\r\n}\r\n     \r\nconst getPositionsAt = (nextMoveData, gamePositions) => {\r\n  if (!nextMoveData.isError && !nextMoveData.isDone) {\r\n    let hasMoved = false;\r\n    if (nextMoveData.possiblePositions && nextMoveData.possiblePositions.length > 0) {\r\n      for (let i = 0; i < nextMoveData.possiblePositions.length; i++) {\r\n        if (hasMoved) break;\r\n        for (let j = 0; j < gamePositions.length; j++) {\r\n          if (gamePositions[j].column === nextMoveData.possiblePositions[i].column && gamePositions[j].row === nextMoveData.possiblePositions[i].row) {\r\n            if (gamePositions[j].fig === (nextMoveData.movePieceType + nextMoveData.moveSide.toUpperCase())) {\r\n              hasMoved = true;\r\n              gamePositions[j].fig = null;\r\n              break;\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      if (nextMoveData.additionalMove !== null) {\r\n        let hasMovedKing = hasMoved;\r\n        let hasMovedRook = false;\r\n        for (let i = 0; i < gamePositions.length; i++) {\r\n          // Rook\r\n          if (gamePositions[i].column === nextMoveData.additionalMove.possiblePositions[0].column && gamePositions[i].row === nextMoveData.additionalMove.possiblePositions[0].row) {\r\n            if (gamePositions[i].fig === nextMoveData.additionalMove.movePieceType + nextMoveData.additionalMove.moveSide.toUpperCase()) {\r\n              hasMovedRook = true;\r\n              gamePositions[i].fig = null;\r\n            }\r\n          }\r\n        }\r\n        hasMoved = hasMovedKing && hasMovedRook;\r\n      }\r\n    }\r\n    if (nextMoveData.uniqueFigure === true) {\r\n      for (let i = 0; i < gamePositions.length; i++) {\r\n        if (gamePositions[i].fig === nextMoveData.movePieceType + nextMoveData.moveSide.toUpperCase()) {\r\n          hasMoved = true;\r\n          gamePositions[i].fig = null;\r\n          break;\r\n        }\r\n      }\r\n    }\r\n    if (hasMoved) {\r\n      for (let i = 0; i < gamePositions.length; i++) {\r\n        if (gamePositions[i].column === nextMoveData.moveColumn && gamePositions[i].row === nextMoveData.moveRow) {\r\n          if (nextMoveData.moveType === \"take\") {\r\n            if (gamePositions[i].fig === null && nextMoveData.movePieceType === \"p\") { // En passant\r\n              let delta = nextMoveData.moveSide === \"w\" ? 8 : -8;\r\n              gamePositions[i + delta].fig = null;\r\n            }\r\n            gamePositions[i].fig = nextMoveData.movePieceType + nextMoveData.moveSide.toUpperCase();\r\n\r\n          } else {\r\n            gamePositions[i].fig = nextMoveData.promoteTo ? nextMoveData.promoteTo + nextMoveData.moveSide.toUpperCase() : nextMoveData.movePieceType + nextMoveData.moveSide.toUpperCase();\r\n          }\r\n          break;\r\n        }\r\n      }\r\n      if (nextMoveData.additionalMove != null) {\r\n        for (let i = 0; i < gamePositions.length; i++) {\r\n          if (gamePositions[i].column === nextMoveData.additionalMove.moveColumn && gamePositions[i].row === nextMoveData.additionalMove.moveRow) {\r\n            gamePositions[i].fig = nextMoveData.additionalMove.movePieceType + nextMoveData.additionalMove.moveSide.toUpperCase();\r\n            break;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n  return gamePositions;\r\n}\r\n\r\nexport {getMoveOffset,getAskedMove,getNextMove,pngToTurns,pngToInfos,getMoveDataAt,getPositionsAt,boardToScore};","\r\nclass ManageStorage {\r\n  constructor(props) {\r\n  this.key = \"887579374078148608\"\r\n  }\r\n\r\n    initRemote = () => {\r\n      const url = \"https://jsonblob.com/api/jsonBlob/\" + this.key\r\n      return new Promise(function (resolve, reject) {\r\n          var xhr = new XMLHttpRequest();\r\n          xhr.open(\"GET\", url);\r\n          xhr.onload = function () {\r\n            if (this.status >= 200 && this.status < 300) {\r\n              try {\r\n                let data = JSON.parse(xhr.response);\r\n                resolve(data);\r\n\r\n              } catch (e) {\r\n                reject(e);\r\n              }\r\n            } else {\r\n              reject(xhr.statusText);\r\n            }\r\n          };\r\n          xhr.onerror = function () {\r\n            reject(xhr.statusText);\r\n          };\r\n          xhr.send();\r\n      });\r\n    }\r\n\r\n    setRemote = (data) => {\r\n      const url = \"https://jsonblob.com/api/jsonBlob/\" + this.key\r\n      return new Promise(function (resolve, reject) {\r\n          var xhr = new XMLHttpRequest();\r\n          xhr.open(\"PUT\", url,true);\r\n          xhr.setRequestHeader('Content-type', 'application/json; charset=utf-8');\r\n          xhr.onload = function () {\r\n            if (this.status >= 200 && this.status < 300) {\r\n              try {\r\n                resolve(\"OK\");\r\n\r\n              } catch (e) {\r\n                reject(\"KO\");\r\n              }\r\n            } else {\r\n              reject(\"KO\");\r\n            }\r\n          };\r\n          xhr.onerror = function () {\r\n            reject(\"KO\");\r\n          };\r\n          xhr.send(JSON.stringify(data));\r\n      });\r\n    }\r\n\r\n    setLocal(data){\r\n      if(typeof (Storage) !== \"undefined\"){\r\n      try{\r\n        localStorage.setItem(\"games\", JSON.stringify(data));\r\n      }catch(e){\r\n\r\n      }\r\n     }\r\n    }\r\n\r\n    initLocal() {\r\n        return new Promise(function (resolve, reject) {\r\n            if(typeof (Storage) === \"undefined\"){\r\n              reject(\"localStorage not supported\");\r\n            }else{\r\n              if (localStorage.getItem(\"games\") !== null) {\r\n                let dataJson = localStorage.getItem(\"games\");\r\n                try {\r\n                    let data = JSON.parse(dataJson);\r\n                    resolve(data);\r\n                } catch (e) {\r\n                    reject(e);\r\n                }\r\n              }\r\n            }\r\n        });\r\n    }\r\n  }\r\n\r\n  export {ManageStorage};\r\n","//4r3/N1kbQ3/2r2p2/4p1p1/8/7P/PP4P1/2q2NK1 w - - 5 32\r\nimport {charIsLowercase} from './utils.js';\r\n\r\nconst boardToFen = (gamePositions,nextMoveData,columnsOrdered) => {\r\nlet fen = \"\";\r\nlet separator = \"\";\r\nlet index = 0;\r\nlet nullCounter = 0;\r\nlet currentFigure = \"\";\r\n[1,2,3,4,5,6,7,8].forEach((row) => {\r\n    fen+=separator;\r\n    separator = \"/\";\r\n    nullCounter = 0;\r\n    columnsOrdered.forEach((x,col) => {\r\n        index = (row-1) * 8 + col;\r\n        currentFigure = gamePositions[index].fig;\r\n        if(currentFigure === null){\r\n            nullCounter++;\r\n        }else{\r\n            if(nullCounter > 0){\r\n                fen+=nullCounter+\"\";\r\n                nullCounter = 0;\r\n            }\r\n            if(currentFigure.charAt(1) === \"B\"){\r\n                fen+=currentFigure.charAt(0).toLowerCase();\r\n            }else{\r\n                fen+=currentFigure.charAt(0).toUpperCase();\r\n            }\r\n        }\r\n    })\r\n    if(nullCounter > 0){\r\n        fen+=nullCounter+\"\";\r\n        nullCounter = 0;\r\n    }\r\n})\r\n\r\n// posible castles are missing and number of moves since the last pawn move or check (?)\r\nfen += \" \" + nextMoveData.moveSide + \" - - 0 \" + nextMoveData.number ;\r\n    return fen;\r\n}\r\n\r\nconst fenToBoard = (fen,board,columnsOrdered) => {\r\n    if(!fen) return null;\r\n    let parts = fen.split(\" \");\r\n    let colDatas = parts[0].split(\"/\");\r\n    if(colDatas.length !== 8) return null;\r\n    let cursorPos = -1\r\n    colDatas.forEach((colData,i) => {\r\n        cursorPos = i*8;\r\n        let colDataLen = colData.length;\r\n        for(let c = 0;c < colDataLen;c++ ){\r\n            let char = colData.charAt(c);\r\n            let intTry = parseInt(char);\r\n            if (!isNaN(intTry)) {\r\n                for (let d = 0; d < intTry; d++) {\r\n                    board[cursorPos + d].fig = null;\r\n                }\r\n                cursorPos+=intTry;\r\n            }else{\r\n                let side = \"W\";\r\n                let fig = char;\r\n                if(charIsLowercase(char)){ // Black\r\n                    side = \"B\";\r\n                    if (char === \"p\") {\r\n                        fig = \"p\";\r\n                    } else {\r\n                        fig = char.toUpperCase();\r\n                    }\r\n                }else{ // White\r\n                    if (char === \"P\") {\r\n                        fig = \"p\";\r\n                    } else {\r\n                        fig = char;\r\n                    }\r\n                } \r\n                board[cursorPos].fig = fig + side;\r\n                cursorPos++;\r\n            }\r\n        }\r\n    });\r\n\r\n    return board;\r\n}\r\n\r\nexport {boardToFen,fenToBoard};","import React from 'react';\r\nimport './game.styles.css';\r\nimport Board from '../board/board.component';\r\nimport Info from '../info/info.component';\r\nimport { getAskedMove, getNextMove, pngToTurns, pngToInfos, getMoveDataAt, getPositionsAt ,boardToScore} from '../../movesLogic.js';\r\nimport { ManageStorage} from '../../storage.js';\r\nimport { boardToFen, fenToBoard } from '../../fen.js';\r\n\r\nclass Game extends React.Component {\r\n  constructor(props) {\r\n    super();\r\n    this.gameStatus = {\r\n      \"init\": 0,\r\n      \"showList\": 1,\r\n      \"showInput\": 2,\r\n      \"showMoves\": 3,\r\n      \"showMessage\": 4,\r\n      \"inError\": -1,\r\n    };\r\n\r\n    this.state = {\r\n      \"storageManager\":null,\r\n      \"isRemote\": true,\r\n      \"initError\":false,\r\n      \"games\": [],\r\n      \"scores\" : {\r\n        \"whiteScore\" : 0,\r\n        \"blackScore\" : 0,\r\n        \"whiteJail\" : [],\r\n        \"blackJail\" : []\r\n      },\r\n      \"gameKey\": 0,\r\n      \"doReverseBoard\" :false,\r\n      \"proposeSave\": false,\r\n      \"status\": this.gameStatus.init,\r\n      \"readerStop\": false,\r\n      \"initialData\": null,\r\n      \"gameIsReady\": false,\r\n      \"infosTitle\": \"\",\r\n      \"infosMessage\": \"\",\r\n      \"msg\": \"White to play\",\r\n      \"data\": [],\r\n      \"pgnHistory\": \"\",\r\n      \"move\": { \"number\": 0, \"side\": \"b\" },\r\n      \"pgnResume\": [],\r\n      \"pgnGame\": [],\r\n      \"fenGame\": [{ \"number\": 0, \"side\": \"w\", \"fen\": \"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1\" }],\r\n      \"positions\": [],\r\n      \"columns\": \"a,b,c,d,e,f,g,h\".split(\",\"), // \"columns\" or \"files\"\r\n      \"rows\": [1, 2, 3, 4, 5, 6, 7, 8],\r\n      \"figures\": \"R,N,B,Q,K,B,N,R\".split(\",\"),\r\n      \"pawn\": \"p\",\r\n      \"black\": \"B\",\r\n      \"white\": \"W\",\r\n      \"blackColor\": \"dark-square\",\r\n      \"whiteColor\": \"light-square\",\r\n      \"nrSquaresPerside\": 8, // in case we want to change the rules !!!\r\n      \"figCodes\": {\r\n        \"KB\": \"&#9818;\",\r\n        \"QB\": \"&#9819;\",\r\n        \"RB\": \"&#9820;\",\r\n        \"BB\": \"&#9821;\",\r\n        \"NB\": \"&#9822;\",\r\n        \"pB\": \"&#9823;\",\r\n        \"KW\": \"&#9812;\",\r\n        \"QW\": \"&#9813;\",\r\n        \"RW\": \"&#9814;\",\r\n        \"BW\": \"&#9815;\",\r\n        \"NW\": \"&#9816;\",\r\n        \"pW\": \"&#9817;\",\r\n      }\r\n    };\r\n  }\r\n\r\n  reverseBoard= (e) => {\r\n    let doReverse= !this.state.doReverseBoard;\r\n    this.setState((state, props) => (\r\n      {\r\n        \"doReverseBoard\": doReverse,\r\n      }\r\n    ));\r\n  }\r\n\r\n  deleteGame= (e) => {\r\n    let id = Number(e.currentTarget.getAttribute(\"data-index\"));\r\n    this.doDeleteGame(id);\r\n  }\r\n\r\n  loadGame = (e) => {\r\n    let id = Number(e.currentTarget.getAttribute(\"data-index\"));\r\n    this.doLoadGame(id);\r\n  }\r\n\r\n  doDeleteGame = (id) => {\r\n    let factory = this;\r\n    if (this.state.isRemote && this.state.storageManager) {\r\n      let games = this.state.games.filter((game) => {\r\n        return game.id !== id;\r\n      })\r\n\r\n      let otherProps = {\r\n        games: games\r\n      }\r\n\r\n      factory.state.storageManager.setRemote(games)\r\n        .then(function (response) {\r\n          if (response === \"OK\") {\r\n            factory.state.storageManager.setLocal(games);\r\n            let newStatus = games && games.length > 0 ? factory.gameStatus.showList : factory.gameStatus.showInput;\r\n            factory.setGameStatus(newStatus, \"\", otherProps);\r\n          }\r\n        })\r\n        .catch(function (response) {\r\n\r\n        });\r\n    }\r\n  }\r\n\r\n  doLoadGame = (id) => {\r\n    let gamesFilter = this.state.games.filter((game) => {\r\n      return game.id === id;\r\n    })\r\n    if (gamesFilter.length === 1) {\r\n      let game = gamesFilter[0];\r\n      let otherProps = {\r\n        \"data\": JSON.parse(this.state.initialData),\r\n        \"pgnResume\": game.pgnResume,\r\n        \"pgnHistory\": game.pgnHistory,\r\n        \"pgnGame\": game.pgnGame,\r\n        \"fenGame\": game.fenGame,\r\n        \"move\": {\r\n          \"number\": 0,\r\n          \"side\": \"w\"\r\n        },\r\n        \"scores\": {\r\n          \"whiteScore\": 0,\r\n          \"blackScore\": 0,\r\n          \"whiteJail\": [],\r\n          \"blackJail\": []\r\n        }\r\n      }\r\n      this.setGameStatus(this.gameStatus.showMoves, \"\", otherProps);\r\n    }\r\n  }\r\n\r\n  moveGameTo = (askedMove) => {\r\n    let timing = 10;\r\n    if (\"pace\" in askedMove) {\r\n      if (askedMove.pace === \"quick\") {\r\n        timing = 1;\r\n      }\r\n    }\r\n    let currentMove = this.state.move;\r\n    let gamePgn = this.state.pgnGame;\r\n    let gamePositions = this.state.data;\r\n    let columnsOrdered = this.state.columns.slice(0)\r\n    let nextMoveData = getNextMove(gamePgn, currentMove, askedMove, columnsOrdered);\r\n\r\n    if (!nextMoveData.isError && !nextMoveData.isDone) {\r\n      let hasMoved = false;\r\n      if (nextMoveData.possiblePositions && nextMoveData.possiblePositions.length > 0) {\r\n        for (let i = 0; i < nextMoveData.possiblePositions.length; i++) {\r\n          if (hasMoved) break;\r\n          for (let j = 0; j < gamePositions.length; j++) {\r\n            if (gamePositions[j].column === nextMoveData.possiblePositions[i].column && gamePositions[j].row === nextMoveData.possiblePositions[i].row) {\r\n              if (gamePositions[j].fig === (nextMoveData.movePieceType + nextMoveData.moveSide.toUpperCase())) {\r\n                hasMoved = true;\r\n                gamePositions[j].fig = null;\r\n                break;\r\n              }\r\n            }\r\n          }\r\n        }\r\n\r\n        if (nextMoveData.additionalMove !== null) {\r\n          let hasMovedKing = hasMoved;\r\n          let hasMovedRook = false;\r\n          for (let i = 0; i < gamePositions.length; i++) {\r\n            // Rook\r\n            if (gamePositions[i].column === nextMoveData.additionalMove.possiblePositions[0].column && gamePositions[i].row === nextMoveData.additionalMove.possiblePositions[0].row) {\r\n              if (gamePositions[i].fig === nextMoveData.additionalMove.movePieceType + nextMoveData.additionalMove.moveSide.toUpperCase()) {\r\n                hasMovedRook = true;\r\n                gamePositions[i].fig = null;\r\n              }\r\n            }\r\n          }\r\n          hasMoved = hasMovedKing && hasMovedRook;\r\n        }\r\n      }\r\n      if (nextMoveData.uniqueFigure === true) {\r\n        for (let i = 0; i < gamePositions.length; i++) {\r\n          if (gamePositions[i].fig === nextMoveData.movePieceType + nextMoveData.moveSide.toUpperCase()) {\r\n            hasMoved = true;\r\n            gamePositions[i].fig = null;\r\n            break;\r\n          }\r\n        }\r\n      }\r\n      if (hasMoved) {\r\n        for (let i = 0; i < gamePositions.length; i++) {\r\n          if (gamePositions[i].column === nextMoveData.moveColumn && gamePositions[i].row === nextMoveData.moveRow) {\r\n            if (nextMoveData.moveType === \"take\") {\r\n              if (gamePositions[i].fig === null && nextMoveData.movePieceType === \"p\") { // En passant\r\n                let delta = nextMoveData.moveSide === \"w\" ? 8 : -8;\r\n                gamePositions[i + delta].fig = null;\r\n              }\r\n              gamePositions[i].fig = nextMoveData.movePieceType + nextMoveData.moveSide.toUpperCase();\r\n\r\n            } else {\r\n              gamePositions[i].fig = nextMoveData.promoteTo ? nextMoveData.promoteTo + nextMoveData.moveSide.toUpperCase() : nextMoveData.movePieceType + nextMoveData.moveSide.toUpperCase();\r\n            }\r\n            break;\r\n          }\r\n        }\r\n        if (nextMoveData.additionalMove != null) {\r\n          for (let i = 0; i < gamePositions.length; i++) {\r\n            if (gamePositions[i].column === nextMoveData.additionalMove.moveColumn && gamePositions[i].row === nextMoveData.additionalMove.moveRow) {\r\n              gamePositions[i].fig = nextMoveData.additionalMove.movePieceType + nextMoveData.additionalMove.moveSide.toUpperCase();\r\n              break;\r\n            }\r\n          }\r\n        }\r\n\r\n        let fenGame = this.state.fenGame;\r\n        let fenData = fenGame.filter((x) => {\r\n          return x.number === nextMoveData.number && x.side === nextMoveData.moveSide;\r\n        });\r\n        if (fenData.length === 0) {\r\n          let gamePositions = this.state.data;\r\n          let columnsOrdered = this.state.columns.slice(0)\r\n          let fen = boardToFen(gamePositions, nextMoveData, columnsOrdered);\r\n          if (fen) {\r\n            fenGame.push({ \"number\": nextMoveData.number, \"side\": nextMoveData.moveSide, \"fen\": fen });\r\n          }\r\n        }\r\n        this.setState((state, props) => (\r\n          {\r\n            \"data\": gamePositions,\r\n            \"move\": { number: nextMoveData.number, side: nextMoveData.moveSide },\r\n            \"fenGame\": fenGame,\r\n            \"status\": this.gameStatus.showMoves\r\n          }\r\n        ));\r\n          let that = this;\r\n            setTimeout(function () {\r\n              that.moveGameTo(askedMove);\r\n            }, timing);\r\n      }\r\n    }\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.initData();\r\n  }\r\n\r\n  menuMove = (e) => {\r\n    let target = e.currentTarget.getAttribute(\"data-target\");\r\n    if (target in this.gameStatus) {\r\n      this.setGameStatus(this.gameStatus[target]);\r\n    }\r\n  }\r\n\r\n  movePGN = (e) => {\r\n    let elem;\r\n    if (\"move\" in e) {\r\n      elem = e;\r\n    } else {\r\n      elem = (e.currentTarget).dataset;\r\n    }\r\n    let currentMove = this.state.move;\r\n    let askedMove = getAskedMove(elem, currentMove, this.state.pgnGame);\r\n    let fenMove = this.state.fenGame.filter((x) => {\r\n      return x.number === askedMove.number && x.side === askedMove.side;\r\n    });\r\n    if (fenMove.length !== 0) {\r\n      let columnsOrdered = this.state.columns.slice(0)\r\n      let reinitData = JSON.parse(this.state.initialData);\r\n      reinitData = fenToBoard(fenMove[0].fen, reinitData, columnsOrdered);\r\n      let scores = boardToScore(reinitData);\r\n\r\n      this.setState((state, props) => (\r\n        {\r\n          data: reinitData,\r\n          scores:scores,\r\n          move: {\r\n            number: askedMove.number,\r\n            side: askedMove.side\r\n          }\r\n        }\r\n      ));\r\n    }\r\n  }\r\n\r\n  savePGN = () => {\r\n  //  let that = this;\r\n  this.setGameStatus(this.gameStatus.showMessage, \"Analyzing and saving your game\");\r\n      let textArea = document.getElementById(\"game-input\");\r\n      if (textArea != null) {\r\n        let pgn = textArea.value;\r\n        if (pgn !== \"\") { // todo check validity !\r\n          let limitBetweenGameParts = /\\n\\n/.exec(pgn).index;\r\n          let pngInfos = pgn.substring(0, limitBetweenGameParts).replace(/\\r\\n?|\\n/g, \",\").trim();\r\n          let pgnGame = pgn.substring(limitBetweenGameParts, pgn.length).replace(/\\r\\n?|\\n/g, \" \").trim();\r\n          // putting the infos in an object\r\n          let infosClean = pngToInfos(pngInfos);\r\n          if(!infosClean.Site){\r\n            infosClean.Site = \"???\";\r\n          }\r\n          // putting the game into an array of turns ex : [{\"w\":\"a4\",\"b\":\"a5\"}]\r\n          let turns = pngToTurns(pgnGame);\r\n          // calculating the fens for every half move\r\n          let fenGame = [{ \"number\": 0, \"side\": \"w\", \"fen\": \"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1\" }];\r\n          let positions = JSON.parse(this.state.initialData);\r\n          let columnsOrdered = this.state.columns.slice(0)\r\n  \r\n          turns.forEach((turn, i) => {\r\n            [\"w\", \"b\"].forEach((side) => {\r\n              if (side in turn) {\r\n                let nextMoveData = getMoveDataAt(turn, side, i + 1, positions, columnsOrdered);\r\n                positions = getPositionsAt(nextMoveData, positions);\r\n                let fen = boardToFen(positions, nextMoveData, columnsOrdered);\r\n                if (fen) {\r\n                  fenGame.push({ \"number\": nextMoveData.number, \"side\": nextMoveData.moveSide, \"fen\": fen });\r\n                }\r\n              }\r\n            });\r\n          });\r\n          let gameToSave = {\r\n            \"pgnHistory\": pgn,\r\n            \"pgnResume\": infosClean,\r\n            \"pgnGame\": turns,\r\n            \"fenGame\": fenGame\r\n          };\r\n          this.saveGameToStorage(gameToSave);\r\n          let otherProps = {\r\n            \"data\": JSON.parse(this.state.initialData),\r\n            \"pgnResume\": infosClean,\r\n            \"pgnHistory\": pgn,\r\n            \"pgnGame\": turns,\r\n            \"fenGame\": fenGame,\r\n            \"move\": {\r\n              \"number\": 0,\r\n              \"side\": \"w\"\r\n            },\r\n            \"scores\" : {\r\n              \"whiteScore\" : 0,\r\n              \"blackScore\" : 0,\r\n              \"whiteJail\" : [],\r\n              \"blackJail\" : []\r\n            }\r\n          }\r\n          this.setGameStatus(this.gameStatus.showList, \"\",otherProps);\r\n        } else {\r\n          this.setGameStatus(this.gameStatus.inError, \"unable to read this png\");\r\n        }\r\n      }\r\n  }\r\n\r\n  saveGameToStorage = (gameToSave) => {\r\n    let factory = this;\r\n    if(!(\"id\" in gameToSave)){\r\n      gameToSave.id = new Date().getTime();\r\n    }\r\n    this.setGameStatus(this.gameStatus.showMessage, \"Saving analyzed game\");\r\n    let games = this.state.games;\r\n    if (games.length === 0) {\r\n      games.push(gameToSave);\r\n    } else {\r\n      let gameAlready = games.filter((x) => {\r\n        return x.id === gameToSave.id;\r\n      });\r\n      if (gameAlready.length === 0) {\r\n        games.push(gameToSave);\r\n      } else {\r\n        games.forEach((x) => { // rewrite in the future : add comments etc...\r\n          if (x.pgnGame === gameToSave.pgnGame) {\r\n            x.pgnHistory = gameToSave.pgnHistory;\r\n            x.pgnResume = gameToSave.pgnResume;\r\n            x.fenGame = gameToSave.fenGame;\r\n          }\r\n        });\r\n      }\r\n    }\r\n    if (this.state.isRemote && this.state.storageManager) {\r\n      factory.state.storageManager.setRemote(games)\r\n        .then(function (response) {\r\n          if (response === \"OK\") {\r\n            factory.state.storageManager.setLocal(games);\r\n          }\r\n        })\r\n        .catch(function (response) {\r\n\r\n        });\r\n    }\r\n  }\r\n  \r\n  setGameStatus = (status, message,otherProps) => {\r\n    let infos = \"\"\r\n    switch (status) {\r\n      case this.gameStatus.showInput:\r\n        infos = { \"title\": \"Please enter a game in PGN format\", \"message\": \"\" };\r\n        break;\r\n      case this.gameStatus.init:\r\n        infos = { \"title\": \"New game saved\", \"message\": \"analysing PGN game...\" };\r\n        break;\r\n      case this.gameStatus.showMoves:\r\n        infos = { \"title\": \"Game's moves\", \"message\": \"\" };\r\n        break;\r\n      case this.gameStatus.showList:\r\n        infos = { \"title\": \"Choose from list\", \"message\": \"\" };\r\n        break;\r\n      case this.gameStatus.showMessage:\r\n        infos = { \"title\": \"Current status\", \"message\": message };\r\n        break;\r\n      case this.gameStatus.inError:\r\n        infos = { \"title\": \"Error !\", \"message\": message };\r\n        break;\r\n      default:\r\n        infos = { \"title\": \"Error !\", \"message\": \"the program is in error...\" };\r\n    }\r\n    let newState = {\r\n      \"status\": status,\r\n      \"infosTitle\": infos.title,\r\n      \"infosMessage\": infos.message\r\n    }\r\n    if(otherProps){\r\n      for (let p in otherProps){\r\n        newState[p] = otherProps[p];\r\n      }\r\n    }\r\n    this.setState((state, props) => (\r\n      newState\r\n    ));\r\n  }\r\n\r\n  initData = () => {\r\n    let factory = this;\r\n    let isRemote = true;\r\n    let initError = false;\r\n    let storageManager = new ManageStorage();\r\n    storageManager\r\n      .initRemote()\r\n      .then(function (data) {\r\n        storageManager.setLocal(data); // in case we go offline\r\n        factory.initGames(data, isRemote, initError,storageManager)\r\n      })\r\n      .catch(function (e) {\r\n        isRemote = false;\r\n        storageManager\r\n          .initLocal()\r\n          .then(function (data) {\r\n            factory.initGames(data, isRemote, initError,storageManager)\r\n          })\r\n          .catch(function (e) {\r\n            initError = true;\r\n            factory.initGames(null, isRemote, initError,storageManager)\r\n          });\r\n      });\r\n  }\r\n\r\n  initGames = (games,isRemote,initError,storageManager) => {\r\n    if(initError){\r\n      let initialStatus = this.gameStatus.inError;\r\n      this.props.setParentInfos({\"storageType\":\"no data\"});\r\n      let otherProps = {\r\n        isRemote: isRemote,\r\n        initError:initError,\r\n        storageManager:storageManager\r\n      }\r\n      this.setGameStatus(initialStatus, \"\",otherProps);\r\n     }else{\r\n       let storageType = isRemote ? \"online\":\"disconnected\";\r\n      this.props.setParentInfos({\"storageType\":storageType});\r\n\r\n      let initialStatus = this.gameStatus.showInput;\r\n      if (games.length > 0) {\r\n        initialStatus = this.gameStatus.showList;\r\n      }\r\n      let pgn = this.state.pgnHistory;\r\n      let data = [];\r\n      let positions = [];\r\n      let blackColor = this.state.blackColor;\r\n      let whiteColor = this.state.whiteColor;\r\n      let black = this.state.black;\r\n      let white = this.state.white;\r\n  \r\n      let currentColor;\r\n      let previousColor = whiteColor;\r\n      let row = 0;\r\n      let col = 0;\r\n      let i = 0;\r\n      for (let r = 7; r >= 0; r--) {\r\n        row = this.state.rows[r];\r\n        for (let c = 0; c < 8; c++) {\r\n          col = this.state.columns[c];\r\n          i++;\r\n          if (i % 8 === 1) {\r\n            currentColor = previousColor;\r\n          } else {\r\n            currentColor = previousColor === blackColor ? whiteColor : blackColor;\r\n            previousColor = currentColor;\r\n          }\r\n          data.push({ \"row\": row, \"column\": col, \"squareColor\": currentColor, \"fig\": null });\r\n        }\r\n      }\r\n  \r\n      this.state.figures.forEach((fig, i) => {\r\n        positions.push({ \"row\": this.state.rows[0], \"column\": this.state.columns[i], \"fig\": fig + white });\r\n        positions.push({ \"row\": this.state.rows[1], \"column\": this.state.columns[i], \"fig\": this.state.pawn + white });\r\n        positions.push({ \"row\": this.state.rows[6], \"column\": this.state.columns[i], \"fig\": this.state.pawn + black });\r\n        positions.push({ \"row\": this.state.rows[7], \"column\": this.state.columns[i], \"fig\": fig + black });\r\n      });\r\n  \r\n      data.forEach((sqr) => {\r\n        let check = positions.filter((pos) => {\r\n          return pos.row === sqr.row && pos.column === sqr.column;\r\n        });\r\n        if (check.length === 1) {\r\n          sqr.fig = check[0].fig;\r\n        }\r\n      });\r\n      let otherProps = {\r\n        \"storageManager\":storageManager,\r\n        \"games\":games,\r\n        \"data\": data,\r\n        \"isRemote\": isRemote,\r\n        \"initError\":initError,\r\n        \"initialData\": JSON.stringify(data),\r\n        \"positions\": positions,\r\n        \"move\": { \"number\": 0, \"side\": \"w\" },\r\n        \"pgnHistory\": pgn,\r\n        \"scores\" : {\r\n          \"whiteScore\" : 0,\r\n          \"blackScore\" : 0,\r\n          \"whiteJail\" : [],\r\n          \"blackJail\" : []\r\n        }\r\n      }\r\n      this.setGameStatus(initialStatus, \"\",otherProps);\r\n     }\r\n  };\r\n  render() {\r\n    if (this.state.status === this.gameStatus.showInput) {// todo : adapt to input in textArea\r\n      if(!this.state.isRemote){\r\n        return (\r\n        <div className=\"game\">\r\n          <div >\r\n            <h1>\"Offline Mode\"</h1>\r\n            <p>You can't add games in offline mode, sorry :-( </p>\r\n          </div>\r\n        </div>\r\n        )\r\n      }else{\r\n      return (\r\n        <div className=\"game\">\r\n          <div className=\"game-board\">\r\n            <Board key={1} reverseBoard={this.reverseBoard} game={this.state} />\r\n          </div>\r\n          <div className=\"game-info\">\r\n            <Info key={1} game={this.state} movePGN={this.movePGN} menuMove = {this.menuMove} savePGN={this.savePGN} statuses={this.gameStatus}></Info>\r\n          </div>\r\n        </div>\r\n      )\r\n    }\r\n    } else if (this.state.status === this.gameStatus.showList) { // todo : adapt to list\r\n      return (\r\n        <div className=\"game\">\r\n          <div className=\"game-board\">\r\n            <Board key={1} reverseBoard={this.reverseBoard} game={this.state} />\r\n          </div>\r\n          <div className=\"game-info\">\r\n            <Info key={1} game={this.state} loadGame={this.loadGame} deleteGame={this.deleteGame} menuMove = {this.menuMove} statuses={this.gameStatus}></Info>\r\n          </div>\r\n        </div>\r\n      )\r\n    } else if (this.state.status === this.gameStatus.showMoves) { // todo : adapt to list\r\n      return (\r\n        <div className=\"game\">\r\n          <div className=\"game-board\">\r\n            <Board key={1} reverseBoard={this.reverseBoard} game={this.state} />\r\n          </div>\r\n          <div className=\"game-info\">\r\n            <Info key={1} game={this.state} movePGN={this.movePGN} menuMove = {this.menuMove} savePGN={this.savePGN} statuses={this.gameStatus}></Info>\r\n          </div>\r\n        </div>\r\n      )\r\n    }else if (this.state.status === this.gameStatus.showMessage) { // todo : adapt to list\r\n      return (\r\n        <div className=\"game\">\r\n          <div >\r\n            <h1> {this.state.infosTitle} </h1>\r\n            <p> {this.state.infosMessage} </p>\r\n          </div>\r\n        </div>\r\n      )\r\n    }\r\n    else { // Adapt to other status such as error\r\n      return (\r\n        <div className=\"game\">\r\n          <h1> Loading </h1>\r\n        </div>\r\n      );\r\n    }\r\n  }\r\n}\r\n\r\nexport default Game;\r\n\r\n","import React, { useState } from 'react';\r\nimport './App.css';\r\nimport Header from './components/header/header.component';\r\nimport Game from './components/game/game.component';\r\n\r\nfunction App() {\r\n\r\n  const [parentInfos, setParentInfos] = useState({\"storageType\":\"no data\"});\r\n\r\n  return (\r\n    <div className=\"App\">\r\n      <Header parentInfos={parentInfos} />\r\n      <Game parentInfos={parentInfos} setParentInfos={setParentInfos}/>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default App;\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport App from './App';\r\n\r\nReactDOM.render( \r\n   <App/>,\r\n   document.getElementById('root')\r\n);\r\n\r\n"],"sourceRoot":""}