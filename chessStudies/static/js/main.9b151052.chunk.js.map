{"version":3,"sources":["assets/zadigChess.png","components/header/header.component.jsx","components/prisoners/prisoners.component.jsx","components/board/board.component.jsx","components/turns/turns.component.jsx","components/resume/resume.component.jsx","components/movesCommands/movesCommands.component.jsx","assets/first.gif","assets/prev.gif","assets/next.gif","assets/last.gif","components/gameList/gameList.component.jsx","components/gameMenu/gameMenu.component.jsx","components/info/info.component.jsx","utils.js","movesLogic.js","fen.js","components/game/game.component.jsx","App.js","index.js"],"names":["Header","className","src","logo","alt","prepareScore","score","prepareJail","listW","listB","figCodes","side","color","result","list","previous","length","forEach","x","__html","Prisoners","props","whiteJail","scores","blackJail","boardPosition","pgnResume","Black","White","whiteScore","blackScore","dangerouslySetInnerHTML","onClick","reverseBoard","Board","game","doReverseBoard","data","map","i","Fragment","squareColor","fig","Turns","turnsList","turn","index","movePGN","currentMove","number","w","b","Resume","resume","Date","Result","MovesCommands","GameList","games","Event","Site","WhiteElo","BlackElo","loadGame","deleteGame","GameMenu","movesLoaded","menuMove","Info","status","statuses","pgnHistory","showInput","infosTitle","id","name","savePGN","showList","showMessage","inError","init","infosMessage","showMoves","pgnGame","move","charIsLowercase","c","toUpperCase","setRookPossiblePreviousPositions","nextMoveData","columnsOrdered","r","moveRow","possibleMove","moveColumn","comingFromRow","row","comingFromColumn","column","possiblePositions","push","setKingPossiblePreviousPositions","moveType","moveSide","additionalMove","uniqueFigure","setPawnPossiblePreviousPositions","posMoveColumn","indexOf","isError","setBishopPossiblePreviousPositions","rowPos","colPos","setKnightPossiblePreviousPositions","getMoveOffset","boardToFen","gamePositions","fen","separator","nullCounter","currentFigure","col","charAt","toLowerCase","Game","e","doReverse","state","setState","currentTarget","getAttribute","doDeleteGame","doLoadGame","JSON","parse","stringify","splice","otherProps","localStorage","setItem","newStatus","gameStatus","setGameStatus","initialData","fenGame","moveGameTo","askedMove","timing","pace","gamePgn","columns","slice","askedMoveOffset","currentMoveOffset","movePieceType","isCheck","isMat","isDone","promoteTo","nextMovePosition","Math","trunc","nextMove","replace","substring","parseInt","isNaN","comingFrom","getNextMove","hasMoved","j","hasMovedKing","hasMovedRook","delta","filter","that","setTimeout","target","elem","movesList","lastMove","instruction","getAskedMove","dataset","fenMove","reinitData","scoreWhite","scoreBlack","figs","figsValues","whiteTeam","blackTeam","originalTeam","item","figure","pos","nr","boardToScore","board","colDatas","split","cursorPos","colData","colDataLen","char","intTry","d","fenToBoard","textArea","document","getElementById","pgn","value","limitBetweenGameParts","exec","pngInfos","trim","infosClean","infos","raw","clean","key","pngToInfos","turns","end","turnPrevPosition","turnNextPosition","moves","turnInfo","pngToTurns","positions","getMoveDataAt","getPositionsAt","gameToSave","saveGameToStorage","getItem","message","newState","title","p","initGames","database","undefined","window","ref","initialStatus","currentColor","blackColor","whiteColor","black","white","previousColor","rows","figures","pawn","sqr","check","this","React","Component","App","ReactDOM","render"],"mappings":"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","file":"static/js/main.9b151052.chunk.js","sourcesContent":["export default __webpack_public_path__ + \"./static/media/zadigChess.ba50ba27.png\";","import React from 'react';\r\nimport './header.styles.css';\r\nimport logo from '../../assets/zadigChess.png';\r\n\r\nconst Header = () => {\r\n  return (\r\n  <div className=\"header\">\r\n    <img src={logo} className=\"logo\" alt=\"logo\" />\r\n    <div className=\"title\">\r\n      Chess Studies\r\n    </div>\r\n  </div>\r\n  )\r\n}\r\nexport default Header;","import React from 'react';\r\nimport './prisoners.styles.css';\r\n\r\nfunction createReverseSign() {\r\nreturn {__html: '⇵'};\r\n}\r\n\r\nfunction prepareScore(score){\r\n    if(score === 0) return \"\";\r\n    return score > 0 ? \"+\"+score : \"\"+score;\r\n}\r\n\r\nfunction prepareJail(listW,listB,figCodes,side){\r\n    let color = side === \"w\" ? \"B\" : \"W\";\r\n    let result = \"\";\r\n    let list = side === \"w\" ? listB : listW;\r\n    let previous = list && list.length > 1 ? list[0] : \"\";\r\n    list.forEach((x) => {\r\n        if(previous !== x){\r\n            result+=\"&nbsp;&nbsp;\";\r\n            previous = x;\r\n        }\r\n        result += figCodes[x+color];\r\n    });\r\n    return {__html: result};\r\n}\r\n\r\n\r\nconst Prisoners = (props) => {\r\n    let whiteJail = props.scores.whiteJail;\r\n    let blackJail = props.scores.blackJail;\r\n    let figCodes = props.figCodes;\r\n    let side = props.side;\r\n    return (\r\n        <div className={`jail ${props.boardPosition === \"inversed\" ? \"reverse\" : \"\"} \r\n        ${props.side === \"b\" ? (props.boardPosition === \"inversed\" ? \"black\" : \"white\") : (props.boardPosition === \"inversed\" ? \"white\" : \"black\")}`}>\r\n            <span className=\"jail-yard\">\r\n                <span className=\"player\">{props.side === \"b\" ? props.pgnResume.Black : props.pgnResume.White}</span>\r\n                <span className=\"score\">{props.side === \"b\" ? prepareScore(props.scores.whiteScore) : prepareScore(props.scores.blackScore)}</span>\r\n                <span className=\"list\" dangerouslySetInnerHTML={prepareJail(whiteJail,blackJail,figCodes,side)}/>\r\n                 \r\n            </span>\r\n            <span className=\"inverse-clickable\" onClick={props.reverseBoard} dangerouslySetInnerHTML={createReverseSign()}/>\r\n        </div>\r\n    )\r\n}\r\nexport default Prisoners;\r\n\r\n","import React from 'react';\r\nimport './board.styles.css';\r\nimport Prisoners from '../prisoners/prisoners.component';\r\nconst Board = (props) => {\r\n  return (\r\n    <div className={`board-zone ${props.game.doReverseBoard ? \"inverse\" : \"\"}`} >\r\n      <Prisoners side=\"w\" reverseBoard={props.reverseBoard} figCodes={props.game.figCodes} pgnResume={props.game.pgnResume} scores={props.game.scores}/>\r\n      <div className='board'>\r\n        {\r\n          props.game.data\r\n            .map((x, i) => (\r\n              <React.Fragment key={i}>\r\n                <div key={i} data-pos={i} className={'square ' + x.squareColor} dangerouslySetInnerHTML={{ __html: props.game.figCodes[x.fig] ? props.game.figCodes[x.fig] : '&nbsp;' }} />\r\n              </React.Fragment>\r\n            ))\r\n        }\r\n      </div>\r\n      <Prisoners side=\"b\" reverseBoard={props.reverseBoard} figCodes={props.game.figCodes} pgnResume={props.game.pgnResume} scores={props.game.scores}/>\r\n    </div>\r\n  )\r\n   }\r\n  export default Board;\r\n\r\n","import React from 'react';\r\nimport './turns.styles.css';\r\nconst Turns = (props) => {\r\n    return (\r\n        <div className=\"game-turns\">\r\n            <ol>\r\n                {\r\n                    props.turnsList.map((turn, index) =>\r\n                        <li key={index}>\r\n                            <span onClick={props.movePGN} data-turn={index + 1} data-side=\"w\"\r\n                                className={`turn-w ${props.currentMove.number === index + 1 && props.currentMove.side === 'w' ? \"turn-current\" : \"\"}`}>\r\n                                {turn.w}\r\n                            </span>\r\n                            <span onClick={props.movePGN} data-turn={index + 1} data-side=\"b\"\r\n                                className={`turn-b ${props.currentMove.number === index + 1 && props.currentMove.side === 'b' ? \"turn-current\" : \"\"}`}>\r\n                                {turn.b}\r\n                            </span>\r\n                        </li>\r\n                    )\r\n                }\r\n            </ol>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default Turns;","import React from 'react';\r\nimport './resume.styles.css';\r\n\r\nconst Resume = (props) => {\r\n    return(\r\n        <div className=\"game-resume\">\r\n            {props.resume.Date} {props.resume.White} vs {props.resume.Black} {props.resume.Result}          \r\n        </div>\r\n    )\r\n}\r\n\r\nexport default Resume;","import React from 'react';\r\nimport './movesCommands.styles.css';\r\nimport prev from '../../assets/prev.gif';\r\nimport next from '../../assets/next.gif';\r\nimport first from '../../assets/first.gif';\r\nimport last from '../../assets/last.gif';\r\nconst MovesCommands = (props) => {\r\n    return (\r\n        <div className=\"moves-board\">\r\n            <span data-move=\"first\" onClick={props.movePGN} ><img src={first} className=\"command-img\" alt=\"first\" /></span>           \r\n            <span data-move=\"prev\" onClick={props.movePGN} ><img src={prev} className=\"command-img\" alt=\"prev\" /></span>\r\n            <span data-move=\"pause\" className=\"hidden\" onClick={props.movePGN} >&#9208;</span>\r\n            <span data-move=\"next\" onClick={props.movePGN} ><img src={next} className=\"command-img\" alt=\"next\" /></span>\r\n            <span data-move=\"last\" onClick={props.movePGN} ><img src={last} className=\"command-img\" alt=\"last\" /></span>\r\n        </div>\r\n    )\r\n}\r\nexport default MovesCommands;","export default \"data:image/gif;base64,R0lGODlhMQAnAMwAAAAAALKAP3+vxWaaxZnFxQAAPwAAZsW2kr+mecW8n18rAGw7E0YTAIxULDM1M5KTkplkLF8rP39CE2aarMW2pZnFv6W2xXKdxb+mpbKKWYxUU0YTZr+vn2w7ZsXFxQAAACH5BAEAAB4ALAAAAAAxACcAAAX/oCeOZGmeaKqubOu+cCzPdG1njnO1mEvBAQBgwEJsCKxDRPAKDlcIhgGpOigKTJeTmIoCplUFANsUck/eL/VkFZK1ZlRajWq7s60tmiEUgk12d2VPJXN+ayOBgnCEI4aHJYqLeXGOfH19fyKSkyx6Io+Za5ydK5+hoptimJhvlE+oqaR9rp5msaKztHi2ABMSrMFfFRDCrLWmZgkLxqkNzaUqesvQf8/NyNKV1Maa18LZKZ8e3MGaHt/HvMmN5MzmiOjg69rt7vAm6dHilSTlkPnUDTrj7x3AgLsGoih3rsS3cCjGmeDW0OG+iP1OUKtoEeIJiRoXcHTo0QRIjR3iF6HQQC8FhwcPLNiYSbOmzZs4c+rcGSMEADs=\"","export default \"data:image/gif;base64,R0lGODlhIAAnALsAAAAAAH+vxQAAP7mXZqyDTCwAABkAAIavxYyvxbmXf6yDbBkAPywAP8XFxQAAAAAAACH5BAEAAA0ALAAAAAAgACcAAARzsMlJq7046827/2AoZsoxasQSnBhhCCtbuQAsU3Qd37l+Nz2fLCg8EYuiIxKkXHqaTg40ijIArtgsNTMoaL+2UPebDYu95O1mTDaL2Fr3G13eneBX+Qiv39P7fnl2N2OAdwWGdwyDPw0JCI2RkpOUlZYWEQA7\"","export default \"data:image/gif;base64,R0lGODlhJQAnALsAAAAAAMWvfz8AAGaXuUaArAAALAAAE3+XuT8AE8WvjGaArD8ALMWvhsXFxQAAAAAAACH5BAEAAA0ALAAAAAAlACcAAAR2sMlJq7046827/2AojhijkF+AEGgXCAbbai8Qz1lty3il7z2fAEAEBiU/4u2YVPJwTWcwKoUOi1hji1pcorjdpwhMLAy212zRPAOz2+nsG64GzOny8zRu1++xdz0/gYJXhIV9R0KHUwt+ihMJB5CUlZaXmJkkEQA7\"","export default \"data:image/gif;base64,R0lGODlhLwAnAMwAAAAAAGaaxcWvf8WaZrKAPz8AAJ+8xRM7bDlun5K2xQAAEwArXyxUjDM1M5KTkqW2xaWAP3KdxT99rL+vnyxkmVNUjD8rX7KKWcWpn8XFxQAAAAAAAAAAAAAAAAAAAAAAACH5BAEAABkALAAAAAAvACcAAAX/YCaOZGmeaKqubOu+cCzPdK1ihvu0V9NErcEhtxJYEiwCABAIAobFwgKpUjKdTyJKUABMq8sma7DMprjLL8oqXpHL0BM6TTWxsXAtaU4/3cdleSZ8fSV/boGCe12JaiOHKm+JZiOEZY4ZkCmSk3EZlpd1miicnUSgoSKjJ6Wmn4yTfasmraaogVOzJbWJChK3gRQQYXixAAoIr8ZlDJnEgMvIIsAAzc5X0LHS07CT1tdtkcbb3Mbf4MVl5OXehs+IvckloOeq7+KB65Xd1X73m/nkDepW79E/UuoEDmSWQheJN/rmMSpIwuEIMhEl9gODzU1GiRTddYyk8EyFFhZtEqiY4MDBDpUwY8qcSbOmzZohAAA7\"","import React from 'react';\r\nimport './gameList.styles.css';\r\nconst GameList = (props) => {\r\n    return (\r\n        <div className=\"game-list\">\r\n            <ol>\r\n                { \r\n                    props.games.map((game, index) =>\r\n                        <li key={index}>\r\n                            <div className=\"list-element\" >\r\n                                <span className=\"list-element-text\" >\r\n                                {game.pgnResume.Event} {game.pgnResume.Site} {game.pgnResume.Date} <br/>\r\n                                {game.pgnResume.White} ({game.pgnResume.WhiteElo}) {\"vs\"} {game.pgnResume.Black} ({game.pgnResume.BlackElo})  {\"=>\"} {game.pgnResume.Result}\r\n                                </span>\r\n                                <span className=\"button choose\" data-index={index} onClick={props.loadGame}></span>\r\n                                <span className=\"button delete\" data-index={index} onClick={props.deleteGame}></span>\r\n                            </div>\r\n                        </li>\r\n                    )\r\n                }\r\n            </ol>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default GameList;","import React from 'react';\r\nimport './gameMenu.styles.css';\r\n\r\nconst GameMenu = (props) => {\r\n    return (\r\n        <div className=\"game-menu\">\r\n            <div data-target=\"showMoves\" className={`${props.movesLoaded ? \"\" : \"hidden\"}`} onClick={props.menuMove}>Moves</div>           \r\n            <div data-target=\"showList\" onClick={props.menuMove}>Games list</div>           \r\n            <div data-target=\"showInput\" onClick={props.menuMove}>New game</div>           \r\n        </div>\r\n    )\r\n}\r\n\r\nexport default GameMenu;\r\n","import React from 'react';\r\nimport './info.styles.css';\r\nimport Turns from '../turns/turns.component';\r\nimport Resume from '../resume/resume.component';\r\nimport MovesCommands from '../movesCommands/movesCommands.component';\r\nimport GameList from '../gameList/gameList.component';\r\nimport GameMenu from '../gameMenu/gameMenu.component';\r\n\r\nconst Info = (props) => {\r\n  let status = props.game.status;\r\n  let pgn = props.game.pgnHistory;\r\n  let statuses = props.statuses;\r\n  if(status === statuses.showInput){\r\n      return(\r\n        <React.Fragment>\r\n        <GameMenu menuMove = {props.menuMove} movesLoaded={props.game.pgnHistory && props.game.pgnHistory > 1}/>\r\n        <div className='info-zone'>\r\n          <h3 className='board-title'>{props.game.infosTitle}</h3>\r\n          <textarea id=\"game-input\" className=\"game-input\" name=\"pgn\"></textarea>\r\n          <button onClick={props.savePGN}>Go</button>\r\n        </div>\r\n        </React.Fragment>\r\n      )\r\n  }\r\n  else if (status === statuses.showList) { // todo : showList\r\n    return(\r\n      <React.Fragment>\r\n      <GameMenu menuMove = {props.menuMove} movesLoaded={props.game.pgnHistory && props.game.pgnHistory.length > 1 ? true:false}/>\r\n      <div className='list-zone'>\r\n        <h3 className='board-list-title'>{props.game.infosTitle}</h3>\r\n        <GameList games={props.game.games} deleteGame={props.deleteGame} loadGame={props.loadGame}></GameList>\r\n      </div>\r\n      </React.Fragment>\r\n    )\r\n  }\r\n  else if (status === statuses.showMessage || status === statuses.inError|| status === statuses.init) { \r\n    return(\r\n      <div className='info-zone'>\r\n        <h3 className='board-title'>{props.game.infosTitle}</h3>\r\n        <p className='infosMessage'>{props.game.infosMessage}</p>\r\n      </div>\r\n    )\r\n  }\r\n else if (status === statuses.showMoves) { // add proposeSave : tue|false (button to save loaded game to locaStorage or back in the future (or both))\r\n      return(\r\n        <React.Fragment>\r\n        <GameMenu menuMove = {props.menuMove} movesLoaded={props.game.pgnHistory && props.game.pgnHistory > 1}/>\r\n        <div className='turns-zone'>\r\n          <Resume resume = {props.game.pgnResume}/>\r\n          <Turns turnsList = {props.game.pgnGame} currentMove={props.game.move} movePGN = {props.movePGN}/>\r\n          <MovesCommands movePGN = {props.movePGN}/> \r\n        </div>\r\n        </React.Fragment>\r\n      )\r\n    } else{\r\n      return(\r\n        <div className='info-zone'>\r\n          <h3 className='board-title'>404</h3>\r\n          <p className='infosMessage'>Sorry Buddy, I'm afraid we are lost !</p>\r\n        </div>\r\n      ) \r\n    }\r\n  }\r\n\r\n  export default Info;","const charIsLowercase = (c) => {\r\n    return c !== c.toUpperCase();\r\n  }\r\n\r\n  export {charIsLowercase};","import {charIsLowercase} from './utils.js';\r\n\r\nconst getAskedMove = (elem,currentMove,movesList) => {\r\n    let turn = 0;\r\n    let side = \"w\";\r\n    let askedMove = null;\r\n    let lastMove = movesList[movesList.length-1];\r\n    if(\"move\" in elem){\r\n      let instruction = elem.move;\r\n      if(instruction === \"first\"){\r\n        askedMove={\"number\":0,\"side\":\"w\"};\r\n      }else if(instruction === \"last\"){\r\n        if(\"b\" in lastMove){\r\n          askedMove={\"number\":movesList.length,\"side\":\"b\"};\r\n        }else{\r\n          askedMove={\"number\":movesList.length,\"side\":\"w\"};\r\n        }\r\n        askedMove.pace = \"quick\";\r\n      }else if(instruction === \"pause\"){\r\n        askedMove=currentMove;\r\n        askedMove.pace = \"stop\";\r\n      }else if(instruction === \"prev\"){\r\n        if(currentMove.number <= 1 && currentMove.side === \"w\"){\r\n          askedMove={\"number\":0,\"side\":\"w\"};\r\n        }else{\r\n          if(currentMove.side === \"b\"){\r\n            askedMove={\"number\":currentMove.number,\"side\":\"w\"};\r\n          }else{\r\n            askedMove={\"number\":currentMove.number -1 ,\"side\":\"b\"};\r\n          }\r\n          if(askedMove.number < 1 ){\r\n            askedMove={\"number\":1,\"side\":\"w\"};\r\n          }\r\n        }\r\n        askedMove.pace = \"quick\";\r\n      }else if(instruction === \"next\"){\r\n        if(currentMove.number === movesList.length){\r\n          if(currentMove.side === \"b\"){\r\n            askedMove=currentMove;\r\n          }else{\r\n            if(\"b\" in lastMove){\r\n              askedMove={\"number\":movesList.length ,\"side\":\"b\"};\r\n            }else{\r\n              askedMove=currentMove;\r\n            }\r\n          }\r\n        }else{\r\n          if(currentMove.side === \"b\"){\r\n            askedMove={\"number\":currentMove.number +1,\"side\":\"w\"};\r\n          }else{\r\n            askedMove={\"number\":currentMove.number ,\"side\":\"b\"};\r\n          }\r\n        }\r\n\r\n        if(askedMove.number < 1 ){\r\n          askedMove={\"number\":1,\"side\":\"w\"};\r\n        }\r\n      }\r\n    }\r\n\r\n    else if(\"turn\" in elem && \"side\" in elem){\r\n      turn = parseInt(elem.turn);\r\n      if(isNaN(turn)){\r\n        turn = 0;\r\n      }\r\n      side = elem.side;\r\n    }\r\n    if(turn>0){\r\n      askedMove={\"number\":turn,\"side\":side};\r\n    }\r\n    return askedMove;\r\n  }\r\n\r\n  const getNextMove = (gamePositions,currentMove,askedMove,columnsOrdered) => {\r\n    let askedMoveOffset = getMoveOffset(askedMove);\r\n    let currentMoveOffset = getMoveOffset(currentMove);\r\n    let nextMoveData = {\r\n      moveSide:\"\",\r\n      moveColumn : \"\",\r\n      moveRow : 0,\r\n      movePieceType : null,\r\n      moveType : null, // move, castle-king, take\r\n      isCheck : false, // maybe not usefull\r\n      isMat : false,\r\n      isError : false,\r\n      isDone : true, // no change : we are at the asked move\r\n      possiblePositions : [],\r\n      additionalMove : null,\r\n      comingFromRow : 0, // ex R2c8 => 2 : the Rook is coming from row 2 (there are 2 Rooks able to make teh move)\r\n      comingFromColumn : \"\",// ex Rac8 => a : the Rook is coming from column/file \"a\"\r\n      uniqueFigure:false,\r\n      promoteTo:null,\r\n      number:0\r\n    };\r\n\r\n    if(askedMoveOffset > currentMoveOffset){\r\n      nextMoveData.isDone = false;\r\n      let nextMoveOffset = currentMoveOffset === 0 ? currentMoveOffset = 1 : currentMoveOffset+1;\r\n      let nextMovePosition = {}\r\n      if(nextMoveOffset % 2 === 1){\r\n        nextMovePosition.number = Math.trunc(currentMoveOffset/2)+1;\r\n        nextMovePosition.side = \"w\";\r\n      }else{\r\n        nextMovePosition.number = (currentMoveOffset+1)/2;\r\n        nextMovePosition.side = \"b\";\r\n      }\r\n      \r\n      let nextMove = gamePositions[nextMovePosition.number-1][nextMovePosition.side];\r\n      nextMoveData.moveSide = nextMovePosition.side;\r\n      nextMoveData.number = nextMovePosition.number;\r\n      nextMove = nextMove.replace(/\\?|!/,\"\") // no ?! !! etc...\r\n\r\n      nextMoveData.moveType = \"move\";\r\n      \r\n      let take = nextMove.indexOf(\"x\") !== -1;\r\n      if(take){\r\n        nextMove = nextMove.replace(\"x\",\"\");\r\n        nextMoveData.moveType = \"take\";\r\n      }\r\n      \r\n      if(nextMove.charAt(nextMove.length-1) === \"+\" && nextMove.charAt(nextMove.length-2) === \"+\"){\r\n        nextMoveData.isMat = true;\r\n        nextMove = nextMove.substring(0,nextMove.length-2);\r\n      }else if(nextMove.charAt(nextMove.length-1) === \"+\"){\r\n        nextMoveData.isCheck = true;\r\n        nextMove = nextMove.substring(0,nextMove.length-1);\r\n      }\r\n      if(nextMove.length === 2){// pawn move\r\n        nextMoveData.movePieceType = \"p\";\r\n        nextMoveData.moveColumn = nextMove.charAt(0);\r\n        nextMoveData.moveRow = parseInt(nextMove.charAt(1));\r\n        if(isNaN(nextMoveData.moveRow)){\r\n          nextMoveData.isError = true;\r\n        }\r\n      } else if(nextMove.length === 3){\r\n          if(nextMove === \"0-0\" || nextMove === \"O-O\"){\r\n            nextMoveData.movePieceType = \"K\";\r\n            nextMoveData.moveColumn = \"g\"\r\n            nextMoveData.moveRow = nextMoveData.moveSide === \"w\" ? 1 : 8;\r\n            nextMoveData.moveType = \"castle-king\";\r\n            nextMoveData.possiblePositions = [];\r\n            nextMoveData.additionalMove = {\r\n              moveSide:nextMoveData.moveSide,\r\n              moveColumn : \"f\",\r\n              moveRow :  nextMoveData.moveRow,\r\n              movePieceType : \"R\",\r\n              moveType : nextMoveData.moveType,\r\n              isCheck : false, // maybe not usefull\r\n              isError : false,\r\n              possiblePositions : []\r\n            }\r\n          }else{\r\n            let isLowerCase = charIsLowercase(nextMove.charAt(0))\r\n            if(isLowerCase){ // it's a pawn with an indication from which column/file it's coming\r\n              nextMoveData.movePieceType = \"p\";\r\n              nextMoveData.comingFromColumn = nextMove.charAt(0);\r\n              nextMoveData.moveColumn = nextMove.charAt(1);\r\n              nextMoveData.moveRow = parseInt(nextMove.charAt(2));\r\n            }else{ // it's a Figure\r\n              nextMoveData.movePieceType = nextMove.charAt(0);\r\n              nextMoveData.moveColumn = nextMove.charAt(1);\r\n              nextMoveData.moveRow = parseInt(nextMove.charAt(2));\r\n            }\r\n            if(isNaN(nextMoveData.moveRow)){\r\n              nextMoveData.isError = true;\r\n            }\r\n          }\r\n      }else if(nextMove.length === 4){\r\n        if(nextMove.charAt(2) === \"=\"){\r\n          nextMoveData.promoteTo = nextMove.charAt(3);\r\n          nextMoveData.movePieceType = \"p\";\r\n          nextMoveData.moveColumn = nextMove.charAt(0);\r\n          nextMoveData.moveRow = parseInt(nextMove.charAt(1));\r\n        }else{\r\n          nextMoveData.movePieceType = nextMove.charAt(0);\r\n          let comingFrom = nextMove.charAt(1);\r\n          if(!isNaN(parseInt(comingFrom))){\r\n            nextMoveData.comingFromRow = parseInt(comingFrom);\r\n          }else{\r\n            nextMoveData.comingFromColumn = comingFrom;\r\n          }\r\n          nextMoveData.moveColumn = nextMove.charAt(2);\r\n          nextMoveData.moveRow = parseInt(nextMove.charAt(3));\r\n          if(isNaN(nextMoveData.moveRow)){\r\n            nextMoveData.isError = true;\r\n          }\r\n        }\r\n      }else if(nextMove === \"0-0-0\" || nextMove === \"O-O-O\"){\r\n        nextMoveData.movePieceType = \"K\";\r\n        nextMoveData.moveColumn = \"c\";\r\n        nextMoveData.moveRow = nextMoveData.moveSide === \"w\" ? 1 : 8;\r\n        nextMoveData.moveType = \"castle-queen\";\r\n        nextMoveData.possiblePositions = [];\r\n        nextMoveData.additionalMove = {\r\n          moveSide:nextMoveData.moveSide,\r\n          moveColumn : \"d\",\r\n          moveRow : nextMoveData.moveRow,\r\n          movePieceType : \"R\",\r\n          moveType : nextMoveData.moveType,\r\n          isCheck : false, \r\n          isError : false,\r\n          possiblePositions : []\r\n        }\r\n      }else{\r\n        // to be continued (queen side castling)\r\n        nextMoveData.isError = true;\r\n      }\r\n      // Computing possible previous positions of the moving piece \r\n      if(!nextMoveData.isError){\r\n        nextMoveData.possiblePositions = [];\r\n        if(nextMoveData.movePieceType === \"p\"){\r\n          setPawnPossiblePreviousPositions(nextMoveData,columnsOrdered);\r\n        }else if(nextMoveData.movePieceType === \"N\"){\r\n          setKnightPossiblePreviousPositions(nextMoveData,columnsOrdered);\r\n        }else if(nextMoveData.movePieceType === \"B\"){\r\n          setBishopPossiblePreviousPositions(nextMoveData,columnsOrdered);\r\n        }else if(nextMoveData.movePieceType === \"R\"){\r\n          setRookPossiblePreviousPositions(nextMoveData,columnsOrdered);\r\n        }else if(nextMoveData.movePieceType === \"K\"){\r\n          setKingPossiblePreviousPositions(nextMoveData,columnsOrdered);\r\n         } else if (nextMoveData.movePieceType === \"Q\") {\r\n           nextMoveData.uniqueFigure = true;\r\n         }\r\n      }\r\n    }\r\n\r\n    return nextMoveData;\r\n  }\r\n\r\n  const getMoveDataAt = (turn,side,nr,positions,columnsOrdered) => {\r\n    let nextMoveData = {\r\n      moveSide:side,\r\n      moveColumn : \"\",\r\n      moveRow : 0,\r\n      movePieceType : null,\r\n      moveType : null, // move, castle-king, take\r\n      isCheck : false, // maybe not usefull\r\n      isMat : false,\r\n      isError : false,\r\n      isDone : true, // no change : we are at the asked move\r\n      possiblePositions : [],\r\n      additionalMove : null,\r\n      comingFromRow : 0, // ex R2c8 => 2 : the Rook is coming from row 2 (there are 2 Rooks able to make teh move)\r\n      comingFromColumn : \"\",// ex Rac8 => a : the Rook is coming from column/file \"a\"\r\n      uniqueFigure:false,\r\n      promoteTo:null,\r\n      number:nr\r\n    };\r\n\r\n      nextMoveData.isDone = false;\r\n\r\n      let nextMove = side === \"w\" ? turn.w : turn.b;\r\n      nextMove = nextMove.replace(/\\?|!/,\"\") // no ?! !! etc...\r\n      nextMoveData.moveType = \"move\";\r\n      \r\n      let take = nextMove.indexOf(\"x\") !== -1;\r\n      if(take){\r\n        nextMove = nextMove.replace(\"x\",\"\");\r\n        nextMoveData.moveType = \"take\";\r\n      }\r\n      \r\n      if(nextMove.charAt(nextMove.length-1) === \"+\" && nextMove.charAt(nextMove.length-2) === \"+\"){\r\n        nextMoveData.isMat = true;\r\n        nextMove = nextMove.substring(0,nextMove.length-2);\r\n      }else if(nextMove.charAt(nextMove.length-1) === \"+\"){\r\n        nextMoveData.isCheck = true;\r\n        nextMove = nextMove.substring(0,nextMove.length-1);\r\n      }\r\n      if(nextMove.length === 2){// pawn move\r\n        nextMoveData.movePieceType = \"p\";\r\n        nextMoveData.moveColumn = nextMove.charAt(0);\r\n        nextMoveData.moveRow = parseInt(nextMove.charAt(1));\r\n        if(isNaN(nextMoveData.moveRow)){\r\n          nextMoveData.isError = true;\r\n        }\r\n      } else if(nextMove.length === 3){\r\n          if(nextMove === \"0-0\" || nextMove === \"O-O\"){\r\n            nextMoveData.movePieceType = \"K\";\r\n            nextMoveData.moveColumn = \"g\"\r\n            nextMoveData.moveRow = nextMoveData.moveSide === \"w\" ? 1 : 8;\r\n            nextMoveData.moveType = \"castle-king\";\r\n            nextMoveData.possiblePositions = [];\r\n            nextMoveData.additionalMove = {\r\n              moveSide:nextMoveData.moveSide,\r\n              moveColumn : \"f\",\r\n              moveRow :  nextMoveData.moveRow,\r\n              movePieceType : \"R\",\r\n              moveType : nextMoveData.moveType,\r\n              isCheck : false, // maybe not usefull\r\n              isError : false,\r\n              possiblePositions : []\r\n            }\r\n          }else{\r\n            let isLowerCase = charIsLowercase(nextMove.charAt(0))\r\n            if(isLowerCase){ // it's a pawn with an indication from which column/file it's coming\r\n              nextMoveData.movePieceType = \"p\";\r\n              nextMoveData.comingFromColumn = nextMove.charAt(0);\r\n              nextMoveData.moveColumn = nextMove.charAt(1);\r\n              nextMoveData.moveRow = parseInt(nextMove.charAt(2));\r\n            }else{ // it's a Figure\r\n              nextMoveData.movePieceType = nextMove.charAt(0);\r\n              nextMoveData.moveColumn = nextMove.charAt(1);\r\n              nextMoveData.moveRow = parseInt(nextMove.charAt(2));\r\n            }\r\n            if(isNaN(nextMoveData.moveRow)){\r\n              nextMoveData.isError = true;\r\n            }\r\n          }\r\n      }else if(nextMove.length === 4){\r\n        if(nextMove.charAt(2) === \"=\"){\r\n          nextMoveData.promoteTo = nextMove.charAt(3);\r\n          nextMoveData.movePieceType = \"p\";\r\n          nextMoveData.moveColumn = nextMove.charAt(0);\r\n          nextMoveData.moveRow = parseInt(nextMove.charAt(1));\r\n        }else{\r\n          nextMoveData.movePieceType = nextMove.charAt(0);\r\n          let comingFrom = nextMove.charAt(1);\r\n          if(!isNaN(parseInt(comingFrom))){\r\n            nextMoveData.comingFromRow = parseInt(comingFrom);\r\n          }else{\r\n            nextMoveData.comingFromColumn = comingFrom;\r\n          }\r\n          nextMoveData.moveColumn = nextMove.charAt(2);\r\n          nextMoveData.moveRow = parseInt(nextMove.charAt(3));\r\n          if(isNaN(nextMoveData.moveRow)){\r\n            nextMoveData.isError = true;\r\n          }\r\n        }\r\n      }else if(nextMove === \"0-0-0\" || nextMove === \"O-O-O\"){\r\n        nextMoveData.movePieceType = \"K\";\r\n        nextMoveData.moveColumn = \"c\";\r\n        nextMoveData.moveRow = nextMoveData.moveSide === \"w\" ? 1 : 8;\r\n        nextMoveData.moveType = \"castle-queen\";\r\n        nextMoveData.possiblePositions = [];\r\n        nextMoveData.additionalMove = {\r\n          moveSide:nextMoveData.moveSide,\r\n          moveColumn : \"d\",\r\n          moveRow : nextMoveData.moveRow,\r\n          movePieceType : \"R\",\r\n          moveType : nextMoveData.moveType,\r\n          isCheck : false, \r\n          isError : false,\r\n          possiblePositions : []\r\n        }\r\n      }else{\r\n        // to be continued (queen side castling)\r\n        nextMoveData.isError = true;\r\n      }\r\n      // Computing possible previous positions of the moving piece \r\n      if(!nextMoveData.isError){\r\n        nextMoveData.possiblePositions = [];\r\n        if(nextMoveData.movePieceType === \"p\"){\r\n          setPawnPossiblePreviousPositions(nextMoveData,columnsOrdered);\r\n        }else if(nextMoveData.movePieceType === \"N\"){\r\n          setKnightPossiblePreviousPositions(nextMoveData,columnsOrdered);\r\n        }else if(nextMoveData.movePieceType === \"B\"){\r\n          setBishopPossiblePreviousPositions(nextMoveData,columnsOrdered);\r\n        }else if(nextMoveData.movePieceType === \"R\"){\r\n          setRookPossiblePreviousPositions(nextMoveData,columnsOrdered);\r\n        }else if(nextMoveData.movePieceType === \"K\"){\r\n          setKingPossiblePreviousPositions(nextMoveData,columnsOrdered);\r\n         } else if (nextMoveData.movePieceType === \"Q\") {\r\n           nextMoveData.uniqueFigure = true;\r\n         }\r\n      }\r\n\r\n    return nextMoveData;\r\n  }\r\n\r\n\r\nconst setRookPossiblePreviousPositions = (nextMoveData, columnsOrdered) => {\r\n  // Same column \r\n  // changing row\r\n  for (let r = 1; r < 9; r++) {\r\n    if (r === nextMoveData.moveRow) continue;\r\n    let possibleMove = {\r\n      \"column\": nextMoveData.moveColumn,\r\n      \"row\": r\r\n    };\r\n    if ((nextMoveData.comingFromRow === 0 || possibleMove.row === nextMoveData.comingFromRow) &&\r\n      (nextMoveData.comingFromColumn === \"\" || possibleMove.column === nextMoveData.comingFromColumn)) {\r\n      nextMoveData.possiblePositions.push(possibleMove);\r\n    }\r\n  }\r\n\r\n  // Same row \r\n  // changing column/file\r\n  for (let c = 0; c < 8; c++) {\r\n    if (columnsOrdered[c] === nextMoveData.moveColumn) continue;\r\n    let possibleMove = {\r\n      \"column\": columnsOrdered[c],\r\n      \"row\": nextMoveData.moveRow\r\n    };\r\n    if ((nextMoveData.comingFromRow === 0 || possibleMove.row === nextMoveData.comingFromRow) &&\r\n      (nextMoveData.comingFromColumn === \"\" || possibleMove.column === nextMoveData.comingFromColumn)) {\r\n      nextMoveData.possiblePositions.push(possibleMove);\r\n    }\r\n  }\r\n}\r\n\r\nconst setKingPossiblePreviousPositions = (nextMoveData,columnsOrdered) => {\r\n\r\n  if (nextMoveData.moveType === \"castle-king\") {\r\n    nextMoveData.possiblePositions.push({\r\n      \"column\": \"e\",\r\n      \"row\": nextMoveData.moveSide === \"w\" ? 1 : 8\r\n    });\r\n    nextMoveData.additionalMove.possiblePositions.push({\r\n      \"column\": \"h\",\r\n      \"row\": nextMoveData.moveSide === \"w\" ? 1 : 8\r\n    });\r\n    nextMoveData.moveType = \"move\";\r\n    nextMoveData.additionalMove.moveType = \"move\";\r\n  } else if (nextMoveData.moveType === \"castle-queen\") {\r\n    nextMoveData.possiblePositions.push({\r\n      \"column\": \"e\",\r\n      \"row\": nextMoveData.moveSide === \"w\" ? 1 : 8\r\n    });\r\n    nextMoveData.additionalMove.possiblePositions.push({\r\n      \"column\": \"a\",\r\n      \"row\": nextMoveData.moveSide === \"w\" ? 1 : 8\r\n    });\r\n    nextMoveData.moveType = \"move\";\r\n    nextMoveData.additionalMove.moveType = \"move\";\r\n\r\n  } else {\r\n    nextMoveData.uniqueFigure = true;\r\n  }\r\n}\r\n\r\nconst setPawnPossiblePreviousPositions = (nextMoveData,columnsOrdered) => {\r\n  if (nextMoveData.moveRow === 4 && nextMoveData.moveSide === \"w\" && nextMoveData.moveType === \"move\") {\r\n    nextMoveData.possiblePositions.push({\r\n      \"column\": nextMoveData.moveColumn,\r\n      \"row\": 3\r\n    });\r\n    nextMoveData.possiblePositions.push({\r\n      \"column\": nextMoveData.moveColumn,\r\n      \"row\": 2\r\n    });\r\n  } else if (nextMoveData.moveRow === 5 && nextMoveData.moveSide === \"b\" && nextMoveData.moveType === \"move\") {\r\n    nextMoveData.possiblePositions.push({\r\n      \"column\": nextMoveData.moveColumn,\r\n      \"row\": 7\r\n    });\r\n    nextMoveData.possiblePositions.push({\r\n      \"column\": nextMoveData.moveColumn,\r\n      \"row\": 6\r\n    });\r\n  } else if (nextMoveData.moveType === \"move\") {\r\n    nextMoveData.possiblePositions.push({\r\n      \"column\": nextMoveData.moveColumn,\r\n      \"row\": nextMoveData.moveSide === \"w\" ? nextMoveData.moveRow - 1 : nextMoveData.moveRow + 1\r\n    });\r\n  } else if (nextMoveData.moveType === \"take\") {\r\n    // mundane take :\r\n    if (nextMoveData.comingFromColumn !== \"\") {\r\n      nextMoveData.possiblePositions.push({\r\n        \"column\": nextMoveData.comingFromColumn,\r\n        \"row\": nextMoveData.moveSide === \"w\" ? nextMoveData.moveRow - 1 : nextMoveData.moveRow + 1\r\n      });\r\n    } else {\r\n      let posMoveColumn = columnsOrdered.indexOf(nextMoveData.moveColumn);\r\n      if (posMoveColumn === 0) { // pawn takes on \"a\" file : only one possibility, it's on \"b\" file\r\n        nextMoveData.possiblePositions.push({\r\n          \"column\": columnsOrdered[1],\r\n          \"row\": nextMoveData.moveSide === \"w\" ? nextMoveData.moveRow - 1 : nextMoveData.moveRow + 1\r\n        });\r\n        //setEnPassantLeftSide(nextMoveData,columnsOrdered,posMoveColumn);\r\n      } else if (posMoveColumn === 7) { // pawn takes on \"h\" file : only one possibility, it's on \"g\" file\r\n        nextMoveData.possiblePositions.push({\r\n          \"column\": columnsOrdered[6],\r\n          \"row\": nextMoveData.moveSide === \"w\" ? nextMoveData.moveRow - 1 : nextMoveData.moveRow + 1\r\n        });\r\n        //setEnPassantRightSide(nextMoveData,columnsOrdered,posMoveColumn);\r\n      } else { // 2 possibilities the pawn is either coming from the left side or the right side of the taken piece column\r\n        nextMoveData.possiblePositions.push({\r\n          \"column\": columnsOrdered[posMoveColumn - 1],\r\n          \"row\": nextMoveData.moveSide === \"w\" ? nextMoveData.moveRow - 1 : nextMoveData.moveRow + 1\r\n        });\r\n        //setEnPassantLeftSide(nextMoveData,columnsOrdered,posMoveColumn);\r\n        nextMoveData.possiblePositions.push({\r\n          \"column\": columnsOrdered[posMoveColumn + 1],\r\n          \"row\": nextMoveData.moveSide === \"w\" ? nextMoveData.moveRow - 1 : nextMoveData.moveRow + 1\r\n        });\r\n        //setEnPassantRightSide(nextMoveData,columnsOrdered,posMoveColumn);\r\n      }\r\n    }\r\n  } else {\r\n    nextMoveData.isError = true;\r\n  }\r\n}\r\n\r\nconst setBishopPossiblePreviousPositions = (nextMoveData,columnsOrdered) => {\r\n // diagonally\r\n let rowPos = nextMoveData.moveRow;// starts at 1\r\n let convenientShift = 1;\r\n let colPos = columnsOrdered.indexOf(nextMoveData.moveColumn) + convenientShift; // starts at 0\r\n\r\n  // each +1 row +1 col\r\nlet c = colPos + 1;\r\nlet r = rowPos + 1;\r\nfor (let i = 0; i < 9; i++) {\r\n  if (c < 9 && r < 9) {\r\n    let possibleMove = {\r\n      \"column\": columnsOrdered[c - convenientShift],\r\n      \"row\": r\r\n    };\r\n    if ((nextMoveData.comingFromRow === 0 || possibleMove.row === nextMoveData.comingFromRow) &&\r\n      (nextMoveData.comingFromColumn === \"\" || possibleMove.column === nextMoveData.comingFromColumn)) {\r\n      nextMoveData.possiblePositions.push(possibleMove);\r\n    }\r\n  }\r\n  c++;\r\n  r++;\r\n}\r\n\r\n // each +1 row -1 col\r\n c = colPos - 1;\r\n r = rowPos + 1;\r\n for (let i = 0; i < 9; i++) {\r\n   if (c > 0 && r < 9) {\r\n     let possibleMove = {\r\n       \"column\": columnsOrdered[c - convenientShift],\r\n       \"row\": r\r\n     };\r\n     if ((nextMoveData.comingFromRow === 0 || possibleMove.row === nextMoveData.comingFromRow) &&\r\n       (nextMoveData.comingFromColumn === \"\" || possibleMove.column === nextMoveData.comingFromColumn)) {\r\n       nextMoveData.possiblePositions.push(possibleMove);\r\n     }\r\n   }\r\n   c--;\r\n   r++;\r\n }\r\n // each -1 row +1 col\r\n c = colPos + 1;\r\n r = rowPos - 1;\r\n for (let i = 0; i < 9; i++) {\r\n  if (c <  9 && r > 0) {\r\n    let possibleMove = {\r\n      \"column\": columnsOrdered[c - convenientShift],\r\n      \"row\": r\r\n    };\r\n    if ((nextMoveData.comingFromRow === 0 || possibleMove.row === nextMoveData.comingFromRow) &&\r\n      (nextMoveData.comingFromColumn === \"\" || possibleMove.column === nextMoveData.comingFromColumn)) {\r\n      nextMoveData.possiblePositions.push(possibleMove);\r\n    }\r\n  }\r\n  c++;\r\n  r--;\r\n}\r\n // each -1 row -1 col\r\n c = colPos-1;\r\n r = rowPos-1;\r\n  for(let i = 8 ;i > 0; i--){\r\n     if (c > 0 && c > 0) {\r\n       let possibleMove = {\r\n         \"column\": columnsOrdered[c - convenientShift],\r\n         \"row\": r\r\n       };\r\n       if ((nextMoveData.comingFromRow === 0 || possibleMove.row === nextMoveData.comingFromRow) &&\r\n         (nextMoveData.comingFromColumn === \"\" || possibleMove.column === nextMoveData.comingFromColumn)) {\r\n         nextMoveData.possiblePositions.push(possibleMove);\r\n       }\r\n     }\r\n     c--;\r\n     r--;\r\n  }\r\n}\r\n\r\nconst setKnightPossiblePreviousPositions = (nextMoveData,columnsOrdered) => {\r\n        // either 2 rows and 1 column aside or 1 row and 2 col aside\r\n        let rowPos = nextMoveData.moveRow;// starts at 1\r\n        let convenientShift = 1;\r\n        let colPos = columnsOrdered.indexOf(nextMoveData.moveColumn) + convenientShift; // starts at 1\r\n        // - 2 row - 1 col\r\n        if(rowPos - 2 > 0 && colPos - 1 > 0){\r\n          let possibleMove = {\"column\":columnsOrdered[colPos - 1 - convenientShift],\"row\":rowPos - 2};\r\n          if((nextMoveData.comingFromRow === 0 || possibleMove.row === nextMoveData.comingFromRow ) \r\n          && (nextMoveData.comingFromColumn === \"\" || possibleMove.column === nextMoveData.comingFromColumn )){\r\n            nextMoveData.possiblePositions.push(possibleMove);\r\n          }\r\n        }\r\n        // - 2 row + 1 col\r\n        if(rowPos - 2 > 0 && colPos + 1 < 9){\r\n          let possibleMove = {\"column\":columnsOrdered[colPos + 1 - convenientShift],\"row\":rowPos - 2};\r\n          if((nextMoveData.comingFromRow === 0 || possibleMove.row === nextMoveData.comingFromRow ) \r\n          && (nextMoveData.comingFromColumn === \"\" || possibleMove.column === nextMoveData.comingFromColumn )){\r\n            nextMoveData.possiblePositions.push(possibleMove);\r\n          }\r\n        }\r\n        // + 2 row - 1 col\r\n        if(rowPos + 2 < 9 && colPos - 1 > 0){\r\n          let possibleMove = {\"column\":columnsOrdered[colPos - 1 - convenientShift],\"row\":rowPos + 2};\r\n          if((nextMoveData.comingFromRow === 0 || possibleMove.row === nextMoveData.comingFromRow ) \r\n          && (nextMoveData.comingFromColumn === \"\" || possibleMove.column === nextMoveData.comingFromColumn )){\r\n            nextMoveData.possiblePositions.push(possibleMove);\r\n          }\r\n        }\r\n        // + 2 row + 1 col\r\n        if(rowPos + 2 < 9 && colPos + 1 < 9){\r\n          let possibleMove = {\"column\":columnsOrdered[colPos + 1 - convenientShift],\"row\":rowPos + 2};\r\n          if((nextMoveData.comingFromRow === 0 || possibleMove.row === nextMoveData.comingFromRow ) \r\n          && (nextMoveData.comingFromColumn === \"\" || possibleMove.column === nextMoveData.comingFromColumn )){\r\n            nextMoveData.possiblePositions.push(possibleMove);\r\n          }\r\n        }\r\n        // - 1 row - 2 col\r\n        if(rowPos - 1 > 0 && colPos - 2 > 0){\r\n          let possibleMove = {\"column\":columnsOrdered[colPos - 2 - convenientShift],\"row\":rowPos - 1};\r\n          if((nextMoveData.comingFromRow === 0 || possibleMove.row === nextMoveData.comingFromRow ) \r\n          && (nextMoveData.comingFromColumn === \"\" || possibleMove.column === nextMoveData.comingFromColumn )){\r\n            nextMoveData.possiblePositions.push(possibleMove);\r\n          }\r\n        }\r\n        // - 1 row + 2 col\r\n        if(rowPos - 1 > 0 && colPos + 2 < 9){\r\n          let possibleMove = {\"column\":columnsOrdered[colPos + 2 - convenientShift],\"row\":rowPos - 1};\r\n          if((nextMoveData.comingFromRow === 0 || possibleMove.row === nextMoveData.comingFromRow ) \r\n          && (nextMoveData.comingFromColumn === \"\" || possibleMove.column === nextMoveData.comingFromColumn )){\r\n            nextMoveData.possiblePositions.push(possibleMove);\r\n          }\r\n        }\r\n        // + 1 row - 2 col\r\n        if(rowPos + 1 < 9 && colPos - 2 > 0){\r\n          let possibleMove = {\"column\":columnsOrdered[colPos - 2 - convenientShift],\"row\":rowPos + 1};\r\n          if((nextMoveData.comingFromRow === 0 || possibleMove.row === nextMoveData.comingFromRow ) \r\n          && (nextMoveData.comingFromColumn === \"\" || possibleMove.column === nextMoveData.comingFromColumn )){\r\n            nextMoveData.possiblePositions.push(possibleMove);\r\n          }\r\n        }\r\n        // + 1 row + 2 col\r\n        if(rowPos + 1 < 9 && colPos + 2 < 9){\r\n          let possibleMove = {\"column\":columnsOrdered[colPos + 2 - convenientShift],\"row\":rowPos + 1};\r\n          if((nextMoveData.comingFromRow === 0 || possibleMove.row === nextMoveData.comingFromRow ) \r\n          && (nextMoveData.comingFromColumn === \"\" || possibleMove.column === nextMoveData.comingFromColumn )){\r\n            nextMoveData.possiblePositions.push(possibleMove);\r\n          }\r\n        }\r\n\r\n}\r\nconst pngToTurns = (pgnGame) => {\r\n  let turns = [];\r\n  let turn = 1;\r\n  let turnPrevPosition =  pgnGame.indexOf(turn+\".\");\r\n  let turnNextPosition = 0;\r\n  let currentTurnData;\r\n  let end;\r\n  while (turnPrevPosition !== -1 && turnNextPosition !== -1){\r\n    turnNextPosition =  pgnGame.indexOf((turn+1)+\".\");\r\n    if(turnNextPosition !==-1){\r\n      end = turnNextPosition;\r\n    }else{\r\n      end = turnPrevPosition + 100;\r\n    }\r\n      currentTurnData = pgnGame.substring(turnPrevPosition, end).replace(turn+\".\",\"\").trim();\r\n      let moves = currentTurnData.split(\" \");\r\n      let turnInfo = {\"w\":moves[0]};\r\n      if(moves.length === 2){\r\n        turnInfo.b = moves[1];\r\n      }\r\n      turns.push(turnInfo);\r\n      turnPrevPosition = turnNextPosition;\r\n    turn++;\r\n  } \r\n  return turns;\r\n}\r\n\r\nconst pngToInfos = (infos) => {\r\n  infos = infos.split(\",\");\r\n  let infosClean = {};\r\n  infos.forEach(function(raw){\r\n    let clean = raw.replace(/\\\\|\\[|\\]|\"/g, \"\");\r\n    let pos = clean.indexOf(\" \");\r\n    if(pos !== -1){\r\n      let key = clean.substring(0,pos);\r\n      let value = clean.substring(pos+1,clean.length);\r\n      infosClean[key] = value;\r\n    }\r\n  });\r\n  return infosClean;\r\n}\r\n\r\nconst getMoveOffset = (move) => {\r\n  return move.number === 0 ? 0 : ((move.number-1)*2) + (move.side === \"w\" ? 1 : 2);\r\n}\r\n\r\nconst boardToScore = (data) => {\r\n  let scores = {\r\n    \"whiteScore\" : 0,\r\n    \"blackScore\" : 0,\r\n    \"whiteJail\" : [],\r\n    \"blackJail\" : []\r\n  }\r\n  let scoreWhite = 0;\r\n  let scoreBlack = 0;\r\n  let figs = [\"p\",\"R\",\"B\",\"N\",\"Q\"];\r\n  let figsValues = [1,5,3,3,9];\r\n\r\n  let whiteTeam = {\r\n    \"p\": 0, \r\n    \"R\": 0, \r\n    \"B\": 0, \r\n    \"N\": 0, \r\n    \"Q\": 0\r\n  }\r\n  \r\n  let blackTeam = {\r\n    \"p\": 0, \r\n    \"R\": 0, \r\n    \"B\": 0, \r\n    \"N\": 0, \r\n    \"Q\": 0\r\n  }\r\n\r\n  let originalTeam = {\r\n    \"p\": 8, \r\n    \"R\": 2, \r\n    \"B\": 2, \r\n    \"N\": 2, \r\n    \"Q\": 1\r\n  }\r\n\r\n  data.forEach((x,i) => {\r\n      if(x.fig !== null){\r\n          let figure = x.fig.charAt(0);\r\n          let pos = figs.indexOf(figure);\r\n          if(pos !== -1){\r\n              if( x.fig.charAt(1)===\"W\"){\r\n                  whiteTeam[figure] +=1;\r\n                  scoreWhite+=figsValues[pos];\r\n              }else{\r\n                  blackTeam[figure] +=1;\r\n                  scoreBlack+=figsValues[pos];\r\n              }\r\n          }\r\n      }\r\n  })\r\n\r\n  scores.whiteScore = scoreWhite - scoreBlack;\r\n  scores.blackScore = scoreBlack - scoreWhite;\r\n\r\n  for (const item in whiteTeam) {\r\n    let nr = originalTeam[item] - whiteTeam[item];\r\n    for (let i = 0; i < nr; i++) {\r\n      scores.blackJail.push(item);\r\n    }\r\n  }\r\n\r\n  for (const item in blackTeam) {\r\n    let nr = originalTeam[item] - blackTeam[item];\r\n    for (let i = 0; i < nr; i++) {\r\n      scores.whiteJail.push(item);\r\n    }\r\n  }\r\n  return scores;\r\n}\r\n     \r\nconst getPositionsAt = (nextMoveData, gamePositions) => {\r\n  if (!nextMoveData.isError && !nextMoveData.isDone) {\r\n    let hasMoved = false;\r\n    if (nextMoveData.possiblePositions && nextMoveData.possiblePositions.length > 0) {\r\n      for (let i = 0; i < nextMoveData.possiblePositions.length; i++) {\r\n        if (hasMoved) break;\r\n        for (let j = 0; j < gamePositions.length; j++) {\r\n          if (gamePositions[j].column === nextMoveData.possiblePositions[i].column && gamePositions[j].row === nextMoveData.possiblePositions[i].row) {\r\n            if (gamePositions[j].fig === (nextMoveData.movePieceType + nextMoveData.moveSide.toUpperCase())) {\r\n              hasMoved = true;\r\n              gamePositions[j].fig = null;\r\n              break;\r\n            }\r\n          }\r\n        }\r\n      }\r\n\r\n      if (nextMoveData.additionalMove !== null) {\r\n        let hasMovedKing = hasMoved;\r\n        let hasMovedRook = false;\r\n        for (let i = 0; i < gamePositions.length; i++) {\r\n          // Rook\r\n          if (gamePositions[i].column === nextMoveData.additionalMove.possiblePositions[0].column && gamePositions[i].row === nextMoveData.additionalMove.possiblePositions[0].row) {\r\n            if (gamePositions[i].fig === nextMoveData.additionalMove.movePieceType + nextMoveData.additionalMove.moveSide.toUpperCase()) {\r\n              hasMovedRook = true;\r\n              gamePositions[i].fig = null;\r\n            }\r\n          }\r\n        }\r\n        hasMoved = hasMovedKing && hasMovedRook;\r\n      }\r\n    }\r\n    if (nextMoveData.uniqueFigure === true) {\r\n      for (let i = 0; i < gamePositions.length; i++) {\r\n        if (gamePositions[i].fig === nextMoveData.movePieceType + nextMoveData.moveSide.toUpperCase()) {\r\n          hasMoved = true;\r\n          gamePositions[i].fig = null;\r\n          break;\r\n        }\r\n      }\r\n    }\r\n    if (hasMoved) {\r\n      for (let i = 0; i < gamePositions.length; i++) {\r\n        if (gamePositions[i].column === nextMoveData.moveColumn && gamePositions[i].row === nextMoveData.moveRow) {\r\n          if (nextMoveData.moveType === \"take\") {\r\n            if (gamePositions[i].fig === null && nextMoveData.movePieceType === \"p\") { // En passant\r\n              let delta = nextMoveData.moveSide === \"w\" ? 8 : -8;\r\n              gamePositions[i + delta].fig = null;\r\n            }\r\n            gamePositions[i].fig = nextMoveData.movePieceType + nextMoveData.moveSide.toUpperCase();\r\n\r\n          } else {\r\n            gamePositions[i].fig = nextMoveData.promoteTo ? nextMoveData.promoteTo + nextMoveData.moveSide.toUpperCase() : nextMoveData.movePieceType + nextMoveData.moveSide.toUpperCase();\r\n          }\r\n          break;\r\n        }\r\n      }\r\n      if (nextMoveData.additionalMove != null) {\r\n        for (let i = 0; i < gamePositions.length; i++) {\r\n          if (gamePositions[i].column === nextMoveData.additionalMove.moveColumn && gamePositions[i].row === nextMoveData.additionalMove.moveRow) {\r\n            gamePositions[i].fig = nextMoveData.additionalMove.movePieceType + nextMoveData.additionalMove.moveSide.toUpperCase();\r\n            break;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n  return gamePositions;\r\n}\r\n\r\nexport {getMoveOffset,getAskedMove,getNextMove,pngToTurns,pngToInfos,getMoveDataAt,getPositionsAt,boardToScore};","//4r3/N1kbQ3/2r2p2/4p1p1/8/7P/PP4P1/2q2NK1 w - - 5 32\r\nimport {charIsLowercase} from './utils.js';\r\n\r\nconst boardToFen = (gamePositions,nextMoveData,columnsOrdered) => {\r\nlet fen = \"\";\r\nlet separator = \"\";\r\nlet index = 0;\r\nlet nullCounter = 0;\r\nlet currentFigure = \"\";\r\n[1,2,3,4,5,6,7,8].forEach((row) => {\r\n    fen+=separator;\r\n    separator = \"/\";\r\n    nullCounter = 0;\r\n    columnsOrdered.forEach((x,col) => {\r\n        index = (row-1) * 8 + col;\r\n        currentFigure = gamePositions[index].fig;\r\n        if(currentFigure === null){\r\n            nullCounter++;\r\n        }else{\r\n            if(nullCounter > 0){\r\n                fen+=nullCounter+\"\";\r\n                nullCounter = 0;\r\n            }\r\n            if(currentFigure.charAt(1) === \"B\"){\r\n                fen+=currentFigure.charAt(0).toLowerCase();\r\n            }else{\r\n                fen+=currentFigure.charAt(0).toUpperCase();\r\n            }\r\n        }\r\n    })\r\n    if(nullCounter > 0){\r\n        fen+=nullCounter+\"\";\r\n        nullCounter = 0;\r\n    }\r\n})\r\n\r\n// posible castles are missing and number of moves since the last pawn move or check (?)\r\nfen += \" \" + nextMoveData.moveSide + \" - - 0 \" + nextMoveData.number ;\r\n    return fen;\r\n}\r\n\r\nconst fenToBoard = (fen,board,columnsOrdered) => {\r\n    if(!fen) return null;\r\n    let parts = fen.split(\" \");\r\n    let colDatas = parts[0].split(\"/\");\r\n    if(colDatas.length !== 8) return null;\r\n    let cursorPos = -1\r\n    colDatas.forEach((colData,i) => {\r\n        cursorPos = i*8;\r\n        let colDataLen = colData.length;\r\n        for(let c = 0;c < colDataLen;c++ ){\r\n            let char = colData.charAt(c);\r\n            let intTry = parseInt(char);\r\n            if (!isNaN(intTry)) {\r\n                for (let d = 0; d < intTry; d++) {\r\n                    board[cursorPos + d].fig = null;\r\n                }\r\n                cursorPos+=intTry;\r\n            }else{\r\n                let side = \"W\";\r\n                let fig = char;\r\n                if(charIsLowercase(char)){ // Black\r\n                    side = \"B\";\r\n                    if (char === \"p\") {\r\n                        fig = \"p\";\r\n                    } else {\r\n                        fig = char.toUpperCase();\r\n                    }\r\n                }else{ // White\r\n                    if (char === \"P\") {\r\n                        fig = \"p\";\r\n                    } else {\r\n                        fig = char;\r\n                    }\r\n                } \r\n                board[cursorPos].fig = fig + side;\r\n                cursorPos++;\r\n            }\r\n        }\r\n    });\r\n\r\n    return board;\r\n}\r\n\r\nexport {boardToFen,fenToBoard};","import React from 'react';\r\nimport './game.styles.css';\r\nimport Board from '../board/board.component';\r\nimport Info from '../info/info.component';\r\nimport { getAskedMove, getNextMove, pngToTurns, pngToInfos, getMoveDataAt, getPositionsAt ,boardToScore} from '../../movesLogic.js';\r\nimport { boardToFen, fenToBoard } from '../../fen.js';\r\n\r\nclass Game extends React.Component {\r\n  constructor() {\r\n    super();\r\n    this.gameStatus = {\r\n      \"init\": 0,\r\n      \"showList\": 1,\r\n      \"showInput\": 2,\r\n      \"showMoves\": 3,\r\n      \"showMessage\": 4,\r\n      \"inError\": -1,\r\n    };\r\n\r\n    this.state = {\r\n      \"database\": null,\r\n      \"games\": [],\r\n      \"scores\" : {\r\n        \"whiteScore\" : 0,\r\n        \"blackScore\" : 0,\r\n        \"whiteJail\" : [],\r\n        \"blackJail\" : []\r\n      },\r\n      \"gameKey\": 0,\r\n      \"doReverseBoard\" :false,\r\n      \"proposeSave\": false,\r\n      \"status\": this.gameStatus.init,\r\n      \"readerStop\": false,\r\n      \"initialData\": null,\r\n      \"gameIsReady\": false,\r\n      \"infosTitle\": \"\",\r\n      \"infosMessage\": \"\",\r\n      \"msg\": \"White to play\",\r\n      \"data\": [],\r\n      \"pgnHistory\": \"\",\r\n      \"move\": { \"number\": 0, \"side\": \"b\" },\r\n      \"pgnResume\": [],\r\n      \"pgnGame\": [],\r\n      \"fenGame\": [{ \"number\": 0, \"side\": \"w\", \"fen\": \"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1\" }],\r\n      \"positions\": [],\r\n      \"columns\": \"a,b,c,d,e,f,g,h\".split(\",\"), // \"columns\" or \"files\"\r\n      \"rows\": [1, 2, 3, 4, 5, 6, 7, 8],\r\n      \"figures\": \"R,N,B,Q,K,B,N,R\".split(\",\"),\r\n      \"pawn\": \"p\",\r\n      \"black\": \"B\",\r\n      \"white\": \"W\",\r\n      \"blackColor\": \"dark-square\",\r\n      \"whiteColor\": \"light-square\",\r\n      \"nrSquaresPerside\": 8, // in case we want to change the rules !!!\r\n      \"figCodes\": {\r\n        \"KB\": \"&#9818;\",\r\n        \"QB\": \"&#9819;\",\r\n        \"RB\": \"&#9820;\",\r\n        \"BB\": \"&#9821;\",\r\n        \"NB\": \"&#9822;\",\r\n        \"pB\": \"&#9823;\",\r\n        \"KW\": \"&#9812;\",\r\n        \"QW\": \"&#9813;\",\r\n        \"RW\": \"&#9814;\",\r\n        \"BW\": \"&#9815;\",\r\n        \"NW\": \"&#9816;\",\r\n        \"pW\": \"&#9817;\",\r\n      }\r\n    };\r\n  }\r\n\r\n  reverseBoard= (e) => {\r\n    let doReverse= !this.state.doReverseBoard;\r\n    this.setState((state, props) => (\r\n      {\r\n        \"doReverseBoard\": doReverse,\r\n      }\r\n    ));\r\n  }\r\n\r\n  deleteGame= (e) => {\r\n    let index = e.currentTarget.getAttribute(\"data-index\");\r\n    if (this.state.games && this.state.games.length > 0 && index < this.state.games.length) {\r\n      this.doDeleteGame(index);\r\n    }\r\n  }\r\n\r\n  loadGame = (e) => {\r\n    let index = e.currentTarget.getAttribute(\"data-index\");\r\n    if (this.state.games && this.state.games.length > 0 && index < this.state.games.length) {\r\n      this.doLoadGame(index);\r\n    }\r\n  }\r\n\r\n  doDeleteGame = (index) => {\r\n    let games = JSON.parse(JSON.stringify(this.state.games));\r\n    games.splice(index, 1);\r\n    let otherProps = {\r\n      games : games\r\n    }\r\n    localStorage.setItem(\"games\", JSON.stringify(games));\r\n    let newStatus = games && games.length > 0 ? this.gameStatus.showList: this.gameStatus.showInput;\r\n    this.setGameStatus(newStatus, \"\", otherProps);\r\n  }\r\n\r\n  doLoadGame = (index) => {\r\n    let game = this.state.games[index];\r\n    let otherProps = {\r\n      \"data\": JSON.parse(this.state.initialData),\r\n      \"pgnResume\": game.pgnResume,\r\n      \"pgnHistory\": game.pgnHistory,\r\n      \"pgnGame\": game.pgnGame,\r\n      \"fenGame\": game.fenGame,\r\n      \"move\": {\r\n        \"number\": 0,\r\n        \"side\": \"w\"\r\n      },\r\n      \"scores\" : {\r\n        \"whiteScore\" : 0,\r\n        \"blackScore\" : 0,\r\n        \"whiteJail\" : [],\r\n        \"blackJail\" : []\r\n      }\r\n    }\r\n    this.setGameStatus(this.gameStatus.showMoves, \"\", otherProps);\r\n  }\r\n\r\n  moveGameTo = (askedMove) => {\r\n    let timing = 10;\r\n    if (\"pace\" in askedMove) {\r\n      if (askedMove.pace === \"quick\") {\r\n        timing = 1;\r\n      }\r\n    }\r\n    let currentMove = this.state.move;\r\n    let gamePgn = this.state.pgnGame;\r\n    let gamePositions = this.state.data;\r\n    let columnsOrdered = this.state.columns.slice(0)\r\n    let nextMoveData = getNextMove(gamePgn, currentMove, askedMove, columnsOrdered);\r\n\r\n    if (!nextMoveData.isError && !nextMoveData.isDone) {\r\n      let hasMoved = false;\r\n      if (nextMoveData.possiblePositions && nextMoveData.possiblePositions.length > 0) {\r\n        for (let i = 0; i < nextMoveData.possiblePositions.length; i++) {\r\n          if (hasMoved) break;\r\n          for (let j = 0; j < gamePositions.length; j++) {\r\n            if (gamePositions[j].column === nextMoveData.possiblePositions[i].column && gamePositions[j].row === nextMoveData.possiblePositions[i].row) {\r\n              if (gamePositions[j].fig === (nextMoveData.movePieceType + nextMoveData.moveSide.toUpperCase())) {\r\n                hasMoved = true;\r\n                gamePositions[j].fig = null;\r\n                break;\r\n              }\r\n            }\r\n          }\r\n        }\r\n\r\n        if (nextMoveData.additionalMove !== null) {\r\n          let hasMovedKing = hasMoved;\r\n          let hasMovedRook = false;\r\n          for (let i = 0; i < gamePositions.length; i++) {\r\n            // Rook\r\n            if (gamePositions[i].column === nextMoveData.additionalMove.possiblePositions[0].column && gamePositions[i].row === nextMoveData.additionalMove.possiblePositions[0].row) {\r\n              if (gamePositions[i].fig === nextMoveData.additionalMove.movePieceType + nextMoveData.additionalMove.moveSide.toUpperCase()) {\r\n                hasMovedRook = true;\r\n                gamePositions[i].fig = null;\r\n              }\r\n            }\r\n          }\r\n          hasMoved = hasMovedKing && hasMovedRook;\r\n        }\r\n      }\r\n      if (nextMoveData.uniqueFigure === true) {\r\n        for (let i = 0; i < gamePositions.length; i++) {\r\n          if (gamePositions[i].fig === nextMoveData.movePieceType + nextMoveData.moveSide.toUpperCase()) {\r\n            hasMoved = true;\r\n            gamePositions[i].fig = null;\r\n            break;\r\n          }\r\n        }\r\n      }\r\n      if (hasMoved) {\r\n        for (let i = 0; i < gamePositions.length; i++) {\r\n          if (gamePositions[i].column === nextMoveData.moveColumn && gamePositions[i].row === nextMoveData.moveRow) {\r\n            if (nextMoveData.moveType === \"take\") {\r\n              if (gamePositions[i].fig === null && nextMoveData.movePieceType === \"p\") { // En passant\r\n                let delta = nextMoveData.moveSide === \"w\" ? 8 : -8;\r\n                gamePositions[i + delta].fig = null;\r\n              }\r\n              gamePositions[i].fig = nextMoveData.movePieceType + nextMoveData.moveSide.toUpperCase();\r\n\r\n            } else {\r\n              gamePositions[i].fig = nextMoveData.promoteTo ? nextMoveData.promoteTo + nextMoveData.moveSide.toUpperCase() : nextMoveData.movePieceType + nextMoveData.moveSide.toUpperCase();\r\n            }\r\n            break;\r\n          }\r\n        }\r\n        if (nextMoveData.additionalMove != null) {\r\n          for (let i = 0; i < gamePositions.length; i++) {\r\n            if (gamePositions[i].column === nextMoveData.additionalMove.moveColumn && gamePositions[i].row === nextMoveData.additionalMove.moveRow) {\r\n              gamePositions[i].fig = nextMoveData.additionalMove.movePieceType + nextMoveData.additionalMove.moveSide.toUpperCase();\r\n              break;\r\n            }\r\n          }\r\n        }\r\n\r\n        let fenGame = this.state.fenGame;\r\n        let fenData = fenGame.filter((x) => {\r\n          return x.number === nextMoveData.number && x.side === nextMoveData.moveSide;\r\n        });\r\n        if (fenData.length === 0) {\r\n          let gamePositions = this.state.data;\r\n          let columnsOrdered = this.state.columns.slice(0)\r\n          let fen = boardToFen(gamePositions, nextMoveData, columnsOrdered);\r\n          if (fen) {\r\n            fenGame.push({ \"number\": nextMoveData.number, \"side\": nextMoveData.moveSide, \"fen\": fen });\r\n          }\r\n        }\r\n        this.setState((state, props) => (\r\n          {\r\n            \"data\": gamePositions,\r\n            \"move\": { number: nextMoveData.number, side: nextMoveData.moveSide },\r\n            \"fenGame\": fenGame,\r\n            \"status\": this.gameStatus.showMoves\r\n          }\r\n        ));\r\n          let that = this;\r\n            setTimeout(function () {\r\n              that.moveGameTo(askedMove);\r\n            }, timing);\r\n      }\r\n    }\r\n  }\r\n\r\n  componentDidMount() {\r\n    this.initGames();\r\n  }\r\n\r\n  menuMove = (e) => {\r\n    let target = e.currentTarget.getAttribute(\"data-target\");\r\n    if (target in this.gameStatus) {\r\n      this.setGameStatus(this.gameStatus[target]);\r\n    }\r\n  }\r\n\r\n  movePGN = (e) => {\r\n    let elem;\r\n    if (\"move\" in e) {\r\n      elem = e;\r\n    } else {\r\n      elem = (e.currentTarget).dataset;\r\n    }\r\n    let currentMove = this.state.move;\r\n    let askedMove = getAskedMove(elem, currentMove, this.state.pgnGame);\r\n    let fenMove = this.state.fenGame.filter((x) => {\r\n      return x.number === askedMove.number && x.side === askedMove.side;\r\n    });\r\n    if (fenMove.length !== 0) {\r\n      let columnsOrdered = this.state.columns.slice(0)\r\n      let reinitData = JSON.parse(this.state.initialData);\r\n      reinitData = fenToBoard(fenMove[0].fen, reinitData, columnsOrdered);\r\n      let scores = boardToScore(reinitData);\r\n\r\n      this.setState((state, props) => (\r\n        {\r\n          data: reinitData,\r\n          scores:scores,\r\n          move: {\r\n            number: askedMove.number,\r\n            side: askedMove.side\r\n          }\r\n        }\r\n      ));\r\n    }\r\n  }\r\n\r\n  savePGN = () => {\r\n  //  let that = this;\r\n  this.setGameStatus(this.gameStatus.showMessage, \"Aanalyzing and saving your game\");\r\n      let textArea = document.getElementById(\"game-input\");\r\n      if (textArea != null) {\r\n        let pgn = textArea.value;\r\n        if (pgn !== \"\") { // todo check validity !\r\n          let limitBetweenGameParts = /\\n\\n/.exec(pgn).index;\r\n          let pngInfos = pgn.substring(0, limitBetweenGameParts).replace(/\\r\\n?|\\n/g, \",\").trim();\r\n          let pgnGame = pgn.substring(limitBetweenGameParts, pgn.length).replace(/\\r\\n?|\\n/g, \" \").trim();\r\n          // putting the infos in an object\r\n          let infosClean = pngToInfos(pngInfos);\r\n          if(!infosClean.Site){\r\n            infosClean.Site = \"???\";\r\n          }\r\n          // putting the game into an array of turns ex : [{\"w\":\"a4\",\"b\":\"a5\"}]\r\n          let turns = pngToTurns(pgnGame);\r\n          // calculating the fens for every half move\r\n          let fenGame = [{ \"number\": 0, \"side\": \"w\", \"fen\": \"rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1\" }];\r\n          let positions = JSON.parse(this.state.initialData);\r\n          let columnsOrdered = this.state.columns.slice(0)\r\n  \r\n          turns.forEach((turn, i) => {\r\n            [\"w\", \"b\"].forEach((side) => {\r\n              if (side in turn) {\r\n                let nextMoveData = getMoveDataAt(turn, side, i + 1, positions, columnsOrdered);\r\n                positions = getPositionsAt(nextMoveData, positions);\r\n                let fen = boardToFen(positions, nextMoveData, columnsOrdered);\r\n                if (fen) {\r\n                  fenGame.push({ \"number\": nextMoveData.number, \"side\": nextMoveData.moveSide, \"fen\": fen });\r\n                }\r\n              }\r\n            });\r\n          });\r\n          let gameToSave = {\r\n            \"pgnHistory\": pgn,\r\n            \"pgnResume\": infosClean,\r\n            \"pgnGame\": turns,\r\n            \"fenGame\": fenGame\r\n          };\r\n          this.saveGameToStorage(gameToSave);\r\n          this.state.games.push(gameToSave);\r\n          let otherProps = {\r\n            \"data\": JSON.parse(this.state.initialData),\r\n            \"pgnResume\": infosClean,\r\n            \"pgnHistory\": pgn,\r\n            \"pgnGame\": turns,\r\n            \"fenGame\": fenGame,\r\n            \"move\": {\r\n              \"number\": 0,\r\n              \"side\": \"w\"\r\n            },\r\n            \"scores\" : {\r\n              \"whiteScore\" : 0,\r\n              \"blackScore\" : 0,\r\n              \"whiteJail\" : [],\r\n              \"blackJail\" : []\r\n            }\r\n          }\r\n          this.setGameStatus(this.gameStatus.showList, \"\",otherProps);\r\n        } else {\r\n          this.setGameStatus(this.gameStatus.inError, \"unable to read this png\");\r\n        }\r\n      }\r\n   \r\n  }\r\n\r\n  saveGameToStorage = (gameToSave) => {\r\n    this.setGameStatus(this.gameStatus.showMessage, \"Saving analyzed game\");\r\n\r\n    let games = [];\r\n    if (localStorage.getItem(\"games\") !== null) {\r\n      games = JSON.parse(localStorage.getItem(\"games\"));\r\n      let gameAlready = games.filter((x) => {\r\n        return x.pgnGame === gameToSave.pgnGame;\r\n      });\r\n      if (gameAlready.length === 0) {\r\n        games.push(gameToSave);\r\n      } else {\r\n        games.forEach((x) => {\r\n          if (x.pgnGame === gameToSave.pgnGame) {\r\n            x.pgnHistory = gameToSave.pgnHistory;\r\n            x.pgnResume = gameToSave.pgnResume;\r\n            x.fenGame = gameToSave.fenGame;\r\n          }\r\n        });\r\n      }\r\n    } else {\r\n      games.push(gameToSave);\r\n    }\r\n    localStorage.setItem(\"games\", JSON.stringify(games));\r\n  }\r\n  \r\n  setGameStatus = (status, message,otherProps) => {\r\n    let infos = \"\"\r\n    switch (status) {\r\n      case this.gameStatus.showInput:\r\n        infos = { \"title\": \"Please enter a game in PGN format\", \"message\": \"\" };\r\n        break;\r\n      case this.gameStatus.init:\r\n        infos = { \"title\": \"New game saved\", \"message\": \"analysing PGN game...\" };\r\n        break;\r\n      case this.gameStatus.showMoves:\r\n        infos = { \"title\": \"Game's moves\", \"message\": \"\" };\r\n        break;\r\n      case this.gameStatus.showList:\r\n        infos = { \"title\": \"Choose from list\", \"message\": \"\" };\r\n        break;\r\n      case this.gameStatus.showMessage:\r\n        infos = { \"title\": \"Current status\", \"message\": message };\r\n        break;\r\n      case this.gameStatus.inError:\r\n        infos = { \"title\": \"Error !\", \"message\": message };\r\n        break;\r\n      default:\r\n        infos = { \"title\": \"Error !\", \"message\": \"the program is in error...\" };\r\n    }\r\n    let newState = {\r\n      \"status\": status,\r\n      \"infosTitle\": infos.title,\r\n      \"infosMessage\": infos.message\r\n    }\r\n    if(otherProps){\r\n      for (let p in otherProps){\r\n        newState[p] = otherProps[p];\r\n      }\r\n    }\r\n    this.setState((state, props) => (\r\n      newState\r\n    ));\r\n  }\r\n\r\n  initGames = () => {\r\n    this.setState((state, props) => ({\r\n      status: this.gameStatus.init\r\n    }));\r\n    // eslint-disable-next-line no-restricted-globals\r\n    let database = window.database !== undefined ? window.database : null;\r\n    let games = [];\r\n    if(database){\r\n      games = database.ref(\"Games\");\r\n    }else{\r\n      if (localStorage.getItem(\"games\") !== null) {\r\n        games = JSON.parse(localStorage.getItem(\"games\"));\r\n      }\r\n    }\r\n\r\n    let initialStatus = this.gameStatus.showInput;\r\n    if (games.length > 0) {\r\n      initialStatus = this.gameStatus.showList;\r\n    }\r\n    let pgn = this.state.pgnHistory;\r\n    let data = [];\r\n    let positions = [];\r\n    let blackColor = this.state.blackColor;\r\n    let whiteColor = this.state.whiteColor;\r\n    let black = this.state.black;\r\n    let white = this.state.white;\r\n\r\n    let currentColor;\r\n    let previousColor = whiteColor;\r\n    let row = 0;\r\n    let col = 0;\r\n    let i = 0;\r\n    for (let r = 7; r >= 0; r--) {\r\n      row = this.state.rows[r];\r\n      for (let c = 0; c < 8; c++) {\r\n        col = this.state.columns[c];\r\n        i++;\r\n        if (i % 8 === 1) {\r\n          currentColor = previousColor;\r\n        } else {\r\n          currentColor = previousColor === blackColor ? whiteColor : blackColor;\r\n          previousColor = currentColor;\r\n        }\r\n        data.push({ \"row\": row, \"column\": col, \"squareColor\": currentColor, \"fig\": null });\r\n      }\r\n    }\r\n\r\n    this.state.figures.forEach((fig, i) => {\r\n      positions.push({ \"row\": this.state.rows[0], \"column\": this.state.columns[i], \"fig\": fig + white });\r\n      positions.push({ \"row\": this.state.rows[1], \"column\": this.state.columns[i], \"fig\": this.state.pawn + white });\r\n      positions.push({ \"row\": this.state.rows[6], \"column\": this.state.columns[i], \"fig\": this.state.pawn + black });\r\n      positions.push({ \"row\": this.state.rows[7], \"column\": this.state.columns[i], \"fig\": fig + black });\r\n    });\r\n\r\n    data.forEach((sqr) => {\r\n      let check = positions.filter((pos) => {\r\n        return pos.row === sqr.row && pos.column === sqr.column;\r\n      });\r\n      if (check.length === 1) {\r\n        sqr.fig = check[0].fig;\r\n      }\r\n    });\r\n    let otherProps = {\r\n      \"games\":games,\r\n      \"status\": initialStatus,\r\n      \"data\": data,\r\n      \"initialData\": JSON.stringify(data),\r\n      \"positions\": positions,\r\n      \"move\": { \"number\": 0, \"side\": \"w\" },\r\n      \"pgnHistory\": pgn,\r\n      \"scores\" : {\r\n        \"whiteScore\" : 0,\r\n        \"blackScore\" : 0,\r\n        \"whiteJail\" : [],\r\n        \"blackJail\" : []\r\n      }\r\n    }\r\n    this.setGameStatus(initialStatus, \"\",otherProps);\r\n  }\r\n\r\n  render() {\r\n    if (this.state.status === this.gameStatus.showInput) {// todo : adapt to input in textArea\r\n      return (\r\n        <div className=\"game\">\r\n          <div className=\"game-board\">\r\n            <Board key={1} reverseBoard={this.reverseBoard} game={this.state} />\r\n          </div>\r\n          <div className=\"game-info\">\r\n            <Info key={1} game={this.state} movePGN={this.movePGN} menuMove = {this.menuMove} savePGN={this.savePGN} statuses={this.gameStatus}></Info>\r\n          </div>\r\n        </div>\r\n      )\r\n    } else if (this.state.status === this.gameStatus.showList) { // todo : adapt to list\r\n      return (\r\n        <div className=\"game\">\r\n          <div className=\"game-board\">\r\n            <Board key={1} reverseBoard={this.reverseBoard} game={this.state} />\r\n          </div>\r\n          <div className=\"game-info\">\r\n            <Info key={1} game={this.state} loadGame={this.loadGame} deleteGame={this.deleteGame} menuMove = {this.menuMove} statuses={this.gameStatus}></Info>\r\n          </div>\r\n        </div>\r\n      )\r\n    } else if (this.state.status === this.gameStatus.showMoves) { // todo : adapt to list\r\n      return (\r\n        <div className=\"game\">\r\n          <div className=\"game-board\">\r\n            <Board key={1} reverseBoard={this.reverseBoard} game={this.state} />\r\n          </div>\r\n          <div className=\"game-info\">\r\n            <Info key={1} game={this.state} movePGN={this.movePGN} menuMove = {this.menuMove} savePGN={this.savePGN} statuses={this.gameStatus}></Info>\r\n          </div>\r\n        </div>\r\n      )\r\n    }else if (this.state.status === this.gameStatus.showMessage) { // todo : adapt to list\r\n      return (\r\n        <div className=\"game\">\r\n          <div >\r\n            <h1> {this.state.infosTitle} </h1>\r\n            <p> {this.state.infosMessage} </p>\r\n          </div>\r\n        </div>\r\n      )\r\n    }\r\n    else { // Adapt to other status such as error\r\n      return (\r\n        <div className=\"game\">\r\n          <h1> Loading </h1>\r\n        </div>\r\n      );\r\n    }\r\n  }\r\n}\r\n\r\nexport default Game;\r\n\r\n","import React from 'react';\r\n\r\nimport './App.css';\r\nimport Header from './components/header/header.component';\r\nimport Game from './components/game/game.component';\r\n\r\nfunction App() {\r\n  return (\r\n    <div className=\"App\">\r\n      <Header/>\r\n      <Game/>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default App;\r\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport App from './App';\r\n\r\nReactDOM.render( \r\n   <App/>,\r\n   document.getElementById('root')\r\n);\r\n\r\n"],"sourceRoot":""}